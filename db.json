{"meta":{"version":1,"warehouse":"5.0.1"},"models":{"Asset":[{"_id":"source/images/php-gdb.jpeg","path":"images/php-gdb.jpeg","modified":0,"renderable":0},{"_id":"source/images/front.webp","path":"images/front.webp","modified":0,"renderable":0},{"_id":"themes/landscape/source/css/style.styl","path":"css/style.styl","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.min.css","path":"fancybox/jquery.fancybox.min.css","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.min.js","path":"fancybox/jquery.fancybox.min.js","modified":0,"renderable":1},{"_id":"themes/landscape/source/js/jquery-3.6.4.min.js","path":"js/jquery-3.6.4.min.js","modified":0,"renderable":1},{"_id":"themes/landscape/source/js/script.js","path":"js/script.js","modified":0,"renderable":1},{"_id":"themes/landscape/source/css/images/banner.jpg","path":"css/images/banner.jpg","modified":0,"renderable":1},{"_id":"source/images/favicon.png","path":"images/favicon.png","modified":1,"renderable":0}],"Cache":[{"_id":"source/_posts/Extreme-Debugging-in-PHP.md","hash":"b4f2f483cb4095f4c7254a39abc2f79f8948bcfb","modified":1725477821872},{"_id":"source/_posts/hello-world.md","hash":"7d98d6592de80fdcd2949bd7401cec12afd98cdf","modified":1725474200332},{"_id":"node_modules/hexo-theme-landscape/LICENSE","hash":"c480fce396b23997ee23cc535518ffaaf7f458f8","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/README.md","hash":"1a9b279e6dd29fd19245f913f0c4a316ffaa62db","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/_config.yml","hash":"b608c1f1322760dce9805285a602a95832730a2e","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/package.json","hash":"4bf95d52f77edf811f23f6d264a7493311a8d078","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/languages/de-DE.yml","hash":"d29d1c4256b7ed9df42f511c2ff0a23ad5fd6c1f","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/languages/de.yml","hash":"3ebf0775abbee928c8d7bda943c191d166ded0d3","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/languages/default.yml","hash":"ea5e6aee4cb14510793ac4593a3bddffe23e530c","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/languages/en-GB.yml","hash":"ea5e6aee4cb14510793ac4593a3bddffe23e530c","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/languages/en-US.yml","hash":"ea5e6aee4cb14510793ac4593a3bddffe23e530c","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/languages/en.yml","hash":"3083f319b352d21d80fc5e20113ddf27889c9d11","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/languages/es-ES.yml","hash":"7008a8fc91f18d2a735864817b8ebda30c7a2c66","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/es.yml","hash":"76edb1171b86532ef12cfd15f5f2c1ac3949f061","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/fr-FR.yml","hash":"8d09dbdab00a30a2870b56f7c0a7ca7deafa7b88","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/fr.yml","hash":"415e1c580ced8e4ce20b3b0aeedc3610341c76fb","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/hu-HU.yml","hash":"712d18664898fa21ba38d4973e90ef41a324ea25","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/hu.yml","hash":"284d557130bf54a74e7dcef9d42096130e4d9550","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/it-IT.yml","hash":"2cb6dc2fab9bd2dbe1c8bb869a9e8bf85a564fdd","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/it.yml","hash":"89b7d91306b2c1a0f3ac023b657bf974f798a1e8","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/ja-JP.yml","hash":"08481267e0c112e1f6855620f2837ec4c4a98bbd","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/ja.yml","hash":"a73e1b9c80fd6e930e2628b393bfe3fb716a21a9","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/ko-KR.yml","hash":"19209ad8f9d4057e8df808937f950eb265e1db69","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/ko.yml","hash":"881d6a0a101706e0452af81c580218e0bfddd9cf","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/mn-MN.yml","hash":"b9e5f3e7c0c2f779cf2cfded6db847b5941637ca","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/mn.yml","hash":"2e7523951072a9403ead3840ad823edd1084c116","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/nl-NL.yml","hash":"5ebbc30021f05d99938f96dfff280392df7f91f0","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/nl.yml","hash":"12ed59faba1fc4e8cdd1d42ab55ef518dde8039c","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/no.yml","hash":"965a171e70347215ec726952e63f5b47930931ef","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/pt-PT.yml","hash":"0f852b6b228e6ea59aa3540574bb89b233f2a098","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/pt.yml","hash":"57d07b75d434fbfc33b0ddb543021cb5f53318a8","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/ru-RU.yml","hash":"360d11a28bb768afb1dd15f63fa7fd3a8cc547ee","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/ru.yml","hash":"4fda301bbd8b39f2c714e2c934eccc4b27c0a2b0","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/th-TH.yml","hash":"ebfdba9bc4842c829473c1e6e4544344f182724d","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/th.yml","hash":"84a55b00aa01f03982be294e43c33a20e6d32862","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/tr.yml","hash":"a1cdbfa17682d7a971de8ab8588bf57c74224b5b","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/zh-CN.yml","hash":"1efd95774f401c80193eac6ee3f1794bfe93dc5a","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/languages/zh-TW.yml","hash":"53ce3000c5f767759c7d2c4efcaa9049788599c3","modified":1725474200204},{"_id":"node_modules/hexo-theme-landscape/layout/archive.ejs","hash":"2703b07cc8ac64ae46d1d263f4653013c7e1666b","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/category.ejs","hash":"765426a9c8236828dc34759e604cc2c52292835a","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/index.ejs","hash":"aa1b4456907bdb43e629be3931547e2d29ac58c8","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/layout.ejs","hash":"0d1765036e4874500e68256fedb7470e96eeb6ee","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/page.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/post.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/tag.ejs","hash":"eaa7b4ccb2ca7befb90142e4e68995fb1ea68b2e","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/scripts/fancybox.js","hash":"c857d7a5e4a5d71c743a009c5932bf84229db428","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/after-footer.ejs","hash":"377d257d5d16e0158a4405c72401517b074fd7ff","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/archive-post.ejs","hash":"c7a71425a946d05414c069ec91811b5c09a92c47","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/archive.ejs","hash":"7cb70a7a54f8c7ae49b10d1f37c0a9b74eab8826","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/article.ejs","hash":"56597e951203dd662a6d2c817c7c4f1c920d4a25","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/footer.ejs","hash":"3656eb692254346671abc03cb3ba1459829e0dce","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/gauges-analytics.ejs","hash":"21a1e2a3907d1a3dad1cd0ab855fe6735f233c74","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/google-analytics.ejs","hash":"2ea7442ea1e1a8ab4e41e26c563f58413b59a3d0","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/head.ejs","hash":"f05bced793b0314d4f2ef0c993b3a51d0b7d203a","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/header.ejs","hash":"6a5033d189554c9a6d42e2ef7952ae5c9742648e","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/mobile-nav.ejs","hash":"e952a532dfc583930a666b9d4479c32d4a84b44e","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/sidebar.ejs","hash":"930da35cc2d447a92e5ee8f835735e6fd2232469","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/_widget/archive.ejs","hash":"beb4a86fcc82a9bdda9289b59db5a1988918bec3","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/_widget/category.ejs","hash":"dd1e5af3c6af3f5d6c85dfd5ca1766faed6a0b05","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/_widget/recent_posts.ejs","hash":"60c4b012dcc656438ff59997e60367e5a21ab746","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/_widget/tag.ejs","hash":"2de380865df9ab5f577f7d3bcadf44261eb5faae","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/_widget/tagcloud.ejs","hash":"b4a2079101643f63993dcdb32925c9b071763b46","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/source/css/_extend.styl","hash":"222fbe6d222531d61c1ef0f868c90f747b1c2ced","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/source/css/_variables.styl","hash":"ca28281423ae57d76b6c1eb91cd845fd4e518bd6","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/source/css/style.styl","hash":"e55a1d92954ed20f6887f92dc727bb995a010a43","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/source/fancybox/jquery.fancybox.min.css","hash":"1be9b79be02a1cfc5d96c4a5e0feb8f472babd95","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/source/js/script.js","hash":"49773efcb2221bbdf2d86f3f5c5ff2d841b528cc","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/category.ejs","hash":"c6bcd0e04271ffca81da25bcff5adf3d46f02fc0","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/date.ejs","hash":"f1458584b679545830b75bef2526e2f3eb931045","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/gallery.ejs","hash":"3d9d81a3c693ff2378ef06ddb6810254e509de5b","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/nav.ejs","hash":"16a904de7bceccbb36b4267565f2215704db2880","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/tag.ejs","hash":"2fcb0bf9c8847a644167a27824c9bb19ac74dd14","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/title.ejs","hash":"4d7e62574ddf46de9b41605fe3140d77b5ddb26d","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/archive.styl","hash":"db15f5677dc68f1730e82190bab69c24611ca292","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/article.styl","hash":"2d1f6f79ebf9cb55ebdb3865a2474437eb2b37c6","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/comment.styl","hash":"79d280d8d203abb3bd933ca9b8e38c78ec684987","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/footer.styl","hash":"e35a060b8512031048919709a8e7b1ec0e40bc1b","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/header.styl","hash":"268d2989acb06e2ddd06cc36a6918c6cd865476b","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/highlight.styl","hash":"9cc3b2927d814f2f6e8e188f9d3657b94f4c6ef3","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/mobile.styl","hash":"a399cf9e1e1cec3e4269066e2948d7ae5854d745","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/sidebar-aside.styl","hash":"890349df5145abf46ce7712010c89237900b3713","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/sidebar-bottom.styl","hash":"8fd4f30d319542babfd31f087ddbac550f000a8a","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/sidebar.styl","hash":"404ec059dc674a48b9ab89cd83f258dec4dcb24d","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/source/css/_util/grid.styl","hash":"0bf55ee5d09f193e249083602ac5fcdb1e571aed","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/source/css/_util/mixin.styl","hash":"44f32767d9fd3c1c08a60d91f181ee53c8f0dbb3","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/source/fancybox/jquery.fancybox.min.js","hash":"6181412e73966696d08e1e5b1243a572d0f22ba6","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/source/js/jquery-3.6.4.min.js","hash":"eda46747c71d38a880bee44f9a439c3858bb8f99","modified":1725474200200},{"_id":"node_modules/hexo-theme-landscape/source/css/images/banner.jpg","hash":"f44aa591089fcb3ec79770a1e102fd3289a7c6a6","modified":1725474200200},{"_id":"source/images/php-gdb.jpeg","hash":"cf02089dccee45117acf6d90767b9e5e15cf63cd","modified":1725477565233},{"_id":"source/_posts/image.png","hash":"370bd5b5468d250f6c583cc3d2f4a8ea9cc1b171","modified":1725477451808},{"_id":"source/images/front.webp","hash":"ac93b8a349a753e0c0a18803d7888ad7e7d093ca","modified":1725478541795},{"_id":"themes/landscape/.gitignore","hash":"4c78c751a5bbca6b54ad06922947573c967d51c8","modified":1725478936091},{"_id":"themes/landscape/.npmignore","hash":"4c40eab00f24304ca400313319c58d461788ff5e","modified":1725478936091},{"_id":"themes/landscape/LICENSE","hash":"c480fce396b23997ee23cc535518ffaaf7f458f8","modified":1725478936091},{"_id":"themes/landscape/README.md","hash":"6497b70356271fd6f9f1dc862353be844c457a53","modified":1725478936091},{"_id":"themes/landscape/_config.yml","hash":"a93d7b3990e45bc7247eecf01888f71674887a63","modified":1725478936091},{"_id":"themes/landscape/package.json","hash":"4bf95d52f77edf811f23f6d264a7493311a8d078","modified":1725478936095},{"_id":"themes/landscape/.github/dependabot.yml","hash":"25b0257a0db2c5b6a5756d8990bc2cba12f54fc5","modified":1725478936091},{"_id":"themes/landscape/languages/de-DE.yml","hash":"3ebf0775abbee928c8d7bda943c191d166ded0d3","modified":1725478936091},{"_id":"themes/landscape/languages/de.yml","hash":"3ebf0775abbee928c8d7bda943c191d166ded0d3","modified":1725478936091},{"_id":"themes/landscape/languages/default.yml","hash":"3083f319b352d21d80fc5e20113ddf27889c9d11","modified":1725478936091},{"_id":"themes/landscape/languages/en-GB.yml","hash":"3083f319b352d21d80fc5e20113ddf27889c9d11","modified":1725478936091},{"_id":"themes/landscape/languages/en.yml","hash":"3083f319b352d21d80fc5e20113ddf27889c9d11","modified":1725478936091},{"_id":"themes/landscape/languages/en-US.yml","hash":"3083f319b352d21d80fc5e20113ddf27889c9d11","modified":1725478936091},{"_id":"themes/landscape/languages/es-ES.yml","hash":"76edb1171b86532ef12cfd15f5f2c1ac3949f061","modified":1725478936091},{"_id":"themes/landscape/languages/es.yml","hash":"76edb1171b86532ef12cfd15f5f2c1ac3949f061","modified":1725478936091},{"_id":"themes/landscape/languages/fr-FR.yml","hash":"415e1c580ced8e4ce20b3b0aeedc3610341c76fb","modified":1725478936091},{"_id":"themes/landscape/languages/fr.yml","hash":"415e1c580ced8e4ce20b3b0aeedc3610341c76fb","modified":1725478936091},{"_id":"themes/landscape/languages/hu-HU.yml","hash":"284d557130bf54a74e7dcef9d42096130e4d9550","modified":1725478936091},{"_id":"themes/landscape/languages/hu.yml","hash":"284d557130bf54a74e7dcef9d42096130e4d9550","modified":1725478936091},{"_id":"themes/landscape/languages/it-IT.yml","hash":"89b7d91306b2c1a0f3ac023b657bf974f798a1e8","modified":1725478936091},{"_id":"themes/landscape/languages/it.yml","hash":"89b7d91306b2c1a0f3ac023b657bf974f798a1e8","modified":1725478936091},{"_id":"themes/landscape/languages/ja-JP.yml","hash":"a73e1b9c80fd6e930e2628b393bfe3fb716a21a9","modified":1725478936091},{"_id":"themes/landscape/languages/ja.yml","hash":"a73e1b9c80fd6e930e2628b393bfe3fb716a21a9","modified":1725478936091},{"_id":"themes/landscape/languages/ko-KR.yml","hash":"881d6a0a101706e0452af81c580218e0bfddd9cf","modified":1725478936091},{"_id":"themes/landscape/languages/ko.yml","hash":"881d6a0a101706e0452af81c580218e0bfddd9cf","modified":1725478936091},{"_id":"themes/landscape/languages/mn-MN.yml","hash":"2e7523951072a9403ead3840ad823edd1084c116","modified":1725478936091},{"_id":"themes/landscape/languages/mn.yml","hash":"2e7523951072a9403ead3840ad823edd1084c116","modified":1725478936091},{"_id":"themes/landscape/languages/nl-NL.yml","hash":"12ed59faba1fc4e8cdd1d42ab55ef518dde8039c","modified":1725478936091},{"_id":"themes/landscape/languages/nl.yml","hash":"12ed59faba1fc4e8cdd1d42ab55ef518dde8039c","modified":1725478936091},{"_id":"themes/landscape/languages/no.yml","hash":"965a171e70347215ec726952e63f5b47930931ef","modified":1725478936091},{"_id":"themes/landscape/languages/pt-PT.yml","hash":"57d07b75d434fbfc33b0ddb543021cb5f53318a8","modified":1725478936091},{"_id":"themes/landscape/languages/pt.yml","hash":"57d07b75d434fbfc33b0ddb543021cb5f53318a8","modified":1725478936091},{"_id":"themes/landscape/languages/ru-RU.yml","hash":"4fda301bbd8b39f2c714e2c934eccc4b27c0a2b0","modified":1725478936091},{"_id":"themes/landscape/languages/ru.yml","hash":"4fda301bbd8b39f2c714e2c934eccc4b27c0a2b0","modified":1725478936091},{"_id":"themes/landscape/languages/th-TH.yml","hash":"ebfdba9bc4842c829473c1e6e4544344f182724d","modified":1725478936091},{"_id":"themes/landscape/languages/th.yml","hash":"84a55b00aa01f03982be294e43c33a20e6d32862","modified":1725478936095},{"_id":"themes/landscape/languages/tr.yml","hash":"a1cdbfa17682d7a971de8ab8588bf57c74224b5b","modified":1725478936095},{"_id":"themes/landscape/languages/zh-CN.yml","hash":"1efd95774f401c80193eac6ee3f1794bfe93dc5a","modified":1725478936095},{"_id":"themes/landscape/languages/zh-TW.yml","hash":"53ce3000c5f767759c7d2c4efcaa9049788599c3","modified":1725478936095},{"_id":"themes/landscape/layout/archive.ejs","hash":"2703b07cc8ac64ae46d1d263f4653013c7e1666b","modified":1725478936095},{"_id":"themes/landscape/layout/category.ejs","hash":"765426a9c8236828dc34759e604cc2c52292835a","modified":1725478936095},{"_id":"themes/landscape/layout/index.ejs","hash":"aa1b4456907bdb43e629be3931547e2d29ac58c8","modified":1725478936095},{"_id":"themes/landscape/layout/layout.ejs","hash":"0d1765036e4874500e68256fedb7470e96eeb6ee","modified":1725478936095},{"_id":"themes/landscape/layout/page.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1725478936095},{"_id":"themes/landscape/layout/post.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1725478936095},{"_id":"themes/landscape/layout/tag.ejs","hash":"eaa7b4ccb2ca7befb90142e4e68995fb1ea68b2e","modified":1725478936095},{"_id":"themes/landscape/scripts/fancybox.js","hash":"c857d7a5e4a5d71c743a009c5932bf84229db428","modified":1725478936095},{"_id":"themes/landscape/.github/workflows/deploy.yml","hash":"509fdb4fff2078485a2765a1b685312c21e84e5b","modified":1725478936091},{"_id":"themes/landscape/layout/_partial/after-footer.ejs","hash":"1b89d0caba03a66a43d9c290a5e94fa438a89210","modified":1725478936095},{"_id":"themes/landscape/layout/_partial/archive-post.ejs","hash":"c7a71425a946d05414c069ec91811b5c09a92c47","modified":1725478936095},{"_id":"themes/landscape/layout/_partial/archive.ejs","hash":"7cb70a7a54f8c7ae49b10d1f37c0a9b74eab8826","modified":1725478936095},{"_id":"themes/landscape/layout/_partial/article.ejs","hash":"e9d4678e14be5e3cd5e34d783e5af6d6626092f5","modified":1725478936095},{"_id":"themes/landscape/layout/_partial/footer.ejs","hash":"3656eb692254346671abc03cb3ba1459829e0dce","modified":1725478936095},{"_id":"themes/landscape/layout/_partial/gauges-analytics.ejs","hash":"21a1e2a3907d1a3dad1cd0ab855fe6735f233c74","modified":1725478936095},{"_id":"themes/landscape/layout/_partial/google-analytics.ejs","hash":"2ea7442ea1e1a8ab4e41e26c563f58413b59a3d0","modified":1725478936095},{"_id":"themes/landscape/layout/_partial/head.ejs","hash":"0e94f5722d4c44d3cc91be2f4fd30b9ab503b868","modified":1725478936095},{"_id":"themes/landscape/layout/_partial/header.ejs","hash":"6a5033d189554c9a6d42e2ef7952ae5c9742648e","modified":1725478936095},{"_id":"themes/landscape/layout/_partial/mobile-nav.ejs","hash":"e952a532dfc583930a666b9d4479c32d4a84b44e","modified":1725478936095},{"_id":"themes/landscape/layout/_partial/sidebar.ejs","hash":"930da35cc2d447a92e5ee8f835735e6fd2232469","modified":1725478936095},{"_id":"themes/landscape/layout/_widget/archive.ejs","hash":"beb4a86fcc82a9bdda9289b59db5a1988918bec3","modified":1725478936095},{"_id":"themes/landscape/layout/_widget/category.ejs","hash":"dd1e5af3c6af3f5d6c85dfd5ca1766faed6a0b05","modified":1725478936095},{"_id":"themes/landscape/layout/_widget/recent_posts.ejs","hash":"60c4b012dcc656438ff59997e60367e5a21ab746","modified":1725478936095},{"_id":"themes/landscape/layout/_widget/tag.ejs","hash":"2de380865df9ab5f577f7d3bcadf44261eb5faae","modified":1725478936095},{"_id":"themes/landscape/layout/_widget/tagcloud.ejs","hash":"b4a2079101643f63993dcdb32925c9b071763b46","modified":1725478936095},{"_id":"themes/landscape/source/css/_extend.styl","hash":"222fbe6d222531d61c1ef0f868c90f747b1c2ced","modified":1725478936095},{"_id":"themes/landscape/source/css/_variables.styl","hash":"e4ea045c946056cf6012bc869ae296a70e5149df","modified":1725479970538},{"_id":"themes/landscape/source/css/style.styl","hash":"91e3de217aa13c41541172b1e607c4c7017419d5","modified":1725479725767},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.min.css","hash":"1be9b79be02a1cfc5d96c4a5e0feb8f472babd95","modified":1725478936099},{"_id":"themes/landscape/source/js/script.js","hash":"49773efcb2221bbdf2d86f3f5c5ff2d841b528cc","modified":1725478936099},{"_id":"themes/landscape/layout/_partial/post/category.ejs","hash":"c6bcd0e04271ffca81da25bcff5adf3d46f02fc0","modified":1725478936095},{"_id":"themes/landscape/layout/_partial/post/date.ejs","hash":"f1458584b679545830b75bef2526e2f3eb931045","modified":1725478936095},{"_id":"themes/landscape/layout/_partial/post/gallery.ejs","hash":"3d9d81a3c693ff2378ef06ddb6810254e509de5b","modified":1725478936095},{"_id":"themes/landscape/layout/_partial/post/nav.ejs","hash":"16a904de7bceccbb36b4267565f2215704db2880","modified":1725478936095},{"_id":"themes/landscape/layout/_partial/post/tag.ejs","hash":"2fcb0bf9c8847a644167a27824c9bb19ac74dd14","modified":1725478936095},{"_id":"themes/landscape/layout/_partial/post/title.ejs","hash":"4d7e62574ddf46de9b41605fe3140d77b5ddb26d","modified":1725478936095},{"_id":"themes/landscape/source/css/_partial/archive.styl","hash":"db15f5677dc68f1730e82190bab69c24611ca292","modified":1725478936095},{"_id":"themes/landscape/source/css/_partial/article.styl","hash":"589815ca86819b303c46bc3589d31a11d2f03a81","modified":1725480031326},{"_id":"themes/landscape/source/css/_partial/comment.styl","hash":"79d280d8d203abb3bd933ca9b8e38c78ec684987","modified":1725478936095},{"_id":"themes/landscape/source/css/_partial/footer.styl","hash":"e35a060b8512031048919709a8e7b1ec0e40bc1b","modified":1725478936095},{"_id":"themes/landscape/source/css/_partial/header.styl","hash":"f2a122faedb9f7318a356b68ad57cd2ede2de28e","modified":1725479909185},{"_id":"themes/landscape/source/css/_partial/highlight.styl","hash":"9cc3b2927d814f2f6e8e188f9d3657b94f4c6ef3","modified":1725478936095},{"_id":"themes/landscape/source/css/_partial/mobile.styl","hash":"a399cf9e1e1cec3e4269066e2948d7ae5854d745","modified":1725478936095},{"_id":"themes/landscape/source/css/_partial/sidebar-aside.styl","hash":"a87dfeaa3ed7c15e33ce244a7f429c1cdec7dda3","modified":1725480105951},{"_id":"themes/landscape/source/css/_partial/sidebar-bottom.styl","hash":"8fd4f30d319542babfd31f087ddbac550f000a8a","modified":1725478936095},{"_id":"themes/landscape/source/css/_partial/sidebar.styl","hash":"404ec059dc674a48b9ab89cd83f258dec4dcb24d","modified":1725478936095},{"_id":"themes/landscape/source/css/_util/grid.styl","hash":"0bf55ee5d09f193e249083602ac5fcdb1e571aed","modified":1725478936095},{"_id":"themes/landscape/source/css/_util/mixin.styl","hash":"44f32767d9fd3c1c08a60d91f181ee53c8f0dbb3","modified":1725478936095},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.min.js","hash":"6181412e73966696d08e1e5b1243a572d0f22ba6","modified":1725478936099},{"_id":"themes/landscape/source/js/jquery-3.6.4.min.js","hash":"eda46747c71d38a880bee44f9a439c3858bb8f99","modified":1725478936099},{"_id":"themes/landscape/source/css/images/banner.jpg","hash":"f44aa591089fcb3ec79770a1e102fd3289a7c6a6","modified":1725478936099},{"_id":"source/About/index.md","hash":"a0151f25c0aa81568983c8ca87f3dc8445943239","modified":1725480194680},{"_id":"source/about/index.md","hash":"c6d761803520c78cb61ee4c2e7916aabe2b892cc","modified":1725480317665},{"_id":"source/images/favicon.png","hash":"aa95a83cf692e0bc7c06a289f45ef5d2bb8e44a3","modified":1725480594940}],"Category":[{"name":"PHP","_id":"cm0o8awtq0003trsmhkvbgjzi"},{"name":"PHP7.4","parent":"cm0o8awtq0003trsmhkvbgjzi","_id":"cm0o8awtr0005trsm9rk9a17l"},{"name":"Debugging","_id":"cm0o8awts0008trsmhkf7bae3"}],"Data":[],"Page":[{"title":"Hi there ðŸ‘‹!","date":"2024-09-04T20:03:42.000Z","_content":"\n### I'm Alex, software plumber by day, author by night!\n\n[![wakatime](https://wakatime.com/badge/user/3bdf9c13-0e6a-4d8d-a733-589997da9ff4.svg)](https://wakatime.com/@3bdf9c13-0e6a-4d8d-a733-589997da9ff4)\n\nHello! I am Alexandros Koutroulis, a seasoned PHP developer from Greece, currently working for [Epignosis Learning Technologies](https://www.epignosishq.com/)! I also write short or longer stories, for the harsh side of reality, we all have experienced at a point in our lives. \n\n- ðŸŒ± Iâ€™m currently learning AWS, Modern Javascript & Typescript. Welcome to the 21st century!\n- ðŸ¤” I wrote my first lines of code in VB4.0, back in 1995. Damn, that's a lifetime ago!\n- ðŸ’¬ Ask me about anything. If it's computer related, I will probably have a story to share. \n- ðŸ“« How to reach me: [LinkedIn](https://www.linkedin.com/in/akoutroulis/)\n","source":"about/index.md","raw":"---\ntitle: Hi there ðŸ‘‹!\ndate: 2024-09-04 23:03:42\n---\n\n### I'm Alex, software plumber by day, author by night!\n\n[![wakatime](https://wakatime.com/badge/user/3bdf9c13-0e6a-4d8d-a733-589997da9ff4.svg)](https://wakatime.com/@3bdf9c13-0e6a-4d8d-a733-589997da9ff4)\n\nHello! I am Alexandros Koutroulis, a seasoned PHP developer from Greece, currently working for [Epignosis Learning Technologies](https://www.epignosishq.com/)! I also write short or longer stories, for the harsh side of reality, we all have experienced at a point in our lives. \n\n- ðŸŒ± Iâ€™m currently learning AWS, Modern Javascript & Typescript. Welcome to the 21st century!\n- ðŸ¤” I wrote my first lines of code in VB4.0, back in 1995. Damn, that's a lifetime ago!\n- ðŸ’¬ Ask me about anything. If it's computer related, I will probably have a story to share. \n- ðŸ“« How to reach me: [LinkedIn](https://www.linkedin.com/in/akoutroulis/)\n","updated":"2024-09-04T20:05:17.665Z","path":"about/index.html","_id":"cm0oaetum0000pmsm1gsx3kyg","comments":1,"layout":"page","content":"<h3 id=\"Iâ€™m-Alex-software-plumber-by-day-author-by-night\"><a href=\"#Iâ€™m-Alex-software-plumber-by-day-author-by-night\" class=\"headerlink\" title=\"Iâ€™m Alex, software plumber by day, author by night!\"></a>Iâ€™m Alex, software plumber by day, author by night!</h3><p><a href=\"https://wakatime.com/@3bdf9c13-0e6a-4d8d-a733-589997da9ff4\"><img src=\"https://wakatime.com/badge/user/3bdf9c13-0e6a-4d8d-a733-589997da9ff4.svg\" alt=\"wakatime\"></a></p>\n<p>Hello! I am Alexandros Koutroulis, a seasoned PHP developer from Greece, currently working for <a href=\"https://www.epignosishq.com/\">Epignosis Learning Technologies</a>! I also write short or longer stories, for the harsh side of reality, we all have experienced at a point in our lives. </p>\n<ul>\n<li>ðŸŒ± Iâ€™m currently learning AWS, Modern Javascript &amp; Typescript. Welcome to the 21st century!</li>\n<li>ðŸ¤” I wrote my first lines of code in VB4.0, back in 1995. Damn, thatâ€™s a lifetime ago!</li>\n<li>ðŸ’¬ Ask me about anything. If itâ€™s computer related, I will probably have a story to share. </li>\n<li>ðŸ“« How to reach me: <a href=\"https://www.linkedin.com/in/akoutroulis/\">LinkedIn</a></li>\n</ul>\n","excerpt":"","more":"<h3 id=\"Iâ€™m-Alex-software-plumber-by-day-author-by-night\"><a href=\"#Iâ€™m-Alex-software-plumber-by-day-author-by-night\" class=\"headerlink\" title=\"Iâ€™m Alex, software plumber by day, author by night!\"></a>Iâ€™m Alex, software plumber by day, author by night!</h3><p><a href=\"https://wakatime.com/@3bdf9c13-0e6a-4d8d-a733-589997da9ff4\"><img src=\"https://wakatime.com/badge/user/3bdf9c13-0e6a-4d8d-a733-589997da9ff4.svg\" alt=\"wakatime\"></a></p>\n<p>Hello! I am Alexandros Koutroulis, a seasoned PHP developer from Greece, currently working for <a href=\"https://www.epignosishq.com/\">Epignosis Learning Technologies</a>! I also write short or longer stories, for the harsh side of reality, we all have experienced at a point in our lives. </p>\n<ul>\n<li>ðŸŒ± Iâ€™m currently learning AWS, Modern Javascript &amp; Typescript. Welcome to the 21st century!</li>\n<li>ðŸ¤” I wrote my first lines of code in VB4.0, back in 1995. Damn, thatâ€™s a lifetime ago!</li>\n<li>ðŸ’¬ Ask me about anything. If itâ€™s computer related, I will probably have a story to share. </li>\n<li>ðŸ“« How to reach me: <a href=\"https://www.linkedin.com/in/akoutroulis/\">LinkedIn</a></li>\n</ul>\n"}],"Post":[{"title":"Extreme Debugging in PHP","date":"2022-12-01T20:02:54.000Z","comments":1,"_content":"\nIt was one of those akward, lonely and quiet nights. I could not tell what [Spotify](https://open.spotify.com/track/0nMKVMCXCmRplsKKLt1TTh) was playing, nor what time it was. My eyes were fixed on my terminal's cursor. It was blinking, constantly blinking, like it was taunting me.\n\nSome of my tests were crashing, unexpectedly, while PHPUnit was trying to generate coverage. There was no exception, no error, no nothing. Coverage was never created and the process was exiting with code `143`.\n\nWhat the actual ðŸ¤¬?\n\nSo, first things first. How can you debug your tests, or even PHPUnit in such a case? The answer is easy. You donâ€™t because you canâ€™t. Such behavior alludes that something quite sinister lurks in your code. Something that crashes deep inside PHPâ€™s code. A statement, whose existence, creates a fatal error.\n\nBut we arenâ€™t here to talk about what you canâ€™t do. We are here to talk about what you can, actually, do.\n\n## You can debug PHP\n\nIâ€™ve lost count how many times I stumbled across a similar issue. Normally, I would totally ignore the issue. I would try my tests one by one in order to determine which one is the problematic. I would surrender, had I not been able to pinpoint the problematic piece of code. But I am not that person and I suspect that you arenâ€™t that person as well. Soâ€¦ Letâ€™s debug it.\n\nFor starters, you canâ€™t debug PHP with pre-compiled PHP binaries. You have to properly configure and compile your own binaries! And since weâ€™ll need a whole toolchain for this, letâ€™s Dockerize it.\n\n> Iâ€™m using Debian for this Docker image, but feel free to use the linux flavor you prefer.\n\n## ðŸ‘¶ Baby Steps\n\n```dockerfile\nFROM debian:bullseye-slim\nWORKDIR /php\n```\n\nWe, obviously, need to install the minimum set of dependencies to build PHP, so letâ€™s have a look at the [official repo](https://github.com/php/php-src#readme):\n\n```dockerfile\nRUN apt-get update && apt-get install -y pkg-config build-essential \\\n    autoconf bison re2c libxml2-dev libsqlite3-dev\n```\n\nWe need to fetch the source for the PHP version we want to build. Luckily, we will not have to `git clone` PHPâ€™s repo, since PHP offers source code [downloads](https://www.php.net/downloads.php) in their page. Weâ€™ll use PHP 7.4.33 and we need a way to download it into our image. Unfortunately `wget` is not installed in `bullseye-slim` so weâ€™ll have to `apt-get` it as well.\n\nSo, weâ€™ll go to the previous step where we are fetching PHPâ€™s dependencies and weâ€™ll add `wget` as well.\n\nAfter doing so, we are ready to download PHP:\n\n```dockerfile\nRUN wget -nv https://www.php.net/distributions/php-7.4.33.tar.gz && \\\n    tar xzf php-7.4.33.tar.gz\nWORKDIR /php/php-7.4.33\n```\n\nWe have downloaded, extracted and cdâ€™d into PHPâ€™s source! Now what? Weâ€™ll have to generate the configuration and configure the build prior to compiling:\n\n```dockerfile\nRUN ./buildconf -f\n```\n\nAt this point, we are ready to configure and compile PHP 7.4.33. However, this isnâ€™t a simple, copy snippet / paste snippet, case.\n\n1. You have to know how you want to configure your binaries.\n2. You have to know which PHP extensions your code requires.\n3. You have to know whether to enable or disable something.\n\nAnd this is a process of thinking, reading, trying and failing, until you succeed.\n\nSo, build your image, create a container and open a shell into it. Your working directory will be the one where PHPâ€™s sources lie. Type `./configure --help | more` and read through the extensive list of configuration options. A minimum debug build requires the flag `--enable-debug`.\n\nHowever, in my case, and most probably in yours as well, youâ€™ll need some other stuff too. Such as cURL, sockets or intl. And in order to set up these, youâ€™ll have some [fun](https://dwarffortresswiki.org/index.php/DF2014:Losing).\n\n## ðŸ› ï¸ Configuring and Building PHP\n\nMake a list of the extensions you need included and features you need enabled (or disabled). **DO NOT ADD THE CONFIGURE OPTIONS TO THE DOCKERFILE, YET.**\n\n> I repeat, DO NOT ADD THEM TO THE DOCKERFILE, YET!\n\nYou remember me telling you, to open a shell into the container you built? The reason you need it, is because you will have to **fetch the extensionsâ€™ dependencies**.\n\n> Didnâ€™t I tell you that this is going to be fun?\n\n```shell\n./configure --enable-fpm \\\n    --enable-debug \\\n    --with-openssl \\\n    --with-zlib \\\n    --with-curl \\\n    --enable-gd \\\n    --with-gettext \\\n    --enable-intl \\\n    --with-ldap \\\n    --with-mysqli \\\n    --enable-pcntl \\\n    --enable-sockets \\\n    --enable-sysvmsg \\\n    --with-xsl \\\n    --with-zip \\\n    --enable-mbstring \\\n    --with-pdo-mysql \\\n    --disable-short-tags\n```\n\nThe configure script is going to perform some checks and crash at some point or another, complaining about not being able to find some development dependencies. If it canâ€™t find `ldap` youâ€™ll probably have to `apt-get install libldap-dev`. If it canâ€™t find Oniguruma, youâ€™ll (not obviously, but probably) have to install `libonig-dev`. Rinse and repeat. Use common sense, apt-cache search and Google, in order to determine what you actually need.\n\nWhen you have gathered every package you have to install, youâ€™ll have to modify your Dockerfile so that they get fetched, before you even attempt to configure PHP.\n\nBefore venturing forth, run a `make clean && make -j${nproc} && make install`. Just in case. If everything went well, `php -v` should give you output, stating itâ€™s version and that it is a `NTS DEBUG` build.\n\n> #EverythingIsAwesome.\n\nAt this point, weâ€™ll also need xdebug. You know the drill. Grab its source in `tar.gz` format from xdebugâ€™s downloads page, bring it into the container and extract it is its own directory. `phpize`, `configure`, `make`.\n\nWhen everything is tested in the container you are working, you should move everything into your Dockerfile. It should look something like this:\n\n```dockerfile\nFROM debian:bullseye-slim\n\nRUN apt-get update && \\\n    apt-get upgrade && \\\n    apt-get install pkg-config build-essential autoconf bison re2c wget gdb \\\n    libxml2-dev libsqlite3-dev libonig-dev libz-dev \\\n    libssl-dev libcurl4-openssl-dev libzip-dev libpng-dev \\\n    libldap-dev libxslt-dev\n\nWORKDIR /php\n# Download PHP & xdebug\nRUN wget -nv https://www.php.net/distributions/php-7.4.33.tar.gz && \\\n    tar xzf php-7.4.33.tar.gz && \\\n    wget -nv https://xdebug.org/files/xdebug-3.1.6.tgz && \\\n    tar xzf xdebug-3.1.6.tgz\n\n# Build PHP\nWORKDIR /php/php-7.4.33\n\nRUN mkdir -p /usr/local/etc/php/conf.d/\n\nRUN ./buildconf -f && \\\n    ./configure --enable-fpm \\\n    --enable-debug \\\n    --with-openssl \\\n    --with-zlib \\\n    --with-curl \\\n    --enable-gd \\\n    --with-gettext \\\n    --enable-intl \\\n    --with-ldap \\\n    --with-mysqli \\\n    --enable-pcntl \\\n    --enable-sockets \\\n    --enable-sysvmsg \\\n    --with-xsl \\\n    --with-zip \\\n    --enable-mbstring \\\n    --with-pdo-mysql \\\n    --disable-short-tags \\\n    --with-config-file-scan-dir=/usr/local/etc/php/conf.d/ && \\\n    make clean && \\\n    make -j${nproc} && \\\n    make install\n\n# Build xdebug\nWORKDIR /php/xdebug-3.1.6\n\nRUN phpize && \\\n    ./configure --enable-xdebug && \\\n    make -j${nproc} && \\\n    make install\n\nRUN mkdir -p /var/www/html/\n\nWORKDIR /var/www/html\n```\n\n## Itâ€™s party time! ðŸ¥³\n\nIf you are observant enough, youâ€™ll already have noticed that I added [`gdb`](https://en.wikipedia.org/wiki/GNU_Debugger) in the packages I am fetching into our image. Weâ€™ll need the GNU debugger in order to make PHP crash, then investigate why it crashed.\n\nBut before even attempting this, weâ€™ll have to properly configure PHP. php.ini and the likes.\n\nYouâ€™ll need, at least, to increase the `memory_limit`, to enable xdebug and to set `xdebug.mode` to `coverage`. If you are still reading me, youâ€™ll probably have guessed (correctly) that Iâ€™ll tell you to **R**ead **T**he **F**ine **M**anual, on how to do such things. Yes, I know that you can spam `-d` flags to PHP, however I highly suggest to craft a `php.ini` and an `xdebug.ini` (and each and every other .ini for each and every other extension you need configured).\n\nAnd (not only that, but mostly) that is the reason, you will definately need a `docker-compose.yaml`. Youâ€™ll have to mount your project at `/var/www/html` and youâ€™ll have to mount the directory containing your PHP configuration at `/usr/local/etc/php/conf.d/`\n\nIs your container ready yet?\n\n![I must find why it crashes. GDB PHP](images/php-gdb.jpeg)\n\nOpen a shell into itâ€¦\n\n<hr/>\n\nI cannot say that I am a debugging expert, nor that I navigate through gdbâ€™s commands with ease. I usually work on a _need-to-know_ basis; Google is my best friend. So, unfortunately, this cannot be a gdb tutorial. But I can, at this point, give you some insight into whatâ€™s going on.\n\nAssuming that everything went fine, your cursor should be blinking and waiting to do thy bidding. Type `gdb php` in order to load PHP into the debugger and watch the cursor blink again. Weâ€™ll actually need to run something. In my case I have to `r ./vendor/bin/phpunit --coverage-clover=clover.xml`\n\n> # And it crashedâ€¦ ðŸ¤¬\n\nNow, weâ€™ll have to figure out why it crashes. Letâ€™s type `bt` in order to examine the [stack](https://en.wikipedia.org/wiki/Call_stack)â€¦ Get a [cheat sheet](https://gist.github.com/rkubik/b96c23bd8ed58333de37f2b8cd052c30#file-cheat_sheet-txt-L18) and happy hunting!\n\n<hr/>\n\nIt took me hours to understand what the problem was. PHP was actually trying to perform an invalid operation. I not only had to examine the stack and functionsâ€™ parameters. I had PHPâ€™s source code, side by side with my debugger, trying to understand what each line was doing.\n\nEventually, after hours and hours of examing the values of structures and pointers, reading through C code and trying to follow the execution path, I pinpointed the source of all evil. It was a relatively safe `shell_exec`, hidden in a destructor. It seems that, somehow; donâ€™t ask, I never understood; PHP tried to execute this destructor and then all hell broke loose.\n\nMoral of the story? I should have listened to [Psalm](https://psalm.dev/), when it warned me that this piece of code was [forbidden](https://psalm.dev/docs/running_psalm/issues/ForbiddenCode/)...\n","source":"_posts/Extreme-Debugging-in-PHP.md","raw":"---\ntitle: Extreme Debugging in PHP\ndate: 2022-12-01 22:02:54\ntags: \n    - php\n    - docker\n    - debugging\n    - gdb\ncomments: true\ncategories: \n    - [PHP, PHP7.4]\n    - Debugging\n---\n\nIt was one of those akward, lonely and quiet nights. I could not tell what [Spotify](https://open.spotify.com/track/0nMKVMCXCmRplsKKLt1TTh) was playing, nor what time it was. My eyes were fixed on my terminal's cursor. It was blinking, constantly blinking, like it was taunting me.\n\nSome of my tests were crashing, unexpectedly, while PHPUnit was trying to generate coverage. There was no exception, no error, no nothing. Coverage was never created and the process was exiting with code `143`.\n\nWhat the actual ðŸ¤¬?\n\nSo, first things first. How can you debug your tests, or even PHPUnit in such a case? The answer is easy. You donâ€™t because you canâ€™t. Such behavior alludes that something quite sinister lurks in your code. Something that crashes deep inside PHPâ€™s code. A statement, whose existence, creates a fatal error.\n\nBut we arenâ€™t here to talk about what you canâ€™t do. We are here to talk about what you can, actually, do.\n\n## You can debug PHP\n\nIâ€™ve lost count how many times I stumbled across a similar issue. Normally, I would totally ignore the issue. I would try my tests one by one in order to determine which one is the problematic. I would surrender, had I not been able to pinpoint the problematic piece of code. But I am not that person and I suspect that you arenâ€™t that person as well. Soâ€¦ Letâ€™s debug it.\n\nFor starters, you canâ€™t debug PHP with pre-compiled PHP binaries. You have to properly configure and compile your own binaries! And since weâ€™ll need a whole toolchain for this, letâ€™s Dockerize it.\n\n> Iâ€™m using Debian for this Docker image, but feel free to use the linux flavor you prefer.\n\n## ðŸ‘¶ Baby Steps\n\n```dockerfile\nFROM debian:bullseye-slim\nWORKDIR /php\n```\n\nWe, obviously, need to install the minimum set of dependencies to build PHP, so letâ€™s have a look at the [official repo](https://github.com/php/php-src#readme):\n\n```dockerfile\nRUN apt-get update && apt-get install -y pkg-config build-essential \\\n    autoconf bison re2c libxml2-dev libsqlite3-dev\n```\n\nWe need to fetch the source for the PHP version we want to build. Luckily, we will not have to `git clone` PHPâ€™s repo, since PHP offers source code [downloads](https://www.php.net/downloads.php) in their page. Weâ€™ll use PHP 7.4.33 and we need a way to download it into our image. Unfortunately `wget` is not installed in `bullseye-slim` so weâ€™ll have to `apt-get` it as well.\n\nSo, weâ€™ll go to the previous step where we are fetching PHPâ€™s dependencies and weâ€™ll add `wget` as well.\n\nAfter doing so, we are ready to download PHP:\n\n```dockerfile\nRUN wget -nv https://www.php.net/distributions/php-7.4.33.tar.gz && \\\n    tar xzf php-7.4.33.tar.gz\nWORKDIR /php/php-7.4.33\n```\n\nWe have downloaded, extracted and cdâ€™d into PHPâ€™s source! Now what? Weâ€™ll have to generate the configuration and configure the build prior to compiling:\n\n```dockerfile\nRUN ./buildconf -f\n```\n\nAt this point, we are ready to configure and compile PHP 7.4.33. However, this isnâ€™t a simple, copy snippet / paste snippet, case.\n\n1. You have to know how you want to configure your binaries.\n2. You have to know which PHP extensions your code requires.\n3. You have to know whether to enable or disable something.\n\nAnd this is a process of thinking, reading, trying and failing, until you succeed.\n\nSo, build your image, create a container and open a shell into it. Your working directory will be the one where PHPâ€™s sources lie. Type `./configure --help | more` and read through the extensive list of configuration options. A minimum debug build requires the flag `--enable-debug`.\n\nHowever, in my case, and most probably in yours as well, youâ€™ll need some other stuff too. Such as cURL, sockets or intl. And in order to set up these, youâ€™ll have some [fun](https://dwarffortresswiki.org/index.php/DF2014:Losing).\n\n## ðŸ› ï¸ Configuring and Building PHP\n\nMake a list of the extensions you need included and features you need enabled (or disabled). **DO NOT ADD THE CONFIGURE OPTIONS TO THE DOCKERFILE, YET.**\n\n> I repeat, DO NOT ADD THEM TO THE DOCKERFILE, YET!\n\nYou remember me telling you, to open a shell into the container you built? The reason you need it, is because you will have to **fetch the extensionsâ€™ dependencies**.\n\n> Didnâ€™t I tell you that this is going to be fun?\n\n```shell\n./configure --enable-fpm \\\n    --enable-debug \\\n    --with-openssl \\\n    --with-zlib \\\n    --with-curl \\\n    --enable-gd \\\n    --with-gettext \\\n    --enable-intl \\\n    --with-ldap \\\n    --with-mysqli \\\n    --enable-pcntl \\\n    --enable-sockets \\\n    --enable-sysvmsg \\\n    --with-xsl \\\n    --with-zip \\\n    --enable-mbstring \\\n    --with-pdo-mysql \\\n    --disable-short-tags\n```\n\nThe configure script is going to perform some checks and crash at some point or another, complaining about not being able to find some development dependencies. If it canâ€™t find `ldap` youâ€™ll probably have to `apt-get install libldap-dev`. If it canâ€™t find Oniguruma, youâ€™ll (not obviously, but probably) have to install `libonig-dev`. Rinse and repeat. Use common sense, apt-cache search and Google, in order to determine what you actually need.\n\nWhen you have gathered every package you have to install, youâ€™ll have to modify your Dockerfile so that they get fetched, before you even attempt to configure PHP.\n\nBefore venturing forth, run a `make clean && make -j${nproc} && make install`. Just in case. If everything went well, `php -v` should give you output, stating itâ€™s version and that it is a `NTS DEBUG` build.\n\n> #EverythingIsAwesome.\n\nAt this point, weâ€™ll also need xdebug. You know the drill. Grab its source in `tar.gz` format from xdebugâ€™s downloads page, bring it into the container and extract it is its own directory. `phpize`, `configure`, `make`.\n\nWhen everything is tested in the container you are working, you should move everything into your Dockerfile. It should look something like this:\n\n```dockerfile\nFROM debian:bullseye-slim\n\nRUN apt-get update && \\\n    apt-get upgrade && \\\n    apt-get install pkg-config build-essential autoconf bison re2c wget gdb \\\n    libxml2-dev libsqlite3-dev libonig-dev libz-dev \\\n    libssl-dev libcurl4-openssl-dev libzip-dev libpng-dev \\\n    libldap-dev libxslt-dev\n\nWORKDIR /php\n# Download PHP & xdebug\nRUN wget -nv https://www.php.net/distributions/php-7.4.33.tar.gz && \\\n    tar xzf php-7.4.33.tar.gz && \\\n    wget -nv https://xdebug.org/files/xdebug-3.1.6.tgz && \\\n    tar xzf xdebug-3.1.6.tgz\n\n# Build PHP\nWORKDIR /php/php-7.4.33\n\nRUN mkdir -p /usr/local/etc/php/conf.d/\n\nRUN ./buildconf -f && \\\n    ./configure --enable-fpm \\\n    --enable-debug \\\n    --with-openssl \\\n    --with-zlib \\\n    --with-curl \\\n    --enable-gd \\\n    --with-gettext \\\n    --enable-intl \\\n    --with-ldap \\\n    --with-mysqli \\\n    --enable-pcntl \\\n    --enable-sockets \\\n    --enable-sysvmsg \\\n    --with-xsl \\\n    --with-zip \\\n    --enable-mbstring \\\n    --with-pdo-mysql \\\n    --disable-short-tags \\\n    --with-config-file-scan-dir=/usr/local/etc/php/conf.d/ && \\\n    make clean && \\\n    make -j${nproc} && \\\n    make install\n\n# Build xdebug\nWORKDIR /php/xdebug-3.1.6\n\nRUN phpize && \\\n    ./configure --enable-xdebug && \\\n    make -j${nproc} && \\\n    make install\n\nRUN mkdir -p /var/www/html/\n\nWORKDIR /var/www/html\n```\n\n## Itâ€™s party time! ðŸ¥³\n\nIf you are observant enough, youâ€™ll already have noticed that I added [`gdb`](https://en.wikipedia.org/wiki/GNU_Debugger) in the packages I am fetching into our image. Weâ€™ll need the GNU debugger in order to make PHP crash, then investigate why it crashed.\n\nBut before even attempting this, weâ€™ll have to properly configure PHP. php.ini and the likes.\n\nYouâ€™ll need, at least, to increase the `memory_limit`, to enable xdebug and to set `xdebug.mode` to `coverage`. If you are still reading me, youâ€™ll probably have guessed (correctly) that Iâ€™ll tell you to **R**ead **T**he **F**ine **M**anual, on how to do such things. Yes, I know that you can spam `-d` flags to PHP, however I highly suggest to craft a `php.ini` and an `xdebug.ini` (and each and every other .ini for each and every other extension you need configured).\n\nAnd (not only that, but mostly) that is the reason, you will definately need a `docker-compose.yaml`. Youâ€™ll have to mount your project at `/var/www/html` and youâ€™ll have to mount the directory containing your PHP configuration at `/usr/local/etc/php/conf.d/`\n\nIs your container ready yet?\n\n![I must find why it crashes. GDB PHP](images/php-gdb.jpeg)\n\nOpen a shell into itâ€¦\n\n<hr/>\n\nI cannot say that I am a debugging expert, nor that I navigate through gdbâ€™s commands with ease. I usually work on a _need-to-know_ basis; Google is my best friend. So, unfortunately, this cannot be a gdb tutorial. But I can, at this point, give you some insight into whatâ€™s going on.\n\nAssuming that everything went fine, your cursor should be blinking and waiting to do thy bidding. Type `gdb php` in order to load PHP into the debugger and watch the cursor blink again. Weâ€™ll actually need to run something. In my case I have to `r ./vendor/bin/phpunit --coverage-clover=clover.xml`\n\n> # And it crashedâ€¦ ðŸ¤¬\n\nNow, weâ€™ll have to figure out why it crashes. Letâ€™s type `bt` in order to examine the [stack](https://en.wikipedia.org/wiki/Call_stack)â€¦ Get a [cheat sheet](https://gist.github.com/rkubik/b96c23bd8ed58333de37f2b8cd052c30#file-cheat_sheet-txt-L18) and happy hunting!\n\n<hr/>\n\nIt took me hours to understand what the problem was. PHP was actually trying to perform an invalid operation. I not only had to examine the stack and functionsâ€™ parameters. I had PHPâ€™s source code, side by side with my debugger, trying to understand what each line was doing.\n\nEventually, after hours and hours of examing the values of structures and pointers, reading through C code and trying to follow the execution path, I pinpointed the source of all evil. It was a relatively safe `shell_exec`, hidden in a destructor. It seems that, somehow; donâ€™t ask, I never understood; PHP tried to execute this destructor and then all hell broke loose.\n\nMoral of the story? I should have listened to [Psalm](https://psalm.dev/), when it warned me that this piece of code was [forbidden](https://psalm.dev/docs/running_psalm/issues/ForbiddenCode/)...\n","slug":"Extreme-Debugging-in-PHP","published":1,"updated":"2024-09-04T19:23:41.872Z","_id":"cm0o8awtk0000trsm7wvtbkd6","layout":"post","photos":[],"content":"<p>It was one of those akward, lonely and quiet nights. I could not tell what <a href=\"https://open.spotify.com/track/0nMKVMCXCmRplsKKLt1TTh\">Spotify</a> was playing, nor what time it was. My eyes were fixed on my terminalâ€™s cursor. It was blinking, constantly blinking, like it was taunting me.</p>\n<p>Some of my tests were crashing, unexpectedly, while PHPUnit was trying to generate coverage. There was no exception, no error, no nothing. Coverage was never created and the process was exiting with code <code>143</code>.</p>\n<p>What the actual ðŸ¤¬?</p>\n<p>So, first things first. How can you debug your tests, or even PHPUnit in such a case? The answer is easy. You donâ€™t because you canâ€™t. Such behavior alludes that something quite sinister lurks in your code. Something that crashes deep inside PHPâ€™s code. A statement, whose existence, creates a fatal error.</p>\n<p>But we arenâ€™t here to talk about what you canâ€™t do. We are here to talk about what you can, actually, do.</p>\n<h2 id=\"You-can-debug-PHP\"><a href=\"#You-can-debug-PHP\" class=\"headerlink\" title=\"You can debug PHP\"></a>You can debug PHP</h2><p>Iâ€™ve lost count how many times I stumbled across a similar issue. Normally, I would totally ignore the issue. I would try my tests one by one in order to determine which one is the problematic. I would surrender, had I not been able to pinpoint the problematic piece of code. But I am not that person and I suspect that you arenâ€™t that person as well. Soâ€¦ Letâ€™s debug it.</p>\n<p>For starters, you canâ€™t debug PHP with pre-compiled PHP binaries. You have to properly configure and compile your own binaries! And since weâ€™ll need a whole toolchain for this, letâ€™s Dockerize it.</p>\n<blockquote>\n<p>Iâ€™m using Debian for this Docker image, but feel free to use the linux flavor you prefer.</p>\n</blockquote>\n<h2 id=\"ðŸ‘¶-Baby-Steps\"><a href=\"#ðŸ‘¶-Baby-Steps\" class=\"headerlink\" title=\"ðŸ‘¶ Baby Steps\"></a>ðŸ‘¶ Baby Steps</h2><figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">FROM</span> debian:bullseye-slim</span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /php</span></span><br></pre></td></tr></table></figure>\n\n<p>We, obviously, need to install the minimum set of dependencies to build PHP, so letâ€™s have a look at the <a href=\"https://github.com/php/php-src#readme\">official repo</a>:</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> apt-get update &amp;&amp; apt-get install -y pkg-config build-essential \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    autoconf bison re2c libxml2-dev libsqlite3-dev</span></span><br></pre></td></tr></table></figure>\n\n<p>We need to fetch the source for the PHP version we want to build. Luckily, we will not have to <code>git clone</code> PHPâ€™s repo, since PHP offers source code <a href=\"https://www.php.net/downloads.php\">downloads</a> in their page. Weâ€™ll use PHP 7.4.33 and we need a way to download it into our image. Unfortunately <code>wget</code> is not installed in <code>bullseye-slim</code> so weâ€™ll have to <code>apt-get</code> it as well.</p>\n<p>So, weâ€™ll go to the previous step where we are fetching PHPâ€™s dependencies and weâ€™ll add <code>wget</code> as well.</p>\n<p>After doing so, we are ready to download PHP:</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> wget -nv https://www.php.net/distributions/php-7.4.33.tar.gz &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    tar xzf php-7.4.33.tar.gz</span></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /php/php-7.4.33</span></span><br></pre></td></tr></table></figure>\n\n<p>We have downloaded, extracted and cdâ€™d into PHPâ€™s source! Now what? Weâ€™ll have to generate the configuration and configure the build prior to compiling:</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> ./buildconf -f</span></span><br></pre></td></tr></table></figure>\n\n<p>At this point, we are ready to configure and compile PHP 7.4.33. However, this isnâ€™t a simple, copy snippet &#x2F; paste snippet, case.</p>\n<ol>\n<li>You have to know how you want to configure your binaries.</li>\n<li>You have to know which PHP extensions your code requires.</li>\n<li>You have to know whether to enable or disable something.</li>\n</ol>\n<p>And this is a process of thinking, reading, trying and failing, until you succeed.</p>\n<p>So, build your image, create a container and open a shell into it. Your working directory will be the one where PHPâ€™s sources lie. Type <code>./configure --help | more</code> and read through the extensive list of configuration options. A minimum debug build requires the flag <code>--enable-debug</code>.</p>\n<p>However, in my case, and most probably in yours as well, youâ€™ll need some other stuff too. Such as cURL, sockets or intl. And in order to set up these, youâ€™ll have some <a href=\"https://dwarffortresswiki.org/index.php/DF2014:Losing\">fun</a>.</p>\n<h2 id=\"ðŸ› ï¸-Configuring-and-Building-PHP\"><a href=\"#ðŸ› ï¸-Configuring-and-Building-PHP\" class=\"headerlink\" title=\"ðŸ› ï¸ Configuring and Building PHP\"></a>ðŸ› ï¸ Configuring and Building PHP</h2><p>Make a list of the extensions you need included and features you need enabled (or disabled). <strong>DO NOT ADD THE CONFIGURE OPTIONS TO THE DOCKERFILE, YET.</strong></p>\n<blockquote>\n<p>I repeat, DO NOT ADD THEM TO THE DOCKERFILE, YET!</p>\n</blockquote>\n<p>You remember me telling you, to open a shell into the container you built? The reason you need it, is because you will have to <strong>fetch the extensionsâ€™ dependencies</strong>.</p>\n<blockquote>\n<p>Didnâ€™t I tell you that this is going to be fun?</p>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure --enable-fpm \\</span><br><span class=\"line\">    --enable-debug \\</span><br><span class=\"line\">    --with-openssl \\</span><br><span class=\"line\">    --with-zlib \\</span><br><span class=\"line\">    --with-curl \\</span><br><span class=\"line\">    --enable-gd \\</span><br><span class=\"line\">    --with-gettext \\</span><br><span class=\"line\">    --enable-intl \\</span><br><span class=\"line\">    --with-ldap \\</span><br><span class=\"line\">    --with-mysqli \\</span><br><span class=\"line\">    --enable-pcntl \\</span><br><span class=\"line\">    --enable-sockets \\</span><br><span class=\"line\">    --enable-sysvmsg \\</span><br><span class=\"line\">    --with-xsl \\</span><br><span class=\"line\">    --with-zip \\</span><br><span class=\"line\">    --enable-mbstring \\</span><br><span class=\"line\">    --with-pdo-mysql \\</span><br><span class=\"line\">    --disable-short-tags</span><br></pre></td></tr></table></figure>\n\n<p>The configure script is going to perform some checks and crash at some point or another, complaining about not being able to find some development dependencies. If it canâ€™t find <code>ldap</code> youâ€™ll probably have to <code>apt-get install libldap-dev</code>. If it canâ€™t find Oniguruma, youâ€™ll (not obviously, but probably) have to install <code>libonig-dev</code>. Rinse and repeat. Use common sense, apt-cache search and Google, in order to determine what you actually need.</p>\n<p>When you have gathered every package you have to install, youâ€™ll have to modify your Dockerfile so that they get fetched, before you even attempt to configure PHP.</p>\n<p>Before venturing forth, run a <code>make clean &amp;&amp; make -j$&#123;nproc&#125; &amp;&amp; make install</code>. Just in case. If everything went well, <code>php -v</code> should give you output, stating itâ€™s version and that it is a <code>NTS DEBUG</code> build.</p>\n<blockquote>\n<p>#EverythingIsAwesome.</p>\n</blockquote>\n<p>At this point, weâ€™ll also need xdebug. You know the drill. Grab its source in <code>tar.gz</code> format from xdebugâ€™s downloads page, bring it into the container and extract it is its own directory. <code>phpize</code>, <code>configure</code>, <code>make</code>.</p>\n<p>When everything is tested in the container you are working, you should move everything into your Dockerfile. It should look something like this:</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">FROM</span> debian:bullseye-slim</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> apt-get update &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    apt-get upgrade &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    apt-get install pkg-config build-essential autoconf bison re2c wget gdb \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    libxml2-dev libsqlite3-dev libonig-dev libz-dev \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    libssl-dev libcurl4-openssl-dev libzip-dev libpng-dev \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    libldap-dev libxslt-dev</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /php</span></span><br><span class=\"line\"><span class=\"comment\"># Download PHP &amp; xdebug</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> wget -nv https://www.php.net/distributions/php-7.4.33.tar.gz &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    tar xzf php-7.4.33.tar.gz &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    wget -nv https://xdebug.org/files/xdebug-3.1.6.tgz &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    tar xzf xdebug-3.1.6.tgz</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Build PHP</span></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /php/php-7.4.33</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> <span class=\"built_in\">mkdir</span> -p /usr/local/etc/php/conf.d/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> ./buildconf -f &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    ./configure --enable-fpm \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --enable-debug \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --with-openssl \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --with-zlib \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --with-curl \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --enable-gd \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --with-gettext \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --enable-intl \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --with-ldap \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --with-mysqli \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --enable-pcntl \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --enable-sockets \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --enable-sysvmsg \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --with-xsl \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --with-zip \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --enable-mbstring \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --with-pdo-mysql \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --disable-short-tags \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --with-config-file-scan-dir=/usr/local/etc/php/conf.d/ &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    make clean &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    make -j<span class=\"variable\">$&#123;nproc&#125;</span> &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    make install</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Build xdebug</span></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /php/xdebug-3.1.6</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> phpize &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    ./configure --enable-xdebug &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    make -j<span class=\"variable\">$&#123;nproc&#125;</span> &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    make install</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> <span class=\"built_in\">mkdir</span> -p /var/www/html/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /var/www/html</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Itâ€™s-party-time-ðŸ¥³\"><a href=\"#Itâ€™s-party-time-ðŸ¥³\" class=\"headerlink\" title=\"Itâ€™s party time! ðŸ¥³\"></a>Itâ€™s party time! ðŸ¥³</h2><p>If you are observant enough, youâ€™ll already have noticed that I added <a href=\"https://en.wikipedia.org/wiki/GNU_Debugger\"><code>gdb</code></a> in the packages I am fetching into our image. Weâ€™ll need the GNU debugger in order to make PHP crash, then investigate why it crashed.</p>\n<p>But before even attempting this, weâ€™ll have to properly configure PHP. php.ini and the likes.</p>\n<p>Youâ€™ll need, at least, to increase the <code>memory_limit</code>, to enable xdebug and to set <code>xdebug.mode</code> to <code>coverage</code>. If you are still reading me, youâ€™ll probably have guessed (correctly) that Iâ€™ll tell you to <strong>R</strong>ead <strong>T</strong>he <strong>F</strong>ine <strong>M</strong>anual, on how to do such things. Yes, I know that you can spam <code>-d</code> flags to PHP, however I highly suggest to craft a <code>php.ini</code> and an <code>xdebug.ini</code> (and each and every other .ini for each and every other extension you need configured).</p>\n<p>And (not only that, but mostly) that is the reason, you will definately need a <code>docker-compose.yaml</code>. Youâ€™ll have to mount your project at <code>/var/www/html</code> and youâ€™ll have to mount the directory containing your PHP configuration at <code>/usr/local/etc/php/conf.d/</code></p>\n<p>Is your container ready yet?</p>\n<p><img src=\"/images/php-gdb.jpeg\" alt=\"I must find why it crashes. GDB PHP\"></p>\n<p>Open a shell into itâ€¦</p>\n<hr/>\n\n<p>I cannot say that I am a debugging expert, nor that I navigate through gdbâ€™s commands with ease. I usually work on a <em>need-to-know</em> basis; Google is my best friend. So, unfortunately, this cannot be a gdb tutorial. But I can, at this point, give you some insight into whatâ€™s going on.</p>\n<p>Assuming that everything went fine, your cursor should be blinking and waiting to do thy bidding. Type <code>gdb php</code> in order to load PHP into the debugger and watch the cursor blink again. Weâ€™ll actually need to run something. In my case I have to <code>r ./vendor/bin/phpunit --coverage-clover=clover.xml</code></p>\n<blockquote>\n<h1 id=\"And-it-crashedâ€¦-ðŸ¤¬\"><a href=\"#And-it-crashedâ€¦-ðŸ¤¬\" class=\"headerlink\" title=\"And it crashedâ€¦ ðŸ¤¬\"></a>And it crashedâ€¦ ðŸ¤¬</h1></blockquote>\n<p>Now, weâ€™ll have to figure out why it crashes. Letâ€™s type <code>bt</code> in order to examine the <a href=\"https://en.wikipedia.org/wiki/Call_stack\">stack</a>â€¦ Get a <a href=\"https://gist.github.com/rkubik/b96c23bd8ed58333de37f2b8cd052c30#file-cheat_sheet-txt-L18\">cheat sheet</a> and happy hunting!</p>\n<hr/>\n\n<p>It took me hours to understand what the problem was. PHP was actually trying to perform an invalid operation. I not only had to examine the stack and functionsâ€™ parameters. I had PHPâ€™s source code, side by side with my debugger, trying to understand what each line was doing.</p>\n<p>Eventually, after hours and hours of examing the values of structures and pointers, reading through C code and trying to follow the execution path, I pinpointed the source of all evil. It was a relatively safe <code>shell_exec</code>, hidden in a destructor. It seems that, somehow; donâ€™t ask, I never understood; PHP tried to execute this destructor and then all hell broke loose.</p>\n<p>Moral of the story? I should have listened to <a href=\"https://psalm.dev/\">Psalm</a>, when it warned me that this piece of code was <a href=\"https://psalm.dev/docs/running_psalm/issues/ForbiddenCode/\">forbidden</a>â€¦</p>\n","excerpt":"","more":"<p>It was one of those akward, lonely and quiet nights. I could not tell what <a href=\"https://open.spotify.com/track/0nMKVMCXCmRplsKKLt1TTh\">Spotify</a> was playing, nor what time it was. My eyes were fixed on my terminalâ€™s cursor. It was blinking, constantly blinking, like it was taunting me.</p>\n<p>Some of my tests were crashing, unexpectedly, while PHPUnit was trying to generate coverage. There was no exception, no error, no nothing. Coverage was never created and the process was exiting with code <code>143</code>.</p>\n<p>What the actual ðŸ¤¬?</p>\n<p>So, first things first. How can you debug your tests, or even PHPUnit in such a case? The answer is easy. You donâ€™t because you canâ€™t. Such behavior alludes that something quite sinister lurks in your code. Something that crashes deep inside PHPâ€™s code. A statement, whose existence, creates a fatal error.</p>\n<p>But we arenâ€™t here to talk about what you canâ€™t do. We are here to talk about what you can, actually, do.</p>\n<h2 id=\"You-can-debug-PHP\"><a href=\"#You-can-debug-PHP\" class=\"headerlink\" title=\"You can debug PHP\"></a>You can debug PHP</h2><p>Iâ€™ve lost count how many times I stumbled across a similar issue. Normally, I would totally ignore the issue. I would try my tests one by one in order to determine which one is the problematic. I would surrender, had I not been able to pinpoint the problematic piece of code. But I am not that person and I suspect that you arenâ€™t that person as well. Soâ€¦ Letâ€™s debug it.</p>\n<p>For starters, you canâ€™t debug PHP with pre-compiled PHP binaries. You have to properly configure and compile your own binaries! And since weâ€™ll need a whole toolchain for this, letâ€™s Dockerize it.</p>\n<blockquote>\n<p>Iâ€™m using Debian for this Docker image, but feel free to use the linux flavor you prefer.</p>\n</blockquote>\n<h2 id=\"ðŸ‘¶-Baby-Steps\"><a href=\"#ðŸ‘¶-Baby-Steps\" class=\"headerlink\" title=\"ðŸ‘¶ Baby Steps\"></a>ðŸ‘¶ Baby Steps</h2><figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">FROM</span> debian:bullseye-slim</span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /php</span></span><br></pre></td></tr></table></figure>\n\n<p>We, obviously, need to install the minimum set of dependencies to build PHP, so letâ€™s have a look at the <a href=\"https://github.com/php/php-src#readme\">official repo</a>:</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> apt-get update &amp;&amp; apt-get install -y pkg-config build-essential \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    autoconf bison re2c libxml2-dev libsqlite3-dev</span></span><br></pre></td></tr></table></figure>\n\n<p>We need to fetch the source for the PHP version we want to build. Luckily, we will not have to <code>git clone</code> PHPâ€™s repo, since PHP offers source code <a href=\"https://www.php.net/downloads.php\">downloads</a> in their page. Weâ€™ll use PHP 7.4.33 and we need a way to download it into our image. Unfortunately <code>wget</code> is not installed in <code>bullseye-slim</code> so weâ€™ll have to <code>apt-get</code> it as well.</p>\n<p>So, weâ€™ll go to the previous step where we are fetching PHPâ€™s dependencies and weâ€™ll add <code>wget</code> as well.</p>\n<p>After doing so, we are ready to download PHP:</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> wget -nv https://www.php.net/distributions/php-7.4.33.tar.gz &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    tar xzf php-7.4.33.tar.gz</span></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /php/php-7.4.33</span></span><br></pre></td></tr></table></figure>\n\n<p>We have downloaded, extracted and cdâ€™d into PHPâ€™s source! Now what? Weâ€™ll have to generate the configuration and configure the build prior to compiling:</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> ./buildconf -f</span></span><br></pre></td></tr></table></figure>\n\n<p>At this point, we are ready to configure and compile PHP 7.4.33. However, this isnâ€™t a simple, copy snippet &#x2F; paste snippet, case.</p>\n<ol>\n<li>You have to know how you want to configure your binaries.</li>\n<li>You have to know which PHP extensions your code requires.</li>\n<li>You have to know whether to enable or disable something.</li>\n</ol>\n<p>And this is a process of thinking, reading, trying and failing, until you succeed.</p>\n<p>So, build your image, create a container and open a shell into it. Your working directory will be the one where PHPâ€™s sources lie. Type <code>./configure --help | more</code> and read through the extensive list of configuration options. A minimum debug build requires the flag <code>--enable-debug</code>.</p>\n<p>However, in my case, and most probably in yours as well, youâ€™ll need some other stuff too. Such as cURL, sockets or intl. And in order to set up these, youâ€™ll have some <a href=\"https://dwarffortresswiki.org/index.php/DF2014:Losing\">fun</a>.</p>\n<h2 id=\"ðŸ› ï¸-Configuring-and-Building-PHP\"><a href=\"#ðŸ› ï¸-Configuring-and-Building-PHP\" class=\"headerlink\" title=\"ðŸ› ï¸ Configuring and Building PHP\"></a>ðŸ› ï¸ Configuring and Building PHP</h2><p>Make a list of the extensions you need included and features you need enabled (or disabled). <strong>DO NOT ADD THE CONFIGURE OPTIONS TO THE DOCKERFILE, YET.</strong></p>\n<blockquote>\n<p>I repeat, DO NOT ADD THEM TO THE DOCKERFILE, YET!</p>\n</blockquote>\n<p>You remember me telling you, to open a shell into the container you built? The reason you need it, is because you will have to <strong>fetch the extensionsâ€™ dependencies</strong>.</p>\n<blockquote>\n<p>Didnâ€™t I tell you that this is going to be fun?</p>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure --enable-fpm \\</span><br><span class=\"line\">    --enable-debug \\</span><br><span class=\"line\">    --with-openssl \\</span><br><span class=\"line\">    --with-zlib \\</span><br><span class=\"line\">    --with-curl \\</span><br><span class=\"line\">    --enable-gd \\</span><br><span class=\"line\">    --with-gettext \\</span><br><span class=\"line\">    --enable-intl \\</span><br><span class=\"line\">    --with-ldap \\</span><br><span class=\"line\">    --with-mysqli \\</span><br><span class=\"line\">    --enable-pcntl \\</span><br><span class=\"line\">    --enable-sockets \\</span><br><span class=\"line\">    --enable-sysvmsg \\</span><br><span class=\"line\">    --with-xsl \\</span><br><span class=\"line\">    --with-zip \\</span><br><span class=\"line\">    --enable-mbstring \\</span><br><span class=\"line\">    --with-pdo-mysql \\</span><br><span class=\"line\">    --disable-short-tags</span><br></pre></td></tr></table></figure>\n\n<p>The configure script is going to perform some checks and crash at some point or another, complaining about not being able to find some development dependencies. If it canâ€™t find <code>ldap</code> youâ€™ll probably have to <code>apt-get install libldap-dev</code>. If it canâ€™t find Oniguruma, youâ€™ll (not obviously, but probably) have to install <code>libonig-dev</code>. Rinse and repeat. Use common sense, apt-cache search and Google, in order to determine what you actually need.</p>\n<p>When you have gathered every package you have to install, youâ€™ll have to modify your Dockerfile so that they get fetched, before you even attempt to configure PHP.</p>\n<p>Before venturing forth, run a <code>make clean &amp;&amp; make -j$&#123;nproc&#125; &amp;&amp; make install</code>. Just in case. If everything went well, <code>php -v</code> should give you output, stating itâ€™s version and that it is a <code>NTS DEBUG</code> build.</p>\n<blockquote>\n<p>#EverythingIsAwesome.</p>\n</blockquote>\n<p>At this point, weâ€™ll also need xdebug. You know the drill. Grab its source in <code>tar.gz</code> format from xdebugâ€™s downloads page, bring it into the container and extract it is its own directory. <code>phpize</code>, <code>configure</code>, <code>make</code>.</p>\n<p>When everything is tested in the container you are working, you should move everything into your Dockerfile. It should look something like this:</p>\n<figure class=\"highlight dockerfile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">FROM</span> debian:bullseye-slim</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> apt-get update &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    apt-get upgrade &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    apt-get install pkg-config build-essential autoconf bison re2c wget gdb \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    libxml2-dev libsqlite3-dev libonig-dev libz-dev \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    libssl-dev libcurl4-openssl-dev libzip-dev libpng-dev \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    libldap-dev libxslt-dev</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /php</span></span><br><span class=\"line\"><span class=\"comment\"># Download PHP &amp; xdebug</span></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> wget -nv https://www.php.net/distributions/php-7.4.33.tar.gz &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    tar xzf php-7.4.33.tar.gz &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    wget -nv https://xdebug.org/files/xdebug-3.1.6.tgz &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    tar xzf xdebug-3.1.6.tgz</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Build PHP</span></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /php/php-7.4.33</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> <span class=\"built_in\">mkdir</span> -p /usr/local/etc/php/conf.d/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> ./buildconf -f &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    ./configure --enable-fpm \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --enable-debug \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --with-openssl \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --with-zlib \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --with-curl \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --enable-gd \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --with-gettext \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --enable-intl \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --with-ldap \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --with-mysqli \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --enable-pcntl \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --enable-sockets \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --enable-sysvmsg \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --with-xsl \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --with-zip \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --enable-mbstring \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --with-pdo-mysql \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --disable-short-tags \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    --with-config-file-scan-dir=/usr/local/etc/php/conf.d/ &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    make clean &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    make -j<span class=\"variable\">$&#123;nproc&#125;</span> &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    make install</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Build xdebug</span></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /php/xdebug-3.1.6</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> phpize &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    ./configure --enable-xdebug &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    make -j<span class=\"variable\">$&#123;nproc&#125;</span> &amp;&amp; \\</span></span><br><span class=\"line\"><span class=\"language-bash\">    make install</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">RUN</span><span class=\"language-bash\"> <span class=\"built_in\">mkdir</span> -p /var/www/html/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">WORKDIR</span><span class=\"language-bash\"> /var/www/html</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Itâ€™s-party-time-ðŸ¥³\"><a href=\"#Itâ€™s-party-time-ðŸ¥³\" class=\"headerlink\" title=\"Itâ€™s party time! ðŸ¥³\"></a>Itâ€™s party time! ðŸ¥³</h2><p>If you are observant enough, youâ€™ll already have noticed that I added <a href=\"https://en.wikipedia.org/wiki/GNU_Debugger\"><code>gdb</code></a> in the packages I am fetching into our image. Weâ€™ll need the GNU debugger in order to make PHP crash, then investigate why it crashed.</p>\n<p>But before even attempting this, weâ€™ll have to properly configure PHP. php.ini and the likes.</p>\n<p>Youâ€™ll need, at least, to increase the <code>memory_limit</code>, to enable xdebug and to set <code>xdebug.mode</code> to <code>coverage</code>. If you are still reading me, youâ€™ll probably have guessed (correctly) that Iâ€™ll tell you to <strong>R</strong>ead <strong>T</strong>he <strong>F</strong>ine <strong>M</strong>anual, on how to do such things. Yes, I know that you can spam <code>-d</code> flags to PHP, however I highly suggest to craft a <code>php.ini</code> and an <code>xdebug.ini</code> (and each and every other .ini for each and every other extension you need configured).</p>\n<p>And (not only that, but mostly) that is the reason, you will definately need a <code>docker-compose.yaml</code>. Youâ€™ll have to mount your project at <code>/var/www/html</code> and youâ€™ll have to mount the directory containing your PHP configuration at <code>/usr/local/etc/php/conf.d/</code></p>\n<p>Is your container ready yet?</p>\n<p><img src=\"/images/php-gdb.jpeg\" alt=\"I must find why it crashes. GDB PHP\"></p>\n<p>Open a shell into itâ€¦</p>\n<hr/>\n\n<p>I cannot say that I am a debugging expert, nor that I navigate through gdbâ€™s commands with ease. I usually work on a <em>need-to-know</em> basis; Google is my best friend. So, unfortunately, this cannot be a gdb tutorial. But I can, at this point, give you some insight into whatâ€™s going on.</p>\n<p>Assuming that everything went fine, your cursor should be blinking and waiting to do thy bidding. Type <code>gdb php</code> in order to load PHP into the debugger and watch the cursor blink again. Weâ€™ll actually need to run something. In my case I have to <code>r ./vendor/bin/phpunit --coverage-clover=clover.xml</code></p>\n<blockquote>\n<h1 id=\"And-it-crashedâ€¦-ðŸ¤¬\"><a href=\"#And-it-crashedâ€¦-ðŸ¤¬\" class=\"headerlink\" title=\"And it crashedâ€¦ ðŸ¤¬\"></a>And it crashedâ€¦ ðŸ¤¬</h1></blockquote>\n<p>Now, weâ€™ll have to figure out why it crashes. Letâ€™s type <code>bt</code> in order to examine the <a href=\"https://en.wikipedia.org/wiki/Call_stack\">stack</a>â€¦ Get a <a href=\"https://gist.github.com/rkubik/b96c23bd8ed58333de37f2b8cd052c30#file-cheat_sheet-txt-L18\">cheat sheet</a> and happy hunting!</p>\n<hr/>\n\n<p>It took me hours to understand what the problem was. PHP was actually trying to perform an invalid operation. I not only had to examine the stack and functionsâ€™ parameters. I had PHPâ€™s source code, side by side with my debugger, trying to understand what each line was doing.</p>\n<p>Eventually, after hours and hours of examing the values of structures and pointers, reading through C code and trying to follow the execution path, I pinpointed the source of all evil. It was a relatively safe <code>shell_exec</code>, hidden in a destructor. It seems that, somehow; donâ€™t ask, I never understood; PHP tried to execute this destructor and then all hell broke loose.</p>\n<p>Moral of the story? I should have listened to <a href=\"https://psalm.dev/\">Psalm</a>, when it warned me that this piece of code was <a href=\"https://psalm.dev/docs/running_psalm/issues/ForbiddenCode/\">forbidden</a>â€¦</p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cm0o8awtk0000trsm7wvtbkd6","category_id":"cm0o8awtq0003trsmhkvbgjzi","_id":"cm0o8awtt000ctrsmfl89gmyi"},{"post_id":"cm0o8awtk0000trsm7wvtbkd6","category_id":"cm0o8awtr0005trsm9rk9a17l","_id":"cm0o8awtt000etrsmceur5kmm"},{"post_id":"cm0o8awtk0000trsm7wvtbkd6","category_id":"cm0o8awts0008trsmhkf7bae3","_id":"cm0o8awtt000ftrsm226yhg1v"}],"PostTag":[{"post_id":"cm0o8awtk0000trsm7wvtbkd6","tag_id":"cm0o8awtp0002trsm6cyk1ka3","_id":"cm0o8awts0009trsmbtx7fzio"},{"post_id":"cm0o8awtk0000trsm7wvtbkd6","tag_id":"cm0o8awtr0004trsmh2yi39t8","_id":"cm0o8awts000atrsm9ciye1ga"},{"post_id":"cm0o8awtk0000trsm7wvtbkd6","tag_id":"cm0o8awtr0006trsm0bhg7x3n","_id":"cm0o8awts000btrsmcj6w0qga"},{"post_id":"cm0o8awtk0000trsm7wvtbkd6","tag_id":"cm0o8awts0007trsm20by2t67","_id":"cm0o8awtt000dtrsmabhc6xp9"}],"Tag":[{"name":"php","_id":"cm0o8awtp0002trsm6cyk1ka3"},{"name":"docker","_id":"cm0o8awtr0004trsmh2yi39t8"},{"name":"debugging","_id":"cm0o8awtr0006trsm0bhg7x3n"},{"name":"gdb","_id":"cm0o8awts0007trsm20by2t67"}]}}