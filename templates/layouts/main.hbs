<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{title}} - Production Breaker</title>
    <link rel="stylesheet" href="/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
    /* small helpers outside of Tailwind for accessibility and responsive type */
    :root{--max-content-width:65ch}

    /* Responsive fluid type for body */
    html {font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;}
    body {font-size: clamp(15px, 1.6vw, 17px);}

    /* Focus visible custom (prefers reduced motion respected) */
    :focus {outline: none}
    :focus-visible{outline: 3px solid rgba(6,182,212,0.9); outline-offset: 3px}

    @media (prefers-reduced-motion: reduce){
      * {transition: none !important; animation: none !important}
    }

    /* Code block better defaults */
    pre {font-family: 'JetBrains Mono', ui-monospace, SFMono-Regular; font-size: 0.92rem}

    /* small utility for visually-hidden but available to screen readers */
    .sr-only {position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body class="bg-white text-slate-900 dark:bg-bg-01 dark:text-slate-100 leading-relaxed">

  <!-- Skip link -->
  <a class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:bg-white focus:px-3 focus:py-2 focus:rounded-md focus:ring-2 focus:ring-accent" href="#main">Skip to content</a>

  {{> header}}

  <main id="main" class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    {{{body}}}
  </main>

  {{> footer}}

  <!-- Live reload script -->
  <script>
    (function() {
      const ws = new WebSocket('ws://localhost:3000');
      ws.onmessage = function(event) {
        const data = JSON.parse(event.data);
        if (data.type === 'reload') {
          window.location.reload();
        }
      };
      ws.onclose = function() {
        // Reconnect after 1 second if connection is lost
        setTimeout(() => {
          window.location.reload();
        }, 1000);
      };
    })();
  </script>

  <!-- Minimal interactive scripts (accessible) -->
  <script>
    // mobile menu
    const mobileBtn = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileClose = document.getElementById('mobile-menu-close');
    mobileBtn && mobileBtn.addEventListener('click', () => {
      const expanded = mobileBtn.getAttribute('aria-expanded') === 'true';
      mobileBtn.setAttribute('aria-expanded', String(!expanded));
      mobileMenu.classList.toggle('hidden');
      mobileMenu.setAttribute('aria-hidden', mobileMenu.classList.contains('hidden'));
    });
    mobileClose && mobileClose.addEventListener('click', () => { mobileMenu.classList.add('hidden'); mobileBtn.setAttribute('aria-expanded', 'false'); });

    // theme toggle
    const themeToggle = document.getElementById('theme-toggle');
    const htmlEl = document.documentElement;
    const stored = localStorage.getItem('theme');
    if(stored === 'dark') htmlEl.classList.add('dark');
    themeToggle && themeToggle.addEventListener('click', () => {
      const isDark = htmlEl.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });

    // accessible copy-to-clipboard (example; full implementation should attach to each code block)
    function copyText(text){
      navigator.clipboard?.writeText(text).then(()=>{
        // announce success via aria-live region (not wired here for brevity)
      }).catch(()=>{ /* progressive enhancement fallback */ });
    }

    // make sure keyboard users can 'enter' on article cards
    document.querySelectorAll('article[tabindex]').forEach(a=>{
      a.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') a.querySelector('a')?.click(); });
    });
  </script>

</body>
</html>
