[["Map",1,2,9,10],"meta::meta",["Map",3,4,5,6,7,8],"astro-version","5.16.11","content-config-digest","1fc9591b21440065","astro-config-digest","{\"root\":{},\"srcDir\":{},\"publicDir\":{},\"outDir\":{},\"cacheDir\":{},\"site\":\"https://mistericy.github.io\",\"compressHTML\":true,\"base\":\"/\",\"trailingSlash\":\"ignore\",\"output\":\"static\",\"scopedStyleStrategy\":\"attribute\",\"build\":{\"format\":\"directory\",\"client\":{},\"server\":{},\"assets\":\"_astro\",\"serverEntry\":\"entry.mjs\",\"redirects\":true,\"inlineStylesheets\":\"auto\",\"concurrency\":1},\"server\":{\"open\":false,\"host\":false,\"port\":4321,\"streaming\":true,\"allowedHosts\":[]},\"redirects\":{},\"image\":{\"endpoint\":{\"route\":\"/_image\"},\"service\":{\"entrypoint\":\"astro/assets/services/sharp\",\"config\":{}},\"domains\":[],\"remotePatterns\":[],\"responsiveStyles\":false},\"devToolbar\":{\"enabled\":true},\"markdown\":{\"syntaxHighlight\":{\"type\":\"shiki\",\"excludeLangs\":[\"math\"]},\"shikiConfig\":{\"langs\":[],\"langAlias\":{},\"theme\":\"github-dark\",\"themes\":{},\"wrap\":false,\"transformers\":[]},\"remarkPlugins\":[],\"rehypePlugins\":[],\"remarkRehype\":{},\"gfm\":true,\"smartypants\":true},\"security\":{\"checkOrigin\":true,\"allowedDomains\":[]},\"env\":{\"schema\":{},\"validateSecrets\":false},\"experimental\":{\"clientPrerender\":false,\"contentIntellisense\":false,\"headingIdCompat\":false,\"preserveScriptOrder\":false,\"liveContentCollections\":false,\"csp\":false,\"staticImportMetaEnv\":false,\"chromeDevtoolsWorkspace\":false,\"failOnPrerenderConflict\":false,\"svgo\":false},\"legacy\":{\"collections\":false}}","blog",["Map",11,12,79,80,153,154,225,226],"extreme-debugging-in-php",{"id":11,"data":13,"body":42,"filePath":43,"assetImports":44,"digest":46,"rendered":47},{"title":14,"description":15,"pubDate":16,"updatedDate":17,"heroImage":18,"tags":19,"category":21,"excerpt":30,"keywords":31},"Extreme PHP Debugging: GDB & Docker Guide","Learn how to debug PHP crashes using custom debug binaries, Docker, and GDB. Master extreme PHP debugging techniques when standard tools fail.",["Date","2022-12-01T00:00:00.000Z"],["Date","2026-01-18T00:00:00.000Z"],"__ASTRO_IMAGE_../../assets/php-gdb.webp",[20,21,22,23,24,25,26,27,28,29],"PHP","Debugging","GDB","Docker","PHPUnit","xdebug","Software Engineering","Troubleshooting","PHP Development","Advanced Debugging","When PHPUnit crashes with exit code 143 and coverage generation fails silently, standard debugging tools won\\'t help. Learn how to build custom PHP debug binaries, use GDB to trace crashes, and debug deep PHP internals using Docker, custom builds, and advanced debugging techniques.\n",[32,33,34,35,36,37,38,39,40,41],"PHP debugging","GDB PHP","PHP debug binaries","Docker PHP debugging","PHPUnit debugging","PHP crash debugging","xdebug configuration","PHP custom build","PHP internals debugging","advanced PHP debugging","It was one of those awkward, lonely and quiet nights. I could not tell what [Spotify](https://open.spotify.com/track/0nMKVMCXCmRplsKKLt1TTh) was playing, nor what time it was. My eyes were fixed on my terminal's cursor. It was blinking, constantly blinking, like it was taunting me.\n\nSome of my PHPUnit tests were crashing unexpectedly while trying to generate code coverage. There was no exception, no error message, no stack traceâ€”nothing. The coverage report was never created and the PHP process was exiting silently with code `143`.\n\nWhat the actual ðŸ¤¬?\n\nThis is a story about **extreme PHP debugging**â€”when standard PHP debugging tools fail and you need to dive deep into PHP's internals using custom debug binaries, Docker containers, and the GNU Debugger (GDB) to track down crashes that occur at the C level.\n\nSo, first things first. How can you debug your tests, or even PHPUnit in such a case? The answer is easy. You donâ€™t because you canâ€™t. Such behavior alludes that something quite sinister lurks in your code. Something that crashes deep inside PHPâ€™s code. A statement, whose existence, creates a fatal error.\n\nBut we arenâ€™t here to talk about what you canâ€™t do. We are here to talk about what you can, actually, do.\n\n## Advanced PHP Debugging Techniques\n\nIâ€™ve lost count how many times I stumbled across a similar issue. Normally, I would totally ignore the issue. I would try my tests one by one in order to determine which one is the problematic. I would surrender, had I not been able to pinpoint the problematic piece of code. But I am not that person and I suspect that you arenâ€™t that person as well. Soâ€¦ Letâ€™s debug it.\n\nFor starters, you canâ€™t debug PHP with pre-compiled PHP binaries. You have to properly configure and compile your own binaries! And since weâ€™ll need a whole toolchain for this, letâ€™s Dockerize it.\n\n> Iâ€™m using Debian for this Docker image, but feel free to use the linux flavor you prefer.\n\n## ðŸ‘¶ Baby Steps\n\n```dockerfile\nFROM debian:bullseye-slim\nWORKDIR /php\n```\n\nWe, obviously, need to install the minimum set of dependencies to build PHP, so letâ€™s have a look at the [official repo](https://github.com/php/php-src#readme):\n\n```dockerfile\nRUN apt-get update && apt-get install -y pkg-config build-essential \\\n    autoconf bison re2c libxml2-dev libsqlite3-dev\n```\n\nWe need to fetch the source for the PHP version we want to build. Luckily, we will not have to `git clone` PHPâ€™s repo, since PHP offers source code [downloads](https://www.php.net/downloads.php) in their page. Weâ€™ll use PHP 7.4.33 and we need a way to download it into our image. Unfortunately `wget` is not installed in `bullseye-slim` so weâ€™ll have to `apt-get` it as well.\n\nSo, weâ€™ll go to the previous step where we are fetching PHPâ€™s dependencies and weâ€™ll add `wget` as well.\n\nAfter doing so, we are ready to download PHP:\n\n```dockerfile\nRUN wget -nv https://www.php.net/distributions/php-7.4.33.tar.gz && \\\n    tar xzf php-7.4.33.tar.gz\nWORKDIR /php/php-7.4.33\n```\n\nWe have downloaded, extracted and cdâ€™d into PHPâ€™s source! Now what? Weâ€™ll have to generate the configuration and configure the build prior to compiling:\n\n```dockerfile\nRUN ./buildconf -f\n```\n\nAt this point, we are ready to configure and compile PHP 7.4.33. However, this isnâ€™t a simple, copy snippet / paste snippet, case.\n\n1. You have to know how you want to configure your binaries.\n2. You have to know which PHP extensions your code requires.\n3. You have to know whether to enable or disable something.\n\nAnd this is a process of thinking, reading, trying and failing, until you succeed.\n\nSo, build your image, create a container and open a shell into it. Your working directory will be the one where PHPâ€™s sources lie. Type `./configure --help | more` and read through the extensive list of configuration options. A minimum debug build requires the flag `--enable-debug`.\n\nHowever, in my case, and most probably in yours as well, youâ€™ll need some other stuff too. Such as cURL, sockets or intl. And in order to set up these, youâ€™ll have some [fun](https://dwarffortresswiki.org/index.php/DF2014:Losing).\n\n## ðŸ› ï¸ Configuring and Building PHP\n\nMake a list of the extensions you need included and features you need enabled (or disabled). **DO NOT ADD THE CONFIGURE OPTIONS TO THE DOCKERFILE, YET.**\n\n> I repeat, DO NOT ADD THEM TO THE DOCKERFILE, YET!\n\nYou remember me telling you, to open a shell into the container you built? The reason you need it, is because you will have to **fetch the extensionsâ€™ dependencies**.\n\n> Didnâ€™t I tell you that this is going to be fun?\n\n```shell\n./configure --enable-fpm \\\n    --enable-debug \\\n    --with-openssl \\\n    --with-zlib \\\n    --with-curl \\\n    --enable-gd \\\n    --with-gettext \\\n    --enable-intl \\\n    --with-ldap \\\n    --with-mysqli \\\n    --enable-pcntl \\\n    --enable-sockets \\\n    --enable-sysvmsg \\\n    --with-xsl \\\n    --with-zip \\\n    --enable-mbstring \\\n    --with-pdo-mysql \\\n    --disable-short-tags\n```\n\nThe configure script is going to perform some checks and crash at some point or another, complaining about not being able to find some development dependencies. If it canâ€™t find `ldap` youâ€™ll probably have to `apt-get install libldap-dev`. If it canâ€™t find Oniguruma, youâ€™ll (not obviously, but probably) have to install `libonig-dev`. Rinse and repeat. Use common sense, apt-cache search and Google, in order to determine what you actually need.\n\nWhen you have gathered every package you have to install, youâ€™ll have to modify your Dockerfile so that they get fetched, before you even attempt to configure PHP.\n\nBefore venturing forth, run a `make clean && make -j${nproc} && make install`. Just in case. If everything went well, `php -v` should give you output, stating itâ€™s version and that it is a `NTS DEBUG` build.\n\n> #EverythingIsAwesome.\n\nAt this point, weâ€™ll also need xdebug. You know the drill. Grab its source in `tar.gz` format from xdebugâ€™s downloads page, bring it into the container and extract it is its own directory. `phpize`, `configure`, `make`.\n\nWhen everything is tested in the container you are working, you should move everything into your Dockerfile. It should look something like this:\n\n```dockerfile\nFROM debian:bullseye-slim\n\nRUN apt-get update && \\\n    apt-get upgrade && \\\n    apt-get install pkg-config build-essential autoconf bison re2c wget gdb \\\n    libxml2-dev libsqlite3-dev libonig-dev libz-dev \\\n    libssl-dev libcurl4-openssl-dev libzip-dev libpng-dev \\\n    libldap-dev libxslt-dev\n\nWORKDIR /php\n# Download PHP & xdebug\nRUN wget -nv https://www.php.net/distributions/php-7.4.33.tar.gz && \\\n    tar xzf php-7.4.33.tar.gz && \\\n    wget -nv https://xdebug.org/files/xdebug-3.1.6.tgz && \\\n    tar xzf xdebug-3.1.6.tgz\n\n# Build PHP\nWORKDIR /php/php-7.4.33\n\nRUN mkdir -p /usr/local/etc/php/conf.d/\n\nRUN ./buildconf -f && \\\n    ./configure --enable-fpm \\\n    --enable-debug \\\n    --with-openssl \\\n    --with-zlib \\\n    --with-curl \\\n    --enable-gd \\\n    --with-gettext \\\n    --enable-intl \\\n    --with-ldap \\\n    --with-mysqli \\\n    --enable-pcntl \\\n    --enable-sockets \\\n    --enable-sysvmsg \\\n    --with-xsl \\\n    --with-zip \\\n    --enable-mbstring \\\n    --with-pdo-mysql \\\n    --disable-short-tags \\\n    --with-config-file-scan-dir=/usr/local/etc/php/conf.d/ && \\\n    make clean && \\\n    make -j${nproc} && \\\n    make install\n\n# Build xdebug\nWORKDIR /php/xdebug-3.1.6\n\nRUN phpize && \\\n    ./configure --enable-xdebug && \\\n    make -j${nproc} && \\\n    make install\n\nRUN mkdir -p /var/www/html/\n\nWORKDIR /var/www/html\n```\n\n## Debugging PHP Crashes with GDB\n\nIf you are observant enough, youâ€™ll already have noticed that I added [`gdb`](https://en.wikipedia.org/wiki/GNU_Debugger) in the packages I am fetching into our image. Weâ€™ll need the GNU debugger in order to make PHP crash, then investigate why it crashed.\n\nBut before even attempting this, weâ€™ll have to properly configure PHP. php.ini and the likes.\n\nYouâ€™ll need, at least, to increase the `memory_limit`, to enable xdebug and to set `xdebug.mode` to `coverage`. If you are still reading me, youâ€™ll probably have guessed (correctly) that Iâ€™ll tell you to **R**ead **T**he **F**ine **M**anual, on how to do such things. Yes, I know that you can spam `-d` flags to PHP, however I highly suggest to craft a `php.ini` and an `xdebug.ini` (and each and every other .ini for each and every other extension you need configured).\n\nAnd (not only that, but mostly) that is the reason, you will definately need a `docker-compose.yaml`. Youâ€™ll have to mount your project at `/var/www/html` and youâ€™ll have to mount the directory containing your PHP configuration at `/usr/local/etc/php/conf.d/`\n\nIs your container ready yet?\n\nOpen a shell into itâ€¦\n\n\u003Chr/>\n\nI cannot say that I am a debugging expert, nor that I navigate through gdbâ€™s commands with ease. I usually work on a _need-to-know_ basis; Google is my best friend. So, unfortunately, this cannot be a gdb tutorial. But I can, at this point, give you some insight into whatâ€™s going on.\n\nAssuming that everything went fine, your cursor should be blinking and waiting to do thy bidding. Type `gdb php` in order to load PHP into the debugger and watch the cursor blink again. Weâ€™ll actually need to run something. In my case I have to `r ./vendor/bin/phpunit --coverage-clover=clover.xml`\n\n> # And it crashedâ€¦ ðŸ¤¬\n\nNow, weâ€™ll have to figure out why it crashes. Letâ€™s type `bt` in order to examine the [stack](https://en.wikipedia.org/wiki/Call_stack)â€¦ Get a [cheat sheet](https://gist.github.com/rkubik/b96c23bd8ed58333de37f2b8cd052c30#file-cheat_sheet-txt-L18) and happy hunting!\n\n\u003Chr/>\n\nIt took me hours to understand what the problem was. PHP was actually trying to perform an invalid operation. I not only had to examine the stack and functionsâ€™ parameters. I had PHPâ€™s source code, side by side with my debugger, trying to understand what each line was doing.\n\nEventually, after hours and hours of examing the values of structures and pointers, reading through C code and trying to follow the execution path, I pinpointed the source of all evil. It was a relatively safe `shell_exec`, hidden in a destructor. It seems that, somehow; donâ€™t ask, I never understood; PHP tried to execute this destructor and then all hell broke loose.\n\nMoral of the story? I should have listened to [Psalm](https://psalm.dev/), when it warned me that this piece of code was [forbidden](https://psalm.dev/docs/running_psalm/issues/ForbiddenCode/). But more importantly, when standard PHP debugging tools fail, you now know how to build custom PHP debug binaries, use GDB to trace crashes, and debug PHP internals at the C level.\n\n## Key Takeaways\n\n- **Custom PHP debug binaries** are essential for debugging crashes in PHP internals\n- **Docker** provides an isolated environment for building and debugging PHP from source\n- **GDB (GNU Debugger)** allows you to trace crashes and examine the call stack at the C level\n- **Xdebug** must be compiled from source when building custom PHP binaries\n- **Static analysis tools** like Psalm can help prevent these issues before they occur\n- When PHPUnit crashes silently, the problem often lies in PHP's C internals, not your PHP code\n\nThis extreme PHP debugging approach isn't for everyday issues, but when you're facing crashes that standard PHP debugging tools can't handle, building custom PHP debug binaries and using GDB is your path forward.","src/content/blog/extreme-debugging-in-php.md",[45],"../../assets/php-gdb.webp","76b23067762829b2",{"html":48,"metadata":49},"\u003Cp>It was one of those awkward, lonely and quiet nights. I could not tell what \u003Ca href=\"https://open.spotify.com/track/0nMKVMCXCmRplsKKLt1TTh\">Spotify\u003C/a> was playing, nor what time it was. My eyes were fixed on my terminalâ€™s cursor. It was blinking, constantly blinking, like it was taunting me.\u003C/p>\n\u003Cp>Some of my PHPUnit tests were crashing unexpectedly while trying to generate code coverage. There was no exception, no error message, no stack traceâ€”nothing. The coverage report was never created and the PHP process was exiting silently with code \u003Ccode>143\u003C/code>.\u003C/p>\n\u003Cp>What the actual ðŸ¤¬?\u003C/p>\n\u003Cp>This is a story about \u003Cstrong>extreme PHP debugging\u003C/strong>â€”when standard PHP debugging tools fail and you need to dive deep into PHPâ€™s internals using custom debug binaries, Docker containers, and the GNU Debugger (GDB) to track down crashes that occur at the C level.\u003C/p>\n\u003Cp>So, first things first. How can you debug your tests, or even PHPUnit in such a case? The answer is easy. You donâ€™t because you canâ€™t. Such behavior alludes that something quite sinister lurks in your code. Something that crashes deep inside PHPâ€™s code. A statement, whose existence, creates a fatal error.\u003C/p>\n\u003Cp>But we arenâ€™t here to talk about what you canâ€™t do. We are here to talk about what you can, actually, do.\u003C/p>\n\u003Ch2 id=\"advanced-php-debugging-techniques\">Advanced PHP Debugging Techniques\u003C/h2>\n\u003Cp>Iâ€™ve lost count how many times I stumbled across a similar issue. Normally, I would totally ignore the issue. I would try my tests one by one in order to determine which one is the problematic. I would surrender, had I not been able to pinpoint the problematic piece of code. But I am not that person and I suspect that you arenâ€™t that person as well. Soâ€¦ Letâ€™s debug it.\u003C/p>\n\u003Cp>For starters, you canâ€™t debug PHP with pre-compiled PHP binaries. You have to properly configure and compile your own binaries! And since weâ€™ll need a whole toolchain for this, letâ€™s Dockerize it.\u003C/p>\n\u003Cblockquote>\n\u003Cp>Iâ€™m using Debian for this Docker image, but feel free to use the linux flavor you prefer.\u003C/p>\n\u003C/blockquote>\n\u003Ch2 id=\"-baby-steps\">ðŸ‘¶ Baby Steps\u003C/h2>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"dockerfile\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">FROM\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> debian:bullseye-slim\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">WORKDIR\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> /php\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>We, obviously, need to install the minimum set of dependencies to build PHP, so letâ€™s have a look at the \u003Ca href=\"https://github.com/php/php-src#readme\">official repo\u003C/a>:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"dockerfile\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">RUN\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> apt-get update &#x26;&#x26; apt-get install -y pkg-config build-essential \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    autoconf bison re2c libxml2-dev libsqlite3-dev\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>We need to fetch the source for the PHP version we want to build. Luckily, we will not have to \u003Ccode>git clone\u003C/code> PHPâ€™s repo, since PHP offers source code \u003Ca href=\"https://www.php.net/downloads.php\">downloads\u003C/a> in their page. Weâ€™ll use PHP 7.4.33 and we need a way to download it into our image. Unfortunately \u003Ccode>wget\u003C/code> is not installed in \u003Ccode>bullseye-slim\u003C/code> so weâ€™ll have to \u003Ccode>apt-get\u003C/code> it as well.\u003C/p>\n\u003Cp>So, weâ€™ll go to the previous step where we are fetching PHPâ€™s dependencies and weâ€™ll add \u003Ccode>wget\u003C/code> as well.\u003C/p>\n\u003Cp>After doing so, we are ready to download PHP:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"dockerfile\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">RUN\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> wget -nv https://www.php.net/distributions/php-7.4.33.tar.gz &#x26;&#x26; \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    tar xzf php-7.4.33.tar.gz\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">WORKDIR\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> /php/php-7.4.33\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>We have downloaded, extracted and cdâ€™d into PHPâ€™s source! Now what? Weâ€™ll have to generate the configuration and configure the build prior to compiling:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"dockerfile\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">RUN\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> ./buildconf -f\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>At this point, we are ready to configure and compile PHP 7.4.33. However, this isnâ€™t a simple, copy snippet / paste snippet, case.\u003C/p>\n\u003Col>\n\u003Cli>You have to know how you want to configure your binaries.\u003C/li>\n\u003Cli>You have to know which PHP extensions your code requires.\u003C/li>\n\u003Cli>You have to know whether to enable or disable something.\u003C/li>\n\u003C/ol>\n\u003Cp>And this is a process of thinking, reading, trying and failing, until you succeed.\u003C/p>\n\u003Cp>So, build your image, create a container and open a shell into it. Your working directory will be the one where PHPâ€™s sources lie. Type \u003Ccode>./configure --help | more\u003C/code> and read through the extensive list of configuration options. A minimum debug build requires the flag \u003Ccode>--enable-debug\u003C/code>.\u003C/p>\n\u003Cp>However, in my case, and most probably in yours as well, youâ€™ll need some other stuff too. Such as cURL, sockets or intl. And in order to set up these, youâ€™ll have some \u003Ca href=\"https://dwarffortresswiki.org/index.php/DF2014:Losing\">fun\u003C/a>.\u003C/p>\n\u003Ch2 id=\"ï¸-configuring-and-building-php\">ðŸ› ï¸ Configuring and Building PHP\u003C/h2>\n\u003Cp>Make a list of the extensions you need included and features you need enabled (or disabled). \u003Cstrong>DO NOT ADD THE CONFIGURE OPTIONS TO THE DOCKERFILE, YET.\u003C/strong>\u003C/p>\n\u003Cblockquote>\n\u003Cp>I repeat, DO NOT ADD THEM TO THE DOCKERFILE, YET!\u003C/p>\n\u003C/blockquote>\n\u003Cp>You remember me telling you, to open a shell into the container you built? The reason you need it, is because you will have to \u003Cstrong>fetch the extensionsâ€™ dependencies\u003C/strong>.\u003C/p>\n\u003Cblockquote>\n\u003Cp>Didnâ€™t I tell you that this is going to be fun?\u003C/p>\n\u003C/blockquote>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"shell\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">./configure\u003C/span>\u003Cspan style=\"color:#79B8FF\"> --enable-fpm\u003C/span>\u003Cspan style=\"color:#79B8FF\"> \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    --enable-debug\u003C/span>\u003Cspan style=\"color:#79B8FF\"> \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    --with-openssl\u003C/span>\u003Cspan style=\"color:#79B8FF\"> \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    --with-zlib\u003C/span>\u003Cspan style=\"color:#79B8FF\"> \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    --with-curl\u003C/span>\u003Cspan style=\"color:#79B8FF\"> \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    --enable-gd\u003C/span>\u003Cspan style=\"color:#79B8FF\"> \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    --with-gettext\u003C/span>\u003Cspan style=\"color:#79B8FF\"> \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    --enable-intl\u003C/span>\u003Cspan style=\"color:#79B8FF\"> \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    --with-ldap\u003C/span>\u003Cspan style=\"color:#79B8FF\"> \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    --with-mysqli\u003C/span>\u003Cspan style=\"color:#79B8FF\"> \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    --enable-pcntl\u003C/span>\u003Cspan style=\"color:#79B8FF\"> \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    --enable-sockets\u003C/span>\u003Cspan style=\"color:#79B8FF\"> \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    --enable-sysvmsg\u003C/span>\u003Cspan style=\"color:#79B8FF\"> \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    --with-xsl\u003C/span>\u003Cspan style=\"color:#79B8FF\"> \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    --with-zip\u003C/span>\u003Cspan style=\"color:#79B8FF\"> \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    --enable-mbstring\u003C/span>\u003Cspan style=\"color:#79B8FF\"> \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    --with-pdo-mysql\u003C/span>\u003Cspan style=\"color:#79B8FF\"> \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#79B8FF\">    --disable-short-tags\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>The configure script is going to perform some checks and crash at some point or another, complaining about not being able to find some development dependencies. If it canâ€™t find \u003Ccode>ldap\u003C/code> youâ€™ll probably have to \u003Ccode>apt-get install libldap-dev\u003C/code>. If it canâ€™t find Oniguruma, youâ€™ll (not obviously, but probably) have to install \u003Ccode>libonig-dev\u003C/code>. Rinse and repeat. Use common sense, apt-cache search and Google, in order to determine what you actually need.\u003C/p>\n\u003Cp>When you have gathered every package you have to install, youâ€™ll have to modify your Dockerfile so that they get fetched, before you even attempt to configure PHP.\u003C/p>\n\u003Cp>Before venturing forth, run a \u003Ccode>make clean &#x26;&#x26; make -j${nproc} &#x26;&#x26; make install\u003C/code>. Just in case. If everything went well, \u003Ccode>php -v\u003C/code> should give you output, stating itâ€™s version and that it is a \u003Ccode>NTS DEBUG\u003C/code> build.\u003C/p>\n\u003Cblockquote>\n\u003Cp>#EverythingIsAwesome.\u003C/p>\n\u003C/blockquote>\n\u003Cp>At this point, weâ€™ll also need xdebug. You know the drill. Grab its source in \u003Ccode>tar.gz\u003C/code> format from xdebugâ€™s downloads page, bring it into the container and extract it is its own directory. \u003Ccode>phpize\u003C/code>, \u003Ccode>configure\u003C/code>, \u003Ccode>make\u003C/code>.\u003C/p>\n\u003Cp>When everything is tested in the container you are working, you should move everything into your Dockerfile. It should look something like this:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"dockerfile\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">FROM\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> debian:bullseye-slim\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">RUN\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> apt-get update &#x26;&#x26; \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    apt-get upgrade &#x26;&#x26; \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    apt-get install pkg-config build-essential autoconf bison re2c wget gdb \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    libxml2-dev libsqlite3-dev libonig-dev libz-dev \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    libssl-dev libcurl4-openssl-dev libzip-dev libpng-dev \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    libldap-dev libxslt-dev\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">WORKDIR\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> /php\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\"># Download PHP &#x26; xdebug\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">RUN\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> wget -nv https://www.php.net/distributions/php-7.4.33.tar.gz &#x26;&#x26; \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    tar xzf php-7.4.33.tar.gz &#x26;&#x26; \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    wget -nv https://xdebug.org/files/xdebug-3.1.6.tgz &#x26;&#x26; \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    tar xzf xdebug-3.1.6.tgz\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\"># Build PHP\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">WORKDIR\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> /php/php-7.4.33\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">RUN\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> mkdir -p /usr/local/etc/php/conf.d/\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">RUN\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> ./buildconf -f &#x26;&#x26; \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    ./configure --enable-fpm \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    --enable-debug \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    --with-openssl \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    --with-zlib \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    --with-curl \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    --enable-gd \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    --with-gettext \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    --enable-intl \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    --with-ldap \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    --with-mysqli \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    --enable-pcntl \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    --enable-sockets \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    --enable-sysvmsg \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    --with-xsl \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    --with-zip \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    --enable-mbstring \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    --with-pdo-mysql \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    --disable-short-tags \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    --with-config-file-scan-dir=/usr/local/etc/php/conf.d/ &#x26;&#x26; \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    make clean &#x26;&#x26; \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    make -j${nproc} &#x26;&#x26; \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    make install\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\"># Build xdebug\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">WORKDIR\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> /php/xdebug-3.1.6\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">RUN\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> phpize &#x26;&#x26; \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    ./configure --enable-xdebug &#x26;&#x26; \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    make -j${nproc} &#x26;&#x26; \\\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    make install\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">RUN\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> mkdir -p /var/www/html/\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">WORKDIR\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> /var/www/html\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"debugging-php-crashes-with-gdb\">Debugging PHP Crashes with GDB\u003C/h2>\n\u003Cp>If you are observant enough, youâ€™ll already have noticed that I added \u003Ca href=\"https://en.wikipedia.org/wiki/GNU_Debugger\">\u003Ccode>gdb\u003C/code>\u003C/a> in the packages I am fetching into our image. Weâ€™ll need the GNU debugger in order to make PHP crash, then investigate why it crashed.\u003C/p>\n\u003Cp>But before even attempting this, weâ€™ll have to properly configure PHP. php.ini and the likes.\u003C/p>\n\u003Cp>Youâ€™ll need, at least, to increase the \u003Ccode>memory_limit\u003C/code>, to enable xdebug and to set \u003Ccode>xdebug.mode\u003C/code> to \u003Ccode>coverage\u003C/code>. If you are still reading me, youâ€™ll probably have guessed (correctly) that Iâ€™ll tell you to \u003Cstrong>R\u003C/strong>ead \u003Cstrong>T\u003C/strong>he \u003Cstrong>F\u003C/strong>ine \u003Cstrong>M\u003C/strong>anual, on how to do such things. Yes, I know that you can spam \u003Ccode>-d\u003C/code> flags to PHP, however I highly suggest to craft a \u003Ccode>php.ini\u003C/code> and an \u003Ccode>xdebug.ini\u003C/code> (and each and every other .ini for each and every other extension you need configured).\u003C/p>\n\u003Cp>And (not only that, but mostly) that is the reason, you will definately need a \u003Ccode>docker-compose.yaml\u003C/code>. Youâ€™ll have to mount your project at \u003Ccode>/var/www/html\u003C/code> and youâ€™ll have to mount the directory containing your PHP configuration at \u003Ccode>/usr/local/etc/php/conf.d/\u003C/code>\u003C/p>\n\u003Cp>Is your container ready yet?\u003C/p>\n\u003Cp>Open a shell into itâ€¦\u003C/p>\n\u003Chr>\n\u003Cp>I cannot say that I am a debugging expert, nor that I navigate through gdbâ€™s commands with ease. I usually work on a \u003Cem>need-to-know\u003C/em> basis; Google is my best friend. So, unfortunately, this cannot be a gdb tutorial. But I can, at this point, give you some insight into whatâ€™s going on.\u003C/p>\n\u003Cp>Assuming that everything went fine, your cursor should be blinking and waiting to do thy bidding. Type \u003Ccode>gdb php\u003C/code> in order to load PHP into the debugger and watch the cursor blink again. Weâ€™ll actually need to run something. In my case I have to \u003Ccode>r ./vendor/bin/phpunit --coverage-clover=clover.xml\u003C/code>\u003C/p>\n\u003Cblockquote>\n\u003Ch1 id=\"and-it-crashed\">And it crashedâ€¦ ðŸ¤¬\u003C/h1>\n\u003C/blockquote>\n\u003Cp>Now, weâ€™ll have to figure out why it crashes. Letâ€™s type \u003Ccode>bt\u003C/code> in order to examine the \u003Ca href=\"https://en.wikipedia.org/wiki/Call_stack\">stack\u003C/a>â€¦ Get a \u003Ca href=\"https://gist.github.com/rkubik/b96c23bd8ed58333de37f2b8cd052c30#file-cheat_sheet-txt-L18\">cheat sheet\u003C/a> and happy hunting!\u003C/p>\n\u003Chr>\n\u003Cp>It took me hours to understand what the problem was. PHP was actually trying to perform an invalid operation. I not only had to examine the stack and functionsâ€™ parameters. I had PHPâ€™s source code, side by side with my debugger, trying to understand what each line was doing.\u003C/p>\n\u003Cp>Eventually, after hours and hours of examing the values of structures and pointers, reading through C code and trying to follow the execution path, I pinpointed the source of all evil. It was a relatively safe \u003Ccode>shell_exec\u003C/code>, hidden in a destructor. It seems that, somehow; donâ€™t ask, I never understood; PHP tried to execute this destructor and then all hell broke loose.\u003C/p>\n\u003Cp>Moral of the story? I should have listened to \u003Ca href=\"https://psalm.dev/\">Psalm\u003C/a>, when it warned me that this piece of code was \u003Ca href=\"https://psalm.dev/docs/running_psalm/issues/ForbiddenCode/\">forbidden\u003C/a>. But more importantly, when standard PHP debugging tools fail, you now know how to build custom PHP debug binaries, use GDB to trace crashes, and debug PHP internals at the C level.\u003C/p>\n\u003Ch2 id=\"key-takeaways\">Key Takeaways\u003C/h2>\n\u003Cul>\n\u003Cli>\u003Cstrong>Custom PHP debug binaries\u003C/strong> are essential for debugging crashes in PHP internals\u003C/li>\n\u003Cli>\u003Cstrong>Docker\u003C/strong> provides an isolated environment for building and debugging PHP from source\u003C/li>\n\u003Cli>\u003Cstrong>GDB (GNU Debugger)\u003C/strong> allows you to trace crashes and examine the call stack at the C level\u003C/li>\n\u003Cli>\u003Cstrong>Xdebug\u003C/strong> must be compiled from source when building custom PHP binaries\u003C/li>\n\u003Cli>\u003Cstrong>Static analysis tools\u003C/strong> like Psalm can help prevent these issues before they occur\u003C/li>\n\u003Cli>When PHPUnit crashes silently, the problem often lies in PHPâ€™s C internals, not your PHP code\u003C/li>\n\u003C/ul>\n\u003Cp>This extreme PHP debugging approach isnâ€™t for everyday issues, but when youâ€™re facing crashes that standard PHP debugging tools canâ€™t handle, building custom PHP debug binaries and using GDB is your path forward.\u003C/p>",{"headings":50,"localImagePaths":71,"remoteImagePaths":72,"frontmatter":73,"imagePaths":78},[51,55,58,61,64,68],{"depth":52,"slug":53,"text":54},2,"advanced-php-debugging-techniques","Advanced PHP Debugging Techniques",{"depth":52,"slug":56,"text":57},"-baby-steps","ðŸ‘¶ Baby Steps",{"depth":52,"slug":59,"text":60},"ï¸-configuring-and-building-php","ðŸ› ï¸ Configuring and Building PHP",{"depth":52,"slug":62,"text":63},"debugging-php-crashes-with-gdb","Debugging PHP Crashes with GDB",{"depth":65,"slug":66,"text":67},1,"and-it-crashed","And it crashedâ€¦ ðŸ¤¬",{"depth":52,"slug":69,"text":70},"key-takeaways","Key Takeaways",[],[],{"title":14,"description":15,"pubDate":74,"updatedDate":75,"heroImage":45,"category":21,"tags":76,"excerpt":30,"keywords":77},"2022-12-01","2026-01-18",[20,21,22,23,24,25,26,27,28,29],[32,33,34,35,36,37,38,39,40,41],[],"reverse-engineering-hexplore-1",{"id":79,"data":81,"body":111,"filePath":112,"assetImports":113,"digest":116,"rendered":117},{"title":82,"description":83,"pubDate":84,"heroImage":85,"tags":86,"category":87,"excerpt":97,"keywords":98},"Reverse Engineering Hexplore: My Journey Begins","Learn reverse engineering techniques by exploring Hexplore, a 1990s game. Master x86 assembly, Ghidra decompilation, Win32 APIs, and game data formats to resurrect classic software.",["Date","2024-09-20T00:00:00.000Z"],"__ASTRO_IMAGE_../../assets/hexplore-1.webp",[87,88,89,90,91,92,93,94,95,96],"Reverse Engineering","Hexplore","x86 Assembly","Game Reverse Engineering","Ghidra","Win32 API","DirectX","Software Archaeology","Binary Analysis","Game Hacking","Join the reverse engineering journey of Hexplore â€” exploring x86 assembly, Ghidra, Win32 APIs, and game data formats to resurrect a 1990s classic. Learn how to dig into old binaries and rebuild lost code.",[99,100,101,102,103,104,105,106,107,108,109,110],"reverse engineering Hexplore","x86 assembly reverse engineering","Ghidra tutorial","game reverse engineering","Win32 API reverse engineering","DirectX reverse engineering","software archaeology","binary analysis","game hacking","decompilation techniques","1990s game reverse engineering","Hexplore game analysis","Recently, I came across a game that's nearly a quarter of a century old: [Hexplore](https://www.gog.com/en/game/hexplore). It's an Action / Adventure game with RPG elements and the GOG description reads:\n\n> Immerse yourself in a medieval world. A world where Garkham, Grand Master of the Black Magicians, has sworn to take possession of the Book of Hexplore. From this moment, the whole world is in great peril. For this manuscript will most certainly lead those who find it to the Garden of Eden, resting place of the Divine Power.\n\n![Hexplore Screenshot](../../assets/hexplore.webp)\n\nBack in those days, I was the proud owner of an AMD K6 with a super-noisy 2GB hard drive, 32MB of RAM, and a VGA card capable of displaying 256 colors at 640x480 resolution on a 14-inch CRT monitor. Now _thatâ€™s_ what I call a gaming setup!\n\nNostalgia aside, itâ€™s a game I spent countless hours playing, fighting monsters and solving riddles and puzzles. It was nowhere near Diablo, either in terms of hack-and-slash combat or RPG elements, but it had its moments. Over the years, Iâ€™ve revisited it occasionally &mdash; not just for nostalgia, but for its unique design and gameplay.\n\nUnfortunately, even with its GOG re-release, the game feels nearly unplayable on modern systems. It was designed for 640x480 resolution with 256 colors, and as you can imagine, running that on a 32-inch 4K monitor is far from ideal.\n\nSo, I thought:\n\n> _Can I do something about it?_\n\nBeing me, with my crazy ideas about impossible things, I figured I _might_ be able to make the game playable again. Unfortunately, this is a long and difficult project that could take years, and the most likely outcome is that it may never be finished. But Iâ€™ve started. And this is my journal of reverse engineering a 90s game.\n\n## First things first: Baby Steps\n\nItâ€™s been a very long time since I last touched C++ or read x86 Assembly. To tackle a project like this, you not only need a copy of [Ghidra](https://ghidra-sre.org/), but you also need to know a thing or two about how those ~~magnificent~~ hellish machines, operating systems, and APIs work. Being a firm believer in RTFM[^1], I knew I had to start by getting my hands on some good documentation.\n\n> Enter the world of software archaeology\n\nHexplore was released in August 1998, the same year as Windows 98. Given that the company that developed the game was formed around [1996](https://rpgwatch.com/developers/heliovisions-productions-1069.html) and that the typical development cycle for a game was around one year[^2], I estimate that it took about 12 to 18 months to develop. So, we can safely say that development likely began in late 1996 or early 1997.\n\nAssuming they used whatever cutting-edge technology was available at the time, we can make the following guesses:\n\n1. There was no [MMX](https://en.wikipedia.org/wiki/MMX_(instruction_set)) or [3DNow!](https://en.wikipedia.org/wiki/3DNow!); the world ran on the good old x86-32 instruction set.\n2. Development was likely done on Windows 95/NT4, as both were released in 1995.\n3. The code was probably written in Visual C++ 4.0, which was released in late 1995.\n4. The game probably uses Microsoft's DirectX 5.0.\n\nFor the time being, we need the following resources:\n\n- [x86 Instruction Set](https://www.felixcloutier.com/x86/) (_I donâ€™t suggest Intelâ€™s or AMDâ€™s PDFs, as they are ginormous._)\n- [Win32 API](https://learn.microsoft.com/en-us/windows/win32/api/)\n- [DirectX 5 Documentation](https://library.thedatadungeon.com/directx5/)\n\nAlso, I should get a [book](https://www.amazon.com/x64-Assembly-Language-Step-Step-dp-1394155247/dp/1394155247) or [two](https://www.amazon.com/Learn-Program-Assembly-Foundational-Programmers/dp/1484274369/) on x86 Assembly. Besides the instruction set, I need to understand how things work in order to reverse-engineer and rewrite them effectively.\n\nAnd thus, armed with the forbidden manuscripts, patience, and a cup of coffee, I'll delve into the ancient art of reverse engineering. For it is not enough to merely read the cryptic runes of `REPNE SCASB ES:EDI` from dusty tomes of knowledge; no, I must grasp their very essence, to unweave the fabric of the machine and forge it anew in a higher tongue. Only then can I hope to resurrect the relics of the past, breathing life into the forgotten code once more.\n\n## The lair of Ghidra\n\nFor the record, let me state that I am not a beginner in either reverse engineering or assembly. I had a pretty solid knowledge of how _stuff_ works. And Iâ€™m using the past tense because I havenâ€™t touched either assembly or reverse engineering in a very long time. Yet, I still remember a trick or two.\n\nGhidra, besides being a [disassembler](https://en.wikipedia.org/wiki/Disassembler), is also a [decompiler](https://en.wikipedia.org/wiki/Decompiler). It can not only translate machine code into Assembly, but it can also (try to) reconstruct a C representation of the program we are working on. This is both a curse and a blessing.\n\n### Blessings\n\nItâ€™s a blessing for those of us who can use our heads as a C interpreter &mdash; _shift by eight bits and **and** it with `0xff`_ &mdash; however, the following simple snippet requires a translator for those who are not accustomed to reading assembly:\n\n```assembly\nMOV ECX, 0x08\nSHR EAX, ECX\nMOV ECX, 0xff\nAND EAX, ECX\n```\n\n### ...and curses\n\nAnd itâ€™s a curse, a terrible curse that can sometimes frustrate you so much that youâ€™ll want to punch your shiny, curved screen right in the middle. I wonâ€™t tell you the reason before giving you a real-life example that Iâ€™ve come across countless times:\n\n```assembly\nMOV EDI, dword ptr [PTR_DAT_00590108]\nOR ECX, 0xffffffff\nXOR EAX, EAX\nMOV dword ptr [ESP + local_248], EDI\nREPNE SCASB ES:EDI\nNOT ECX\nDEC ECX\nMOV EBP, ECX\n```\n\nLet's see, what does this do?\n\nThe first four instructions are not a big deal; we load the value of a pointer into the `EDI` register, we\nset the `ECX` register to `0xffffffff`, we clear the `EAX` register and we move the value of `EDI` into our stack, on the position specifed by `ESP + local_248`. However, the fifth instruction is pretty interesting. It [scans](https://www.felixcloutier.com/x86/scas:scasb:scasw:scasd) a byte in `EDI` and compares it with the value stored in `AL`. It [repeats](https://www.felixcloutier.com/x86/rep:repe:repz:repne:repnz) that scanning until either the zero flag (`ZF`) is set or `ECX` is 0.\nDoes it start making sense?\n\nAfter scanning the string, it `NOT`s the `ECX` register and decrements it by one, effectively giving us the number of bytes the string contains, or simply `strlen`.\n\nBut why, Ghidra, doesnâ€™t it simply translate this to `strlen` and instead translates it to (more or less) the following gibberish?\n\n```c\nuVar1 = 0xffffffff;\nlocal_248 = (WCHAR *)PTR_DAT_00590108;\npcVar10 = PTR_DAT_00590108;\ndo {\n    if (uVar1 == 0) break;\n    uVar1 = uVar1 - 1;\n    cVar7 = *pcVar10;\n    pcVar10 = pcVar10 + 1;\n} while (cVar7 != '\\0');\npCVar9 = (LPSTR)(~uVar1 - 1);\n```\n\nItâ€™s quite possible that the compiler performs aggressive optimization by inlining the `strlen` function (i.e., replacing the function call with the body of the function), which effectively eliminates the overhead of calling the function. Alternatively, it could be due to decompilation limitations, which may not map the assembly code directly to a function call. Whatever the case, we know that we cannot truly rely on the decompiler and definitely need to understand assembly.\n\nThat's where a reference to assembly instructions comes in handy &mdash; and more than that, it is the go-to resource when something doesnâ€™t make any sense.\n\n## Verifying our claims\n\nAfter loading and analyzing the executable, we can see that Ghidra has identified a couple of VC++ library functions, such as `_strlen`, `_memcmp`, and `_rand`. This strongly indicates that the game was written in C/C++ and compiled with Microsoft's compiler. The exact version is not known, but it is likely one of Visual C++ 4.0, 5.0, or 6.0. And since the world hadn't yet discovered the marvels of [SIMD](https://en.wikipedia.org/wiki/Single_instruction,_multiple_data), weâ€™ll be working with fewer instructions, fewer registers, and less complex stuff. _Everything is awesome!_\n\nBy navigating Ghidra's **Symbol Table**, we can see calls to `DirectDrawCreate` (that's DirectX's DirectDraw ðŸ˜‰), `DirectSoundCreate` (ðŸŽ§), `_SmackOpen` (that's [Smacker Video](https://en.wikipedia.org/wiki/Smacker_video) ðŸŽ¥), and various other Win32 API calls. Hexplore also uses [SecuROM](https://en.wikipedia.org/wiki/SecuROM), and I'm sure I'll find some code related to it as well.\n\nWith our resources ready to be consumed, the executable disassembled, and a fresh cup of coffee, we are ready to get into some serious software archaeology and reverse engineering. But before diving deep into the obscure world of x86, let's cover a few final things &mdash; which, I believe, I should have stated earlier in this post.\n\n## What now?\n\nAs you have undoubtedly guessed, this is the first part in a series of posts focused on both reverse engineering and the methods used to understand and re-implement something, as well as on the specific game &mdash; which I enjoyed playing both as a kid and as an adult. The posts will follow a _diary format_. I do not intend to write a book on RE, nor tutorials on the subject. I merely want to document a long journey Iâ€™ve decided to embark upon in order to expand my knowledge, have some fun tinkering with an old game, and, why not, produce something useful &mdash; either for myself or for others.\n\nThis journey had some milestones set from its inception stage &mdash;that is, when I first thought, _why not reverse engineer Hexplore?_. The first milestone has been reached: researching the resources Iâ€™ll need to start working on it. I might not know everything, and I am sure weird things will come up along the way, but I have a solid stash of information I can use to understand and re-implement the things I want to. Hexplore uses a [voxel](https://en.wikipedia.org/wiki/Voxel) engine, which (most probably, needs to be verified) was implemented in software. Considering the limitations of the software and hardware that existed back then, everything was new: 32-bit Windows, DirectX, hardware accelerators (nVidiaâ€™s Riva, 3dfxâ€™s Voodoo, and ATIâ€™s RAGE are some examples) were just becoming affordable for home computersâ€”you name it. _Could I re-implement this voxel engine in a modern API, say, Vulkan?_\n\nI honestly don't know. Thus, Iâ€™ve set the project's milestones and will try to reach them:\n\n- [X] Investigate the game and gather necessary resources for reverse engineering\n- [ ] Reverse engineer the game's data file formats and produce documentation for them\n- [ ] Craft tools for viewing (and possibly manipulating) the game's assets\n- [ ] Imagine something bigger.\n\nUnderstanding the game's data file formats, although it sounds simple, will be both a difficult and time-consuming task &mdash; as such, it must not be underestimated. I've already started looking into the files that hold the game's texts (i.e., the `st1` files) and made some progress, but that's a story for another post.\n\n## Closing words\n\nThe next time we meet, I'll be making a deep dive into the game's data file formats. Expect some frustration, as the developers have taken some clever measures against people like me (which is not unheard of). We'll also get our hands dirty with some C++, talk about developer decisions, and continue our journey into the abyss. And as those who have played Hexplore vividly remember:\n\n> You must gather your party before venturing forth.\n\n[^1]: Read(ing) the fucking manual.\n[^2]: id Software began working on Doom [after the release of Spear of Destiny](https://5years.doomworld.com/interviews/johnromero/), and the game was released on [December 10, 1993](https://en.wikipedia.org/wiki/Doom_(1993_video_game)).","src/content/blog/reverse-engineering-hexplore-1.md",[114,115],"../../assets/hexplore.webp","../../assets/hexplore-1.webp","ed452ad1f8075100",{"html":118,"metadata":119},"\u003Cp>Recently, I came across a game thatâ€™s nearly a quarter of a century old: \u003Ca href=\"https://www.gog.com/en/game/hexplore\">Hexplore\u003C/a>. Itâ€™s an Action / Adventure game with RPG elements and the GOG description reads:\u003C/p>\n\u003Cblockquote>\n\u003Cp>Immerse yourself in a medieval world. A world where Garkham, Grand Master of the Black Magicians, has sworn to take possession of the Book of Hexplore. From this moment, the whole world is in great peril. For this manuscript will most certainly lead those who find it to the Garden of Eden, resting place of the Divine Power.\u003C/p>\n\u003C/blockquote>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../assets/hexplore.webp&#x22;,&#x22;alt&#x22;:&#x22;Hexplore Screenshot&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Cp>Back in those days, I was the proud owner of an AMD K6 with a super-noisy 2GB hard drive, 32MB of RAM, and a VGA card capable of displaying 256 colors at 640x480 resolution on a 14-inch CRT monitor. Now \u003Cem>thatâ€™s\u003C/em> what I call a gaming setup!\u003C/p>\n\u003Cp>Nostalgia aside, itâ€™s a game I spent countless hours playing, fighting monsters and solving riddles and puzzles. It was nowhere near Diablo, either in terms of hack-and-slash combat or RPG elements, but it had its moments. Over the years, Iâ€™ve revisited it occasionally â€” not just for nostalgia, but for its unique design and gameplay.\u003C/p>\n\u003Cp>Unfortunately, even with its GOG re-release, the game feels nearly unplayable on modern systems. It was designed for 640x480 resolution with 256 colors, and as you can imagine, running that on a 32-inch 4K monitor is far from ideal.\u003C/p>\n\u003Cp>So, I thought:\u003C/p>\n\u003Cblockquote>\n\u003Cp>\u003Cem>Can I do something about it?\u003C/em>\u003C/p>\n\u003C/blockquote>\n\u003Cp>Being me, with my crazy ideas about impossible things, I figured I \u003Cem>might\u003C/em> be able to make the game playable again. Unfortunately, this is a long and difficult project that could take years, and the most likely outcome is that it may never be finished. But Iâ€™ve started. And this is my journal of reverse engineering a 90s game.\u003C/p>\n\u003Ch2 id=\"first-things-first-baby-steps\">First things first: Baby Steps\u003C/h2>\n\u003Cp>Itâ€™s been a very long time since I last touched C++ or read x86 Assembly. To tackle a project like this, you not only need a copy of \u003Ca href=\"https://ghidra-sre.org/\">Ghidra\u003C/a>, but you also need to know a thing or two about how those \u003Cdel>magnificent\u003C/del> hellish machines, operating systems, and APIs work. Being a firm believer in RTFM\u003Csup>\u003Ca href=\"#user-content-fn-1\" id=\"user-content-fnref-1\" data-footnote-ref=\"\" aria-describedby=\"footnote-label\">1\u003C/a>\u003C/sup>, I knew I had to start by getting my hands on some good documentation.\u003C/p>\n\u003Cblockquote>\n\u003Cp>Enter the world of software archaeology\u003C/p>\n\u003C/blockquote>\n\u003Cp>Hexplore was released in August 1998, the same year as Windows 98. Given that the company that developed the game was formed around \u003Ca href=\"https://rpgwatch.com/developers/heliovisions-productions-1069.html\">1996\u003C/a> and that the typical development cycle for a game was around one year\u003Csup>\u003Ca href=\"#user-content-fn-2\" id=\"user-content-fnref-2\" data-footnote-ref=\"\" aria-describedby=\"footnote-label\">2\u003C/a>\u003C/sup>, I estimate that it took about 12 to 18 months to develop. So, we can safely say that development likely began in late 1996 or early 1997.\u003C/p>\n\u003Cp>Assuming they used whatever cutting-edge technology was available at the time, we can make the following guesses:\u003C/p>\n\u003Col>\n\u003Cli>There was no \u003Ca href=\"https://en.wikipedia.org/wiki/MMX_(instruction_set)\">MMX\u003C/a> or \u003Ca href=\"https://en.wikipedia.org/wiki/3DNow!\">3DNow!\u003C/a>; the world ran on the good old x86-32 instruction set.\u003C/li>\n\u003Cli>Development was likely done on Windows 95/NT4, as both were released in 1995.\u003C/li>\n\u003Cli>The code was probably written in Visual C++ 4.0, which was released in late 1995.\u003C/li>\n\u003Cli>The game probably uses Microsoftâ€™s DirectX 5.0.\u003C/li>\n\u003C/ol>\n\u003Cp>For the time being, we need the following resources:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ca href=\"https://www.felixcloutier.com/x86/\">x86 Instruction Set\u003C/a> (\u003Cem>I donâ€™t suggest Intelâ€™s or AMDâ€™s PDFs, as they are ginormous.\u003C/em>)\u003C/li>\n\u003Cli>\u003Ca href=\"https://learn.microsoft.com/en-us/windows/win32/api/\">Win32 API\u003C/a>\u003C/li>\n\u003Cli>\u003Ca href=\"https://library.thedatadungeon.com/directx5/\">DirectX 5 Documentation\u003C/a>\u003C/li>\n\u003C/ul>\n\u003Cp>Also, I should get a \u003Ca href=\"https://www.amazon.com/x64-Assembly-Language-Step-Step-dp-1394155247/dp/1394155247\">book\u003C/a> or \u003Ca href=\"https://www.amazon.com/Learn-Program-Assembly-Foundational-Programmers/dp/1484274369/\">two\u003C/a> on x86 Assembly. Besides the instruction set, I need to understand how things work in order to reverse-engineer and rewrite them effectively.\u003C/p>\n\u003Cp>And thus, armed with the forbidden manuscripts, patience, and a cup of coffee, Iâ€™ll delve into the ancient art of reverse engineering. For it is not enough to merely read the cryptic runes of \u003Ccode>REPNE SCASB ES:EDI\u003C/code> from dusty tomes of knowledge; no, I must grasp their very essence, to unweave the fabric of the machine and forge it anew in a higher tongue. Only then can I hope to resurrect the relics of the past, breathing life into the forgotten code once more.\u003C/p>\n\u003Ch2 id=\"the-lair-of-ghidra\">The lair of Ghidra\u003C/h2>\n\u003Cp>For the record, let me state that I am not a beginner in either reverse engineering or assembly. I had a pretty solid knowledge of how \u003Cem>stuff\u003C/em> works. And Iâ€™m using the past tense because I havenâ€™t touched either assembly or reverse engineering in a very long time. Yet, I still remember a trick or two.\u003C/p>\n\u003Cp>Ghidra, besides being a \u003Ca href=\"https://en.wikipedia.org/wiki/Disassembler\">disassembler\u003C/a>, is also a \u003Ca href=\"https://en.wikipedia.org/wiki/Decompiler\">decompiler\u003C/a>. It can not only translate machine code into Assembly, but it can also (try to) reconstruct a C representation of the program we are working on. This is both a curse and a blessing.\u003C/p>\n\u003Ch3 id=\"blessings\">Blessings\u003C/h3>\n\u003Cp>Itâ€™s a blessing for those of us who can use our heads as a C interpreter â€” \u003Cem>shift by eight bits and \u003Cstrong>and\u003C/strong> it with \u003Ccode>0xff\u003C/code>\u003C/em> â€” however, the following simple snippet requires a translator for those who are not accustomed to reading assembly:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"plaintext\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan>MOV ECX, 0x08\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>SHR EAX, ECX\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>MOV ECX, 0xff\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>AND EAX, ECX\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"and-curses\">â€¦and curses\u003C/h3>\n\u003Cp>And itâ€™s a curse, a terrible curse that can sometimes frustrate you so much that youâ€™ll want to punch your shiny, curved screen right in the middle. I wonâ€™t tell you the reason before giving you a real-life example that Iâ€™ve come across countless times:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"plaintext\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan>MOV EDI, dword ptr [PTR_DAT_00590108]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>OR ECX, 0xffffffff\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>XOR EAX, EAX\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>MOV dword ptr [ESP + local_248], EDI\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>REPNE SCASB ES:EDI\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>NOT ECX\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>DEC ECX\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>MOV EBP, ECX\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Letâ€™s see, what does this do?\u003C/p>\n\u003Cp>The first four instructions are not a big deal; we load the value of a pointer into the \u003Ccode>EDI\u003C/code> register, we\nset the \u003Ccode>ECX\u003C/code> register to \u003Ccode>0xffffffff\u003C/code>, we clear the \u003Ccode>EAX\u003C/code> register and we move the value of \u003Ccode>EDI\u003C/code> into our stack, on the position specifed by \u003Ccode>ESP + local_248\u003C/code>. However, the fifth instruction is pretty interesting. It \u003Ca href=\"https://www.felixcloutier.com/x86/scas:scasb:scasw:scasd\">scans\u003C/a> a byte in \u003Ccode>EDI\u003C/code> and compares it with the value stored in \u003Ccode>AL\u003C/code>. It \u003Ca href=\"https://www.felixcloutier.com/x86/rep:repe:repz:repne:repnz\">repeats\u003C/a> that scanning until either the zero flag (\u003Ccode>ZF\u003C/code>) is set or \u003Ccode>ECX\u003C/code> is 0.\nDoes it start making sense?\u003C/p>\n\u003Cp>After scanning the string, it \u003Ccode>NOT\u003C/code>s the \u003Ccode>ECX\u003C/code> register and decrements it by one, effectively giving us the number of bytes the string contains, or simply \u003Ccode>strlen\u003C/code>.\u003C/p>\n\u003Cp>But why, Ghidra, doesnâ€™t it simply translate this to \u003Ccode>strlen\u003C/code> and instead translates it to (more or less) the following gibberish?\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"c\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">uVar1 \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#F97583\"> 0x\u003C/span>\u003Cspan style=\"color:#79B8FF\">ffffffff\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">local_248 \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (WCHAR \u003C/span>\u003Cspan style=\"color:#F97583\">*\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)PTR_DAT_00590108;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">pcVar10 \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> PTR_DAT_00590108;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">do\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (uVar1 \u003C/span>\u003Cspan style=\"color:#F97583\">==\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) \u003C/span>\u003Cspan style=\"color:#F97583\">break\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    uVar1 \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> uVar1 \u003C/span>\u003Cspan style=\"color:#F97583\">-\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    cVar7 \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#F97583\"> *\u003C/span>\u003Cspan style=\"color:#E1E4E8\">pcVar10;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    pcVar10 \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> pcVar10 \u003C/span>\u003Cspan style=\"color:#F97583\">+\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">} \u003C/span>\u003Cspan style=\"color:#F97583\">while\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (cVar7 \u003C/span>\u003Cspan style=\"color:#F97583\">!=\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> '\u003C/span>\u003Cspan style=\"color:#79B8FF\">\\0\u003C/span>\u003Cspan style=\"color:#9ECBFF\">'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">pCVar9 \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (LPSTR)(\u003C/span>\u003Cspan style=\"color:#F97583\">~\u003C/span>\u003Cspan style=\"color:#E1E4E8\">uVar1 \u003C/span>\u003Cspan style=\"color:#F97583\">-\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Itâ€™s quite possible that the compiler performs aggressive optimization by inlining the \u003Ccode>strlen\u003C/code> function (i.e., replacing the function call with the body of the function), which effectively eliminates the overhead of calling the function. Alternatively, it could be due to decompilation limitations, which may not map the assembly code directly to a function call. Whatever the case, we know that we cannot truly rely on the decompiler and definitely need to understand assembly.\u003C/p>\n\u003Cp>Thatâ€™s where a reference to assembly instructions comes in handy â€” and more than that, it is the go-to resource when something doesnâ€™t make any sense.\u003C/p>\n\u003Ch2 id=\"verifying-our-claims\">Verifying our claims\u003C/h2>\n\u003Cp>After loading and analyzing the executable, we can see that Ghidra has identified a couple of VC++ library functions, such as \u003Ccode>_strlen\u003C/code>, \u003Ccode>_memcmp\u003C/code>, and \u003Ccode>_rand\u003C/code>. This strongly indicates that the game was written in C/C++ and compiled with Microsoftâ€™s compiler. The exact version is not known, but it is likely one of Visual C++ 4.0, 5.0, or 6.0. And since the world hadnâ€™t yet discovered the marvels of \u003Ca href=\"https://en.wikipedia.org/wiki/Single_instruction,_multiple_data\">SIMD\u003C/a>, weâ€™ll be working with fewer instructions, fewer registers, and less complex stuff. \u003Cem>Everything is awesome!\u003C/em>\u003C/p>\n\u003Cp>By navigating Ghidraâ€™s \u003Cstrong>Symbol Table\u003C/strong>, we can see calls to \u003Ccode>DirectDrawCreate\u003C/code> (thatâ€™s DirectXâ€™s DirectDraw ðŸ˜‰), \u003Ccode>DirectSoundCreate\u003C/code> (ðŸŽ§), \u003Ccode>_SmackOpen\u003C/code> (thatâ€™s \u003Ca href=\"https://en.wikipedia.org/wiki/Smacker_video\">Smacker Video\u003C/a> ðŸŽ¥), and various other Win32 API calls. Hexplore also uses \u003Ca href=\"https://en.wikipedia.org/wiki/SecuROM\">SecuROM\u003C/a>, and Iâ€™m sure Iâ€™ll find some code related to it as well.\u003C/p>\n\u003Cp>With our resources ready to be consumed, the executable disassembled, and a fresh cup of coffee, we are ready to get into some serious software archaeology and reverse engineering. But before diving deep into the obscure world of x86, letâ€™s cover a few final things â€” which, I believe, I should have stated earlier in this post.\u003C/p>\n\u003Ch2 id=\"what-now\">What now?\u003C/h2>\n\u003Cp>As you have undoubtedly guessed, this is the first part in a series of posts focused on both reverse engineering and the methods used to understand and re-implement something, as well as on the specific game â€” which I enjoyed playing both as a kid and as an adult. The posts will follow a \u003Cem>diary format\u003C/em>. I do not intend to write a book on RE, nor tutorials on the subject. I merely want to document a long journey Iâ€™ve decided to embark upon in order to expand my knowledge, have some fun tinkering with an old game, and, why not, produce something useful â€” either for myself or for others.\u003C/p>\n\u003Cp>This journey had some milestones set from its inception stage â€”that is, when I first thought, \u003Cem>why not reverse engineer Hexplore?\u003C/em>. The first milestone has been reached: researching the resources Iâ€™ll need to start working on it. I might not know everything, and I am sure weird things will come up along the way, but I have a solid stash of information I can use to understand and re-implement the things I want to. Hexplore uses a \u003Ca href=\"https://en.wikipedia.org/wiki/Voxel\">voxel\u003C/a> engine, which (most probably, needs to be verified) was implemented in software. Considering the limitations of the software and hardware that existed back then, everything was new: 32-bit Windows, DirectX, hardware accelerators (nVidiaâ€™s Riva, 3dfxâ€™s Voodoo, and ATIâ€™s RAGE are some examples) were just becoming affordable for home computersâ€”you name it. \u003Cem>Could I re-implement this voxel engine in a modern API, say, Vulkan?\u003C/em>\u003C/p>\n\u003Cp>I honestly donâ€™t know. Thus, Iâ€™ve set the projectâ€™s milestones and will try to reach them:\u003C/p>\n\u003Cul class=\"contains-task-list\">\n\u003Cli class=\"task-list-item\">\u003Cinput type=\"checkbox\" checked disabled> Investigate the game and gather necessary resources for reverse engineering\u003C/li>\n\u003Cli class=\"task-list-item\">\u003Cinput type=\"checkbox\" disabled> Reverse engineer the gameâ€™s data file formats and produce documentation for them\u003C/li>\n\u003Cli class=\"task-list-item\">\u003Cinput type=\"checkbox\" disabled> Craft tools for viewing (and possibly manipulating) the gameâ€™s assets\u003C/li>\n\u003Cli class=\"task-list-item\">\u003Cinput type=\"checkbox\" disabled> Imagine something bigger.\u003C/li>\n\u003C/ul>\n\u003Cp>Understanding the gameâ€™s data file formats, although it sounds simple, will be both a difficult and time-consuming task â€” as such, it must not be underestimated. Iâ€™ve already started looking into the files that hold the gameâ€™s texts (i.e., the \u003Ccode>st1\u003C/code> files) and made some progress, but thatâ€™s a story for another post.\u003C/p>\n\u003Ch2 id=\"closing-words\">Closing words\u003C/h2>\n\u003Cp>The next time we meet, Iâ€™ll be making a deep dive into the gameâ€™s data file formats. Expect some frustration, as the developers have taken some clever measures against people like me (which is not unheard of). Weâ€™ll also get our hands dirty with some C++, talk about developer decisions, and continue our journey into the abyss. And as those who have played Hexplore vividly remember:\u003C/p>\n\u003Cblockquote>\n\u003Cp>You must gather your party before venturing forth.\u003C/p>\n\u003C/blockquote>\n\u003Csection data-footnotes=\"\" class=\"footnotes\">\u003Ch2 class=\"sr-only\" id=\"footnote-label\">Footnotes\u003C/h2>\n\u003Col>\n\u003Cli id=\"user-content-fn-1\">\n\u003Cp>Read(ing) the fucking manual. \u003Ca href=\"#user-content-fnref-1\" data-footnote-backref=\"\" aria-label=\"Back to reference 1\" class=\"data-footnote-backref\">â†©\u003C/a>\u003C/p>\n\u003C/li>\n\u003Cli id=\"user-content-fn-2\">\n\u003Cp>id Software began working on Doom \u003Ca href=\"https://5years.doomworld.com/interviews/johnromero/\">after the release of Spear of Destiny\u003C/a>, and the game was released on \u003Ca href=\"https://en.wikipedia.org/wiki/Doom_(1993_video_game)\">December 10, 1993\u003C/a>. \u003Ca href=\"#user-content-fnref-2\" data-footnote-backref=\"\" aria-label=\"Back to reference 2\" class=\"data-footnote-backref\">â†©\u003C/a>\u003C/p>\n\u003C/li>\n\u003C/ol>\n\u003C/section>",{"headings":120,"localImagePaths":146,"remoteImagePaths":147,"frontmatter":148,"imagePaths":152},[121,124,127,131,134,137,140,143],{"depth":52,"slug":122,"text":123},"first-things-first-baby-steps","First things first: Baby Steps",{"depth":52,"slug":125,"text":126},"the-lair-of-ghidra","The lair of Ghidra",{"depth":128,"slug":129,"text":130},3,"blessings","Blessings",{"depth":128,"slug":132,"text":133},"and-curses","â€¦and curses",{"depth":52,"slug":135,"text":136},"verifying-our-claims","Verifying our claims",{"depth":52,"slug":138,"text":139},"what-now","What now?",{"depth":52,"slug":141,"text":142},"closing-words","Closing words",{"depth":52,"slug":144,"text":145},"footnote-label","Footnotes",[114],[],{"title":82,"description":83,"pubDate":149,"heroImage":115,"category":87,"tags":150,"excerpt":97,"keywords":151},"2024-09-20",[87,88,89,90,91,92,93,94,95,96],[99,100,101,102,103,104,105,106,107,108,109,110],[114],"reverse-engineering-hexplore-2",{"id":153,"data":155,"body":180,"filePath":181,"assetImports":182,"digest":187,"rendered":188},{"title":156,"description":157,"pubDate":158,"heroImage":159,"tags":160,"category":87,"excerpt":166,"keywords":167},"Reverse Engineering Hexplore: Game Texts","Learn how to reverse engineer game text formats from 1990s games. Extract, decrypt, and parse Hexplore string tables using x86 assembly analysis, Ghidra, and binary file format reverse engineering techniques.",["Date","2024-10-07T00:00:00.000Z"],"__ASTRO_IMAGE_../../assets/hexplore-2.webp",[87,88,89,90,91,161,162,163,164,165],"Binary File Formats","String Table Parsing","Game Text Extraction","Stream Cipher Decryption","Game Localization","Dive into extracting, decoding, and reconstructing in-game text data from Hexplore. Learn methods for parsing string tables, mapping offsets, and integrating translated or modified dialogues using reverse engineering techniques.",[168,169,170,171,172,173,174,175,176,177,178,179,109,110],"reverse engineering Hexplore game texts","Hexplore string table format","game text extraction reverse engineering","st1 file format","binary text format parsing","game localization reverse engineering","stream cipher decryption","x86 assembly string parsing","Ghidra reverse engineering tutorial","game file format reverse engineering","BTXT file format","string table binary format","Video games are a unique kind of beast in the realm of software developmentâ€”*aren't they all?* you might ask, and you'd be right. From operating systems to applications written for embedded systems, and from servers and services to ERPs and CRMs, each domain has its own quirks. I won't claim that video games belong to the toughest or weirdest domainâ€”such a statement would be a blatant exaggeration. However, they are unique, both because of the constraints they impose on developers and the ways in which companies (and by extension, developers) get paid for them.\n\n## Mumbling\n\nWhile delving into how games generate profit is irrelevant to our current journey, understanding the constraints imposed on developers by the platform, available technology, and industry standards is crucial. As briefly discussed in my previous post, *Hexplore* was developed in the mid-'90s, when GPUs were not as advanced or widely accessible to home users, Pentium processors had just started dominating the market over older Intel/AMD/Cyrix models, CD-ROMs were relatively new, and hard drives were small and slow.\n\n| **Component** | **Requirement** |\n| :--------: | --------------------------------- |\n| **CPU** | Pentium 100MHz or _100% compatible_ |\n| **RAM** | 16 MB |\n| **CD-ROM** | 4x speed (600kb/s) |\n| **Sound** | Sound Blaster 16-bit or _compatible_ |\n| **GPU** | SVGA Video Card |\n| **OS**  | Windows 95/98 |\n\nThese are the system requirements for *Hexplore*. While they may seem irrelevant at first glance, they serve as a constant reminder to stop questioning why developers made certain decisionsâ€”this game is over a quarter of a century old. It's important to note that a Pentium running at 100MHz could execute at most two instructions per cycle[^1], but most of the time, it would execute just one. Additionally, some instructions take more than one cycle to complete, and access to EDO RAM was slow. When combined with the fact that Pentiums lacked many of the features modern processors boast (e.g., [out-of-order execution](https://en.wikipedia.org/wiki/Out-of-order_execution), [speculative execution](https://en.wikipedia.org/wiki/Out-of-order_execution), and [cache prefetching](https://en.wikipedia.org/wiki/Out-of-order_execution)), execution speed becomes a critical factor. Simply put, 100MHz means the processor could perform 10\u003Csup>8\u003C/sup> [instruction cycles](https://en.wikipedia.org/wiki/Instruction_cycle) per secondâ€”meaning each instruction cycle took roughly 10ns.\n\nThe Pentium was a single-core, single-thread CPU, meaning only one process could execute at any given time. Windows 95, however, was a true multitasking OS â€” it employed [preemptive multitasking](https://en.wikipedia.org/wiki/Preemption_(computing)) to allow multiple processes to appear to run simultaneously. This is seamless to the user, as [time slices](https://en.wikipedia.org/wiki/Preemption_(computing)#Time_slice) are calculated by the scheduler to meet the needs of each process. However, this adds extra overhead that developers had to take into account. Their applications had to compete with others for resources, so they needed to execute tasks efficiently to prevent users from experiencing lag or slow loading.\n\nMoreover, while the _10GB barrier_ was broken in 1997, a typical hard drive had a capacity of around 4GBâ€”which had to store the OS, other applications, documents, and more. As a result, most games of the era offered players the option to perform a minimal installation, copying only essential files to the hard drive while loading the rest from the CD-ROM as needed. This extended loading times, but given the hardware limitations, it was the preferable option for most users. For context, a 1x CD-ROM speed was equivalent to 150kb/sâ€”*Hexplore* required a 4x CD-ROM (or faster). A file from the game's first level, for example, is 2.1MB, so in an ideal scenario, it would take around 4 seconds to load.\n\nMany of us remember placing the mouse cursor at the tip of a progress bar, anxiously wondering if an installation had frozenâ€”yes, loading times in the '90s were often a painful experience. This is why developers employed clever techniques to reduce overhead, improve speed and responsiveness, and squeeze the best performance possible out of the hardware we had at the time.\n\n## First steps\n\nWhen we [last left](https://mistericy.github.io/2024/09/20/Reverse-Engineering-Hexplore-My-Journey-Begins/) our adventurer, he was discussing the game's texts. While I was correct in assuming that the game's strings are stored in the `Gbtxt.st1` file, it took me quite some time to understand not only the file's structure but also how *Hexplore* uses it.\n\nThe first and most logical step was to search the file for a well-known string, like a game message or the name of an enemy. If you haven't met him yet, here's Glore:\n\n![A Glore, one of Garkham's Minions](../../assets/hexplore-glore.webp)\n\nGlores are described as *monstrous scum* and emit a vile laughter when you enter their line of sight and they decide to attack. While there are numerous references to glores in the game (hint: 18), I wasn't able to find any in the data file. The next logical step was to open the file with a hex editor and check for anything legible inside. However, I found no clues, as the file appeared entirely composed of garbage. Declaring it a dead end, I returned to Ghidra to continue reverse engineering the game.\n\nSearching for `.st1` in the **Defined Strings** window revealed one result: `txt.st1`. The fact that **Gb** is missing is pretty strange, hinting that weâ€™re in for a surprise. This string is referenced *only twice* in the entire program (at least, thatâ€™s what Ghidra detected), so finding where the string loading and decrypting functionality occurs should be straightforward.\n\nUpon visiting the first location, weâ€™re greeted by a long function. The first thing it does? It calls `sprintf` to generate a file path using the format: `%s\\%s%s`. The first argument is `\"common\"`â€”thereâ€™s our directory. The third argument is the `txt.st1` string. Logically, the middle argument should be `Gb`... but how?\n\nLet's make a deviation...\n\n## Detecting the Game's Language\n\nIf we backtrack a bit, weâ€™ll notice a function call in `WinMain`, just before the gameâ€™s main loop begins. This function is called with a reference to a structure and, *I guess*, it performs some kind of initialization before allowing the game to proceed to the main loop. The function starts with a call to [`GetCurrentDirectoryA`](https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-getcurrentdirectory)â€”which is a curious choice. It stores the current directory in the aforementioned structure and then creates the following string:\n\n```c\nsprintf(buffer, \"%s\\\\%s\\\\??%s\", game->gameDir, \"common\", \"txt.st1\");\n```\n\nIt then immediately calls [`FindFirstFileA`](https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-findfirstfilea):\n\n```c\nWIN32_FIND_DATAA findData;\nHANDLE hFindFile = FindFirstFileA(buffer, &findData);\nif (hFindFile != INVALID_HANDLE_VALUE) {\n  // We found something:\n  gameLanguage[0] = findData.cFileName[0];\n  gameLanguage[1] = findData.cFileName[1];\n  gameLanguage[2] = '\\0';\n}\n```\n\nSo, if the file were named `Gntxt.st1`, would the game's language be set to `Gn` (*hint: German*)? Oh yes, it would!\n\nThereâ€™s little point in debating whether this decision was good or bad. Itâ€™s certainly an odd one, considering the developers could have chosen a more straightforward way to detect the game's language. For example, they could have written a value to the Windows Registry during the gameâ€™s installation.\n\nWhen the game starts, the memory location where the language will eventually be stored contains the string `XX`, which is then updated by this method. However, another curious decision stands out: the use of `GetCurrentDirectoryA`.\n\nAccording to Microsoft's documentation, this function *retrieves the current directory for the current process*. But what exactly is the current directory? While not explicitly explained in the documentation, it refers to the directory you're currently in when launching the application. For instance, if the game is installed in `C:\\Hexplore\\` and you open a command prompt at `C:\\` and run `.\\Hexplore\\hexplore.exe`, guess what? `GetCurrentDirectoryA` will return `C:\\`. You see where this is going?\n\nIf we try this little experiment, weâ€™ll notice that *Hexplore* will fail to start, displaying a message box that reads **FILE ERROR: 5** along with the problematic file path (in our case, `C:\\common\\XXtxt.st1`).\n\nA better approach here would be to use [`GetModuleFileNameA`](https://learn.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulefilenamea), which retrieves the actual path of the executable. With a bit of string manipulation, the correct path could be derived, and small bugs like this wouldnâ€™t exist (*Note to future self: make it fail-proof when you start implementing it*).\n\n## Back to String Finding\n\nRight after setting the game's language, *Hexplore* calls the long function that greeted us earlier. As we discussed, it crafts the proper path to the file and stores it in a buffer. It then proceeds to check if the file exists and loads it into memory.\n\n```c\nvoid __cdecl LoadStringsFromDisk(LPCSTR fileName,char *data,int shouldDecryptStrings);\n```\n\nThis function does the following:\n\n- Retrieves a handle for the file.\n- Retrieves the file's size.\n- Allocates memory to store the file.\n- Reads the file.\n- Closes the file.\n\nAll steps use the Windows API to perform file operations.\n\nSubsequently, if the `shouldDecryptStrings` parameter is not equal to `0`, it proceeds with decrypting the data in place.\n\n*Hexplore* has an intricate and interesting way of accessing files, which will be analyzed in another post once I have completely figured it out. For the time being, what is important is to see how the decryption takes place.\n\n### Decryption\n\n```c\n// Simplified version of loading the data from disk:\nlong size = GetFileSize(handle);\nchar* data = (char*)malloc(size);\nReadData(handle, data, size);\n\nif (shouldDecryptStrings != 0) {\n  char key = 0x37; // Set the initial key\n  int i = 0; // Set the counter \n  while (i \u003C size) { // While there is data in the buffer\n    char temp = buffer[i] ^ key; // XOR the current character with the key\n    key = key + buffer[i] + 0x33; // Add 0x33, the current character, and the key to key\n    buffer[i] = temp; // Store the decrypted character\n    i++; // Increment the counter\n  }\n}\n```\n\nSince I had never encountered this type of encryption before, I did some research and found that it resembles a [Stream Cipher](https://en.wikipedia.org/wiki/Stream_cipher).\n\nWhile I'm no expert on encryption, Iâ€™d like to share a few observations:\n\n1. This encryption implementation serves a dual purpose: on one hand, it adds a layer of complexity to the data, making it harder for players to modify the game or inadvertently break it while trying to mod it. On the other hand, it helps protect the game's integrity, ensuring that players experience the game as intended.\n2. The decryption process is quite efficient, as it performs a per-byte XOR operation, which is lightweight (_hint: takes 1 instruction cycle on the Pentium_). As mentioned earlier, in the realm of video games, speed and efficiency are crucial to prevent choppy gameplay or long loading times.\n3. The use of a dynamic key per byte introduces an additional layer of obfuscation that makes simple attacks more challenging. This prevents easy key prediction and makes brute-force attempts more difficult.\n4. While this method might seem simplistic by today's standards, it highlights the creative solutions game developers employed in the '90s to protect their games. Even simple encryption methods like this could deter casual modding and hacking efforts.\n\n## It's Decrypted, but It Still Makes No Sense\n\nAfter writing some quick and dirty code to decrypt the file and store it locally in its decrypted form, I opened it again with a hex editor to investigate its contents. While I was able to find _Glore_ and all of the strings used in the game, I was puzzled by the file's structure. It seems to have a header and contains much more data than just the game's strings. Since I was not able to find any information on the internet regarding this file format, I believe it is probably a proprietary format used exclusively for this game. [Heliovisions](https://www.mobygames.com/company/1859/doki-denki-sa/) released six games, and of those, only **two** were released for Windows. It is highly unlikely that they used this format in another game, and researching further into this matter seems futile. While one approach would be to look up the game's credits and search for other games created by *Hexplore*'s development team, it's uncertain that I would find anything. Thus...\n\nBack at Ghidra. Right after the call to `LoadStringsFromDisk`, there's another call whose first argument is a pointer to the unencrypted data. Interesting... Letâ€™s follow it to see where it leads us.\n\n## `FUN_004160a0`\n\n```c\nvoid __cdecl FUN_004160a0(char *decryptedData,uint param_2,int *param_3)\n```\n\nFirst of all, the function performs a simple check to determine whether the pointer that contains the decrypted data is allocated. Subsequently, it checks if its first integer element equals `0x54585423`. Since X86 is [little-endian](https://en.wikipedia.org/wiki/Endianness), this corresponds to `0x42545854`, or `BTXT` if translated to ASCII. Hey! I think we've found a header, since this seems like a [magic number](https://en.wikipedia.org/wiki/File_format#Magic_number)! \n\nThe next check is against the 3rd integer in the decrypted data (`0x08`) and ensures that it is not equal to 0. _Definitely a header_. Finally, it checks if the third parameter isnâ€™t `NULL` and that the second parameter is less than `100000000`.\n\n```x86asm\n; First check: Is the pointer allocated?\nMOV ESI, dword ptr [ESP + decryptedData]\nTEST ESI, ESI                   \nJZ return\n\n; Second check: Is the first four bytes of the header valid?\nMOV EAX, dword ptr [ESI]\nCMP EAX, 0x54585442\nJNZ return\n\n; Third check: Is the third element of the header not zero?\nMOV EAX, dword ptr [ESI + 0x08]\nTEST EAX, EAX\nJZ return\n\n; Fourth check: Is the third parameter of the function allocated? \nMOV ECX, dword ptr [ESP + param_3]\nTEST ECX, ECX\nJZ return\n\n; Fifth check: Is the second parameter less than 100000000?\nMOV EDX, dword ptr [ESP + param_2]\nCMP EDX, 0x5f5e0ff\nJA return\n```\n\nWith these clues so far, we can deduce that the file does have a header, so we will continue investigating the function to determine how long the header is, from which fields it is composed, and what values they have. Moving on, the function performs some initialization of `param_3`:\n\n\n```x86asm\nMOV dword ptr [ECX],0x0\nMOV dword ptr [ECX + 0x4],0x0\nMOV dword ptr [ECX + 0x8],0xffffffff\n```\n\nIt seems that `param_3` is a structure which might look like the following:\n\n```c\ntypedef struct {\n  void* unknown1;\n  void* unknown2;\n  int unknown3;\n} UnknownStruct;\n```\n\nSubsequently, the function runs the following code:\n\n```x86asm\n; Load into EDI the fourth field of the header\nMOV EDI, dword ptr [ESI + 0xc]\n; Load into EBP the third field of the header\nMOV EBP, dword ptr [ESI + 0x8]\n; Add the base address of the decryptedData pointer into EDI\n; Now EDI points to another address, which means that the fourth\n; field of the header is an address within the file\nADD EDI, ESI\n```\n\nAlrighty! Back to the hex editor! The file's value at position `0xC` is `0x0000001C`. This means that now, `EDI` points to wherever the pointer is located in memory, plus `1C` (or 28 in decimal) bytes ahead of the pointer's start. Thus, this strengthens our belief that this field in the header contains an address inside the file where something begins. The value at `1C` is `0x00000000`, so we don't have anything solid yet. Let's continue:\n\n```x86asm\n; Load the third field of the header into EBX\nMOV EBX, EBP\n; Divide EBX by two\nSHR EBX, 1\n; Load into EAX the contents of the address pointed to by \n; EDI (currently at 1C) plus EBP times four.\nLEA EAX, [EDI + EBP * 0x4]\n```\n\n`EBP` stores the data found in the third field of the header. By examining the file, weâ€™ll notice that this value is `0x52C` (or 1324 in decimal). Subsequently, `EBX` stores its half, which is `0x296` (or 662 in decimal). Finally, `EAX` is loaded with the value found at the address pointed to by `EDI` (wherever the pointer lies, plus `0x1C`) plus `0x14B0`, resulting in `0x14CC`.\n\nConveniently, the fifth field of the header contains the value `0x14CC`. Therefore, this must be another address, either the beginning of a section or the end of a section, since the file contains much more data beyond that address. As this starts to look like a pattern, I had to investigate the values of what I thought was the header.\n\n```c\ntypedef struct {\n  int magic;  // Always 'BTXT' \n  int unknown1; // 0x100\n  int unknown2; // 0x52c\n  int unknown3; // 0x1c\n  int unknown4; // 0x14cc\n  int unknown5; // 0x52dc\n  int unknown6; // 0x297c\n} st1header;\n```\n\nI first went to `0x14CC`, which is a strong lead since it appears both in the file and in the calculation in the code. The value at that position is `0x52DC`... Wait, what? A quick jump to `0x52DC` reveals the value `0x72745300`. However, I can see in my hex editor that the string **Strength:** appears, followed by a NUL character. I jumped back to `0x14D0`, which contained the value `0x52DD` where the **Strength:** string begins, and I wondered, *does the pattern continue*?\n\n- `0x14D4` contains the value `0x52E7` => **Mechanism** followed by a NUL character.\n- `0x14D8` contains the value `0x52F1` => **Incantation** followed by a NUL character.\n\nThe last string can be found at address `0x15898`, so by looking for that value in the file, weâ€™d probably find where it is stored. The search reveals that this is found at address `0x2978`, which is strangely close to the value stored in the `unknown6` field in the header. As such, we can deduce that:\n\n1. At `0x001C`, an unknown section starts.\n2. At `0x14CC`, a section that contains addresses of the real strings starts.\n3. At `0x297C`, another unknown section starts.\n4. At `0x52DC`, the strings section starts.\n\n\n```c\ntypedef struct {\n  int magic;  // Always 'BTXT' \n  int unknown1; // 0x100\n  int unknown2; // 0x52c\n  int addrUnknown1; // 0x1c\n  int addrStringLocationStart;\n  int addrStringStart; // 0x52dc\n  int addrUnknown2; // 0x297c\n} st1header;\n```\n\n> Itâ€™s four in the morning, and I think itâ€™s time for me to sleep. Iâ€™m probably killing off the few healthy brain cells I have left, trying to figure out how this thing works. \n> #GiveMeMoreAssembly.\n\n```x86asm\n; Compare EDI (ptr + 0x1C) with EAX (ptr + 0x14CC)\nCMP EDI, EAX\n; Load into EBX the value stored at EDI (ptr + 0x1C)\n; plus EBX multiplied by 4 (to get the correct offset)\nLEA EBX, [EDI + EBX * 0x4]\nJNC return\n```\n\n![Where we currently stand](../../assets/st1-file-structure-1.png)\n\n```x86asm\nLAB_0041610a:\n; Load the contents pointed to by EBX into ECX\nMOV ECX, dword ptr [EBX]\n; Compare the value in ECX with EDX (param_2)\nCMP ECX, EDX\n; If they are equal, jump to LAB_0041612d\nJZ LAB_0041612d\nJLE LAB_00416116\n; Load EBX into EAX for further processing\nMOV EAX, EBX\nJMP LAB_00416119\n\n```\n\nNow we are getting somewhere! First and foremost, we identified that `param_2` is used for matching something from the *Unknown 1* area, so it must be important for the game and will most likely give us more answers. Instead of continuing to read assembly, we'll perform some **speculative execution** and assume that we have a match; thus, we are going to jump to `LAB_0041612d`. \n\nThe _we have a match_ code is pretty straightforward and reveals even more information about the structure of the file and the algorithm that is used to search for a string inside the strings file. Firstly, it uses the address of `EBP`, which is the address of the matching element, and adds to it the third field of the structure multiplied by 4, in order to access the **String Locations Area**. From that point, it reads the value at the given location and resolves it to find the string, setting the pointer &mdash; the first field of the structure found in `param_3` &mdash; to the actual string. Subsequently, it finds the relevant position in the **Unknown 2 Area** and sets the next two fields of the structure to the values found in the file.\n\nAs such, we can make the following observations:\n\n1. The **Unknown 1 Area** contains the String IDs sorted in ascending order; thus, `param_2` is the ID of the string we want to retrieve.\n2. The third parameter of the function is a structure that contains a pointer to the actual string and extra data obtained from the file. The **Unknown 2 Area** contains this extra data.\n3. The header of the file and the structure containing the information we want look like the following:\n\n```c\ntypedef struct {\n  int magic;      // Always 'BTXT'\n  int unknown;    // 0x100, probably version or other flags\n  int nEntries;   // Number of strings in the file\n  int addrIdx;    // Address of the index section\n  int addrStrLoc; // Address of the strings location section\n  int addrStrSec; // Address of the strings section\n  int addrExtra;  // Address of extra data section    \n} StringTableHeader;\n\ntypedef struct {\n  char* string;   // Pointer to the actual string\n  int unknown1;   // Unknown extra data\n  int unknown2;   // Unknown extra data\n} StringEntry;\n```\n\n## Verifying Our Claims\n\nLet's say that we are looking for the string with ID = `45141`. The game will perform a binary search (which is *fast*) to determine where this value is located in the Index Section. When it does, it will add `0x14B0` (or the number of entries * 4) to move the the Strings Location Section in order to find where the string is located in the file. It will extract the string (and the extra data found at `0x297C` plus the position of the index in the Index Section) and return a `StringEntry` structure:\n\n![Do you want to recruit this warrior?](../../assets/hexplore-warrior-1.webp)\n\n> It's time to settle the score with Garkham and his army of monstrous glores. \n> I am a powerful and brave-hearted warrior. I would like to offer my services to your band!\n\nThe most interesting part of this approach is that when Hexplore requires loading a string for displaying, it only needs 12 bytes of memory since it does not copy the string to the `StringEntry` structure but uses a _reference_ to its location in the `decryptedData`! Talk about optimizations and resource conservation!\n\nArmed with all this information, I can start working on something solid &mdash; a library to read and write the String Table (I guess that `st1` means *String Table version 1*), which can be used both in the development of a tool (for modding) and for the recreation of the engine, should I ever decide to pursue it.\n\n## What's Next\n\nOne milestone down, many more to go! There are many more file types to understand, document, and manipulate, among which are:\n\n1. `sb0` files, which contain textures.\n2. `vb1` files, which contain 3D assets.\n3. `bin` files, which contain information about levels, maps, heroes, and other game-related data.\n4. `sbk` files, which contain music and sound samples.\n5. `sav` files, which contain save data.\n\nHowever, things are going to get serious since I'll have to reverse engineer the graphics engine, the sound engine, and the game engine to understand these data files. Maybe not in their entirety, but I'll need to have a very clear picture of how they work and how they use the files and the data that resides in them to perform the same work as I did here.\n\nI am not entirely sure what I will settle on; for the time being, I'm just moving around, reverse engineering here and there, and documenting things. Maybe I'll have something solid the next time we speak, maybe I won't. However, one thing is certain: The process is underway.","src/content/blog/reverse-engineering-hexplore-2.md",[183,184,185,186],"../../assets/hexplore-glore.webp","../../assets/st1-file-structure-1.png","../../assets/hexplore-warrior-1.webp","../../assets/hexplore-2.webp","b657f32f6712c4ce",{"html":189,"metadata":190},"\u003Cp>Video games are a unique kind of beast in the realm of software developmentâ€”\u003Cem>arenâ€™t they all?\u003C/em> you might ask, and youâ€™d be right. From operating systems to applications written for embedded systems, and from servers and services to ERPs and CRMs, each domain has its own quirks. I wonâ€™t claim that video games belong to the toughest or weirdest domainâ€”such a statement would be a blatant exaggeration. However, they are unique, both because of the constraints they impose on developers and the ways in which companies (and by extension, developers) get paid for them.\u003C/p>\n\u003Ch2 id=\"mumbling\">Mumbling\u003C/h2>\n\u003Cp>While delving into how games generate profit is irrelevant to our current journey, understanding the constraints imposed on developers by the platform, available technology, and industry standards is crucial. As briefly discussed in my previous post, \u003Cem>Hexplore\u003C/em> was developed in the mid-â€™90s, when GPUs were not as advanced or widely accessible to home users, Pentium processors had just started dominating the market over older Intel/AMD/Cyrix models, CD-ROMs were relatively new, and hard drives were small and slow.\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth align=\"center\">\u003Cstrong>Component\u003C/strong>\u003C/th>\u003Cth>\u003Cstrong>Requirement\u003C/strong>\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd align=\"center\">\u003Cstrong>CPU\u003C/strong>\u003C/td>\u003Ctd>Pentium 100MHz or \u003Cem>100% compatible\u003C/em>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd align=\"center\">\u003Cstrong>RAM\u003C/strong>\u003C/td>\u003Ctd>16 MB\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd align=\"center\">\u003Cstrong>CD-ROM\u003C/strong>\u003C/td>\u003Ctd>4x speed (600kb/s)\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd align=\"center\">\u003Cstrong>Sound\u003C/strong>\u003C/td>\u003Ctd>Sound Blaster 16-bit or \u003Cem>compatible\u003C/em>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd align=\"center\">\u003Cstrong>GPU\u003C/strong>\u003C/td>\u003Ctd>SVGA Video Card\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd align=\"center\">\u003Cstrong>OS\u003C/strong>\u003C/td>\u003Ctd>Windows 95/98\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cp>These are the system requirements for \u003Cem>Hexplore\u003C/em>. While they may seem irrelevant at first glance, they serve as a constant reminder to stop questioning why developers made certain decisionsâ€”this game is over a quarter of a century old. Itâ€™s important to note that a Pentium running at 100MHz could execute at most two instructions per cycle[^1], but most of the time, it would execute just one. Additionally, some instructions take more than one cycle to complete, and access to EDO RAM was slow. When combined with the fact that Pentiums lacked many of the features modern processors boast (e.g., \u003Ca href=\"https://en.wikipedia.org/wiki/Out-of-order_execution\">out-of-order execution\u003C/a>, \u003Ca href=\"https://en.wikipedia.org/wiki/Out-of-order_execution\">speculative execution\u003C/a>, and \u003Ca href=\"https://en.wikipedia.org/wiki/Out-of-order_execution\">cache prefetching\u003C/a>), execution speed becomes a critical factor. Simply put, 100MHz means the processor could perform 10\u003Csup>8\u003C/sup> \u003Ca href=\"https://en.wikipedia.org/wiki/Instruction_cycle\">instruction cycles\u003C/a> per secondâ€”meaning each instruction cycle took roughly 10ns.\u003C/p>\n\u003Cp>The Pentium was a single-core, single-thread CPU, meaning only one process could execute at any given time. Windows 95, however, was a true multitasking OS â€” it employed \u003Ca href=\"https://en.wikipedia.org/wiki/Preemption_(computing)\">preemptive multitasking\u003C/a> to allow multiple processes to appear to run simultaneously. This is seamless to the user, as \u003Ca href=\"https://en.wikipedia.org/wiki/Preemption_(computing)#Time_slice\">time slices\u003C/a> are calculated by the scheduler to meet the needs of each process. However, this adds extra overhead that developers had to take into account. Their applications had to compete with others for resources, so they needed to execute tasks efficiently to prevent users from experiencing lag or slow loading.\u003C/p>\n\u003Cp>Moreover, while the \u003Cem>10GB barrier\u003C/em> was broken in 1997, a typical hard drive had a capacity of around 4GBâ€”which had to store the OS, other applications, documents, and more. As a result, most games of the era offered players the option to perform a minimal installation, copying only essential files to the hard drive while loading the rest from the CD-ROM as needed. This extended loading times, but given the hardware limitations, it was the preferable option for most users. For context, a 1x CD-ROM speed was equivalent to 150kb/sâ€”\u003Cem>Hexplore\u003C/em> required a 4x CD-ROM (or faster). A file from the gameâ€™s first level, for example, is 2.1MB, so in an ideal scenario, it would take around 4 seconds to load.\u003C/p>\n\u003Cp>Many of us remember placing the mouse cursor at the tip of a progress bar, anxiously wondering if an installation had frozenâ€”yes, loading times in the â€™90s were often a painful experience. This is why developers employed clever techniques to reduce overhead, improve speed and responsiveness, and squeeze the best performance possible out of the hardware we had at the time.\u003C/p>\n\u003Ch2 id=\"first-steps\">First steps\u003C/h2>\n\u003Cp>When we \u003Ca href=\"https://mistericy.github.io/2024/09/20/Reverse-Engineering-Hexplore-My-Journey-Begins/\">last left\u003C/a> our adventurer, he was discussing the gameâ€™s texts. While I was correct in assuming that the gameâ€™s strings are stored in the \u003Ccode>Gbtxt.st1\u003C/code> file, it took me quite some time to understand not only the fileâ€™s structure but also how \u003Cem>Hexplore\u003C/em> uses it.\u003C/p>\n\u003Cp>The first and most logical step was to search the file for a well-known string, like a game message or the name of an enemy. If you havenâ€™t met him yet, hereâ€™s Glore:\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../assets/hexplore-glore.webp&#x22;,&#x22;alt&#x22;:&#x22;A Glore, one of Garkham&#x27;s Minions&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Cp>Glores are described as \u003Cem>monstrous scum\u003C/em> and emit a vile laughter when you enter their line of sight and they decide to attack. While there are numerous references to glores in the game (hint: 18), I wasnâ€™t able to find any in the data file. The next logical step was to open the file with a hex editor and check for anything legible inside. However, I found no clues, as the file appeared entirely composed of garbage. Declaring it a dead end, I returned to Ghidra to continue reverse engineering the game.\u003C/p>\n\u003Cp>Searching for \u003Ccode>.st1\u003C/code> in the \u003Cstrong>Defined Strings\u003C/strong> window revealed one result: \u003Ccode>txt.st1\u003C/code>. The fact that \u003Cstrong>Gb\u003C/strong> is missing is pretty strange, hinting that weâ€™re in for a surprise. This string is referenced \u003Cem>only twice\u003C/em> in the entire program (at least, thatâ€™s what Ghidra detected), so finding where the string loading and decrypting functionality occurs should be straightforward.\u003C/p>\n\u003Cp>Upon visiting the first location, weâ€™re greeted by a long function. The first thing it does? It calls \u003Ccode>sprintf\u003C/code> to generate a file path using the format: \u003Ccode>%s\\%s%s\u003C/code>. The first argument is \u003Ccode>\"common\"\u003C/code>â€”thereâ€™s our directory. The third argument is the \u003Ccode>txt.st1\u003C/code> string. Logically, the middle argument should be \u003Ccode>Gb\u003C/code>â€¦ but how?\u003C/p>\n\u003Cp>Letâ€™s make a deviationâ€¦\u003C/p>\n\u003Ch2 id=\"detecting-the-games-language\">Detecting the Gameâ€™s Language\u003C/h2>\n\u003Cp>If we backtrack a bit, weâ€™ll notice a function call in \u003Ccode>WinMain\u003C/code>, just before the gameâ€™s main loop begins. This function is called with a reference to a structure and, \u003Cem>I guess\u003C/em>, it performs some kind of initialization before allowing the game to proceed to the main loop. The function starts with a call to \u003Ca href=\"https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-getcurrentdirectory\">\u003Ccode>GetCurrentDirectoryA\u003C/code>\u003C/a>â€”which is a curious choice. It stores the current directory in the aforementioned structure and then creates the following string:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"c\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">sprintf\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(buffer, \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"\u003C/span>\u003Cspan style=\"color:#79B8FF\">%s\\\\%s\\\\\u003C/span>\u003Cspan style=\"color:#9ECBFF\">??\u003C/span>\u003Cspan style=\"color:#79B8FF\">%s\u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, game\u003C/span>\u003Cspan style=\"color:#F97583\">->\u003C/span>\u003Cspan style=\"color:#FFAB70\">gameDir\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"common\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#9ECBFF\">\"txt.st1\"\u003C/span>\u003Cspan style=\"color:#E1E4E8\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>It then immediately calls \u003Ca href=\"https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-findfirstfilea\">\u003Ccode>FindFirstFileA\u003C/code>\u003C/a>:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"c\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">WIN32_FIND_DATAA findData;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">HANDLE hFindFile \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> FindFirstFileA\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(buffer, \u003C/span>\u003Cspan style=\"color:#F97583\">&#x26;\u003C/span>\u003Cspan style=\"color:#FFAB70\">findData\u003C/span>\u003Cspan style=\"color:#E1E4E8\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (hFindFile \u003C/span>\u003Cspan style=\"color:#F97583\">!=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> INVALID_HANDLE_VALUE) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">  // We found something:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  gameLanguage\u003C/span>\u003Cspan style=\"color:#E1E4E8\">[\u003C/span>\u003Cspan style=\"color:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">] \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> findData.cFileName[\u003C/span>\u003Cspan style=\"color:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  gameLanguage\u003C/span>\u003Cspan style=\"color:#E1E4E8\">[\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">] \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> findData.cFileName[\u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  gameLanguage\u003C/span>\u003Cspan style=\"color:#E1E4E8\">[\u003C/span>\u003Cspan style=\"color:#79B8FF\">2\u003C/span>\u003Cspan style=\"color:#E1E4E8\">] \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> '\u003C/span>\u003Cspan style=\"color:#79B8FF\">\\0\u003C/span>\u003Cspan style=\"color:#9ECBFF\">'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>So, if the file were named \u003Ccode>Gntxt.st1\u003C/code>, would the gameâ€™s language be set to \u003Ccode>Gn\u003C/code> (\u003Cem>hint: German\u003C/em>)? Oh yes, it would!\u003C/p>\n\u003Cp>Thereâ€™s little point in debating whether this decision was good or bad. Itâ€™s certainly an odd one, considering the developers could have chosen a more straightforward way to detect the gameâ€™s language. For example, they could have written a value to the Windows Registry during the gameâ€™s installation.\u003C/p>\n\u003Cp>When the game starts, the memory location where the language will eventually be stored contains the string \u003Ccode>XX\u003C/code>, which is then updated by this method. However, another curious decision stands out: the use of \u003Ccode>GetCurrentDirectoryA\u003C/code>.\u003C/p>\n\u003Cp>According to Microsoftâ€™s documentation, this function \u003Cem>retrieves the current directory for the current process\u003C/em>. But what exactly is the current directory? While not explicitly explained in the documentation, it refers to the directory youâ€™re currently in when launching the application. For instance, if the game is installed in \u003Ccode>C:\\Hexplore\\\u003C/code> and you open a command prompt at \u003Ccode>C:\\\u003C/code> and run \u003Ccode>.\\Hexplore\\hexplore.exe\u003C/code>, guess what? \u003Ccode>GetCurrentDirectoryA\u003C/code> will return \u003Ccode>C:\\\u003C/code>. You see where this is going?\u003C/p>\n\u003Cp>If we try this little experiment, weâ€™ll notice that \u003Cem>Hexplore\u003C/em> will fail to start, displaying a message box that reads \u003Cstrong>FILE ERROR: 5\u003C/strong> along with the problematic file path (in our case, \u003Ccode>C:\\common\\XXtxt.st1\u003C/code>).\u003C/p>\n\u003Cp>A better approach here would be to use \u003Ca href=\"https://learn.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulefilenamea\">\u003Ccode>GetModuleFileNameA\u003C/code>\u003C/a>, which retrieves the actual path of the executable. With a bit of string manipulation, the correct path could be derived, and small bugs like this wouldnâ€™t exist (\u003Cem>Note to future self: make it fail-proof when you start implementing it\u003C/em>).\u003C/p>\n\u003Ch2 id=\"back-to-string-finding\">Back to String Finding\u003C/h2>\n\u003Cp>Right after setting the gameâ€™s language, \u003Cem>Hexplore\u003C/em> calls the long function that greeted us earlier. As we discussed, it crafts the proper path to the file and stores it in a buffer. It then proceeds to check if the file exists and loads it into memory.\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"c\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">void\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> __cdecl \u003C/span>\u003Cspan style=\"color:#B392F0\">LoadStringsFromDisk\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(LPCSTR \u003C/span>\u003Cspan style=\"color:#FFAB70\">fileName\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003Cspan style=\"color:#F97583\">char\u003C/span>\u003Cspan style=\"color:#F97583\"> *\u003C/span>\u003Cspan style=\"color:#FFAB70\">data\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003Cspan style=\"color:#F97583\">int\u003C/span>\u003Cspan style=\"color:#FFAB70\"> shouldDecryptStrings\u003C/span>\u003Cspan style=\"color:#E1E4E8\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>This function does the following:\u003C/p>\n\u003Cul>\n\u003Cli>Retrieves a handle for the file.\u003C/li>\n\u003Cli>Retrieves the fileâ€™s size.\u003C/li>\n\u003Cli>Allocates memory to store the file.\u003C/li>\n\u003Cli>Reads the file.\u003C/li>\n\u003Cli>Closes the file.\u003C/li>\n\u003C/ul>\n\u003Cp>All steps use the Windows API to perform file operations.\u003C/p>\n\u003Cp>Subsequently, if the \u003Ccode>shouldDecryptStrings\u003C/code> parameter is not equal to \u003Ccode>0\u003C/code>, it proceeds with decrypting the data in place.\u003C/p>\n\u003Cp>\u003Cem>Hexplore\u003C/em> has an intricate and interesting way of accessing files, which will be analyzed in another post once I have completely figured it out. For the time being, what is important is to see how the decryption takes place.\u003C/p>\n\u003Ch3 id=\"decryption\">Decryption\u003C/h3>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"c\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// Simplified version of loading the data from disk:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">long\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> size \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> GetFileSize\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(handle);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">char*\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> data \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (\u003C/span>\u003Cspan style=\"color:#F97583\">char*\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003Cspan style=\"color:#B392F0\">malloc\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(size);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">ReadData\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(handle, data, size);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (shouldDecryptStrings \u003C/span>\u003Cspan style=\"color:#F97583\">!=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  char\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> key \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#F97583\"> 0x\u003C/span>\u003Cspan style=\"color:#79B8FF\">37\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003Cspan style=\"color:#6A737D\"> // Set the initial key\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> i \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003Cspan style=\"color:#6A737D\"> // Set the counter \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  while\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (i \u003C/span>\u003Cspan style=\"color:#F97583\">&#x3C;\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> size) {\u003C/span>\u003Cspan style=\"color:#6A737D\"> // While there is data in the buffer\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    char\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> temp \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#FFAB70\"> buffer\u003C/span>\u003Cspan style=\"color:#E1E4E8\">[i] \u003C/span>\u003Cspan style=\"color:#F97583\">^\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> key;\u003C/span>\u003Cspan style=\"color:#6A737D\"> // XOR the current character with the key\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    key \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> key \u003C/span>\u003Cspan style=\"color:#F97583\">+\u003C/span>\u003Cspan style=\"color:#FFAB70\"> buffer\u003C/span>\u003Cspan style=\"color:#E1E4E8\">[i] \u003C/span>\u003Cspan style=\"color:#F97583\">+\u003C/span>\u003Cspan style=\"color:#F97583\"> 0x\u003C/span>\u003Cspan style=\"color:#79B8FF\">33\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003Cspan style=\"color:#6A737D\"> // Add 0x33, the current character, and the key to key\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">    buffer\u003C/span>\u003Cspan style=\"color:#E1E4E8\">[i] \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> temp;\u003C/span>\u003Cspan style=\"color:#6A737D\"> // Store the decrypted character\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    i\u003C/span>\u003Cspan style=\"color:#F97583\">++\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003Cspan style=\"color:#6A737D\"> // Increment the counter\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Since I had never encountered this type of encryption before, I did some research and found that it resembles a \u003Ca href=\"https://en.wikipedia.org/wiki/Stream_cipher\">Stream Cipher\u003C/a>.\u003C/p>\n\u003Cp>While Iâ€™m no expert on encryption, Iâ€™d like to share a few observations:\u003C/p>\n\u003Col>\n\u003Cli>This encryption implementation serves a dual purpose: on one hand, it adds a layer of complexity to the data, making it harder for players to modify the game or inadvertently break it while trying to mod it. On the other hand, it helps protect the gameâ€™s integrity, ensuring that players experience the game as intended.\u003C/li>\n\u003Cli>The decryption process is quite efficient, as it performs a per-byte XOR operation, which is lightweight (\u003Cem>hint: takes 1 instruction cycle on the Pentium\u003C/em>). As mentioned earlier, in the realm of video games, speed and efficiency are crucial to prevent choppy gameplay or long loading times.\u003C/li>\n\u003Cli>The use of a dynamic key per byte introduces an additional layer of obfuscation that makes simple attacks more challenging. This prevents easy key prediction and makes brute-force attempts more difficult.\u003C/li>\n\u003Cli>While this method might seem simplistic by todayâ€™s standards, it highlights the creative solutions game developers employed in the â€™90s to protect their games. Even simple encryption methods like this could deter casual modding and hacking efforts.\u003C/li>\n\u003C/ol>\n\u003Ch2 id=\"its-decrypted-but-it-still-makes-no-sense\">Itâ€™s Decrypted, but It Still Makes No Sense\u003C/h2>\n\u003Cp>After writing some quick and dirty code to decrypt the file and store it locally in its decrypted form, I opened it again with a hex editor to investigate its contents. While I was able to find \u003Cem>Glore\u003C/em> and all of the strings used in the game, I was puzzled by the fileâ€™s structure. It seems to have a header and contains much more data than just the gameâ€™s strings. Since I was not able to find any information on the internet regarding this file format, I believe it is probably a proprietary format used exclusively for this game. \u003Ca href=\"https://www.mobygames.com/company/1859/doki-denki-sa/\">Heliovisions\u003C/a> released six games, and of those, only \u003Cstrong>two\u003C/strong> were released for Windows. It is highly unlikely that they used this format in another game, and researching further into this matter seems futile. While one approach would be to look up the gameâ€™s credits and search for other games created by \u003Cem>Hexplore\u003C/em>â€™s development team, itâ€™s uncertain that I would find anything. Thusâ€¦\u003C/p>\n\u003Cp>Back at Ghidra. Right after the call to \u003Ccode>LoadStringsFromDisk\u003C/code>, thereâ€™s another call whose first argument is a pointer to the unencrypted data. Interestingâ€¦ Letâ€™s follow it to see where it leads us.\u003C/p>\n\u003Ch2 id=\"fun_004160a0\">\u003Ccode>FUN_004160a0\u003C/code>\u003C/h2>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"c\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">void\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> __cdecl \u003C/span>\u003Cspan style=\"color:#B392F0\">FUN_004160a0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#F97583\">char\u003C/span>\u003Cspan style=\"color:#F97583\"> *\u003C/span>\u003Cspan style=\"color:#FFAB70\">decryptedData\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003Cspan style=\"color:#F97583\">uint\u003C/span>\u003Cspan style=\"color:#FFAB70\"> param_2\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003Cspan style=\"color:#F97583\">int\u003C/span>\u003Cspan style=\"color:#F97583\"> *\u003C/span>\u003Cspan style=\"color:#FFAB70\">param_3\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>First of all, the function performs a simple check to determine whether the pointer that contains the decrypted data is allocated. Subsequently, it checks if its first integer element equals \u003Ccode>0x54585423\u003C/code>. Since X86 is \u003Ca href=\"https://en.wikipedia.org/wiki/Endianness\">little-endian\u003C/a>, this corresponds to \u003Ccode>0x42545854\u003C/code>, or \u003Ccode>BTXT\u003C/code> if translated to ASCII. Hey! I think weâ€™ve found a header, since this seems like a \u003Ca href=\"https://en.wikipedia.org/wiki/File_format#Magic_number\">magic number\u003C/a>!\u003C/p>\n\u003Cp>The next check is against the 3rd integer in the decrypted data (\u003Ccode>0x08\u003C/code>) and ensures that it is not equal to 0. \u003Cem>Definitely a header\u003C/em>. Finally, it checks if the third parameter isnâ€™t \u003Ccode>NULL\u003C/code> and that the second parameter is less than \u003Ccode>100000000\u003C/code>.\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"plaintext\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan>; First check: Is the pointer allocated?\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>MOV ESI, dword ptr [ESP + decryptedData]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>TEST ESI, ESI                   \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>JZ return\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>; Second check: Is the first four bytes of the header valid?\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>MOV EAX, dword ptr [ESI]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>CMP EAX, 0x54585442\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>JNZ return\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>; Third check: Is the third element of the header not zero?\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>MOV EAX, dword ptr [ESI + 0x08]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>TEST EAX, EAX\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>JZ return\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>; Fourth check: Is the third parameter of the function allocated? \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>MOV ECX, dword ptr [ESP + param_3]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>TEST ECX, ECX\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>JZ return\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>; Fifth check: Is the second parameter less than 100000000?\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>MOV EDX, dword ptr [ESP + param_2]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>CMP EDX, 0x5f5e0ff\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>JA return\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>With these clues so far, we can deduce that the file does have a header, so we will continue investigating the function to determine how long the header is, from which fields it is composed, and what values they have. Moving on, the function performs some initialization of \u003Ccode>param_3\u003C/code>:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"plaintext\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan>MOV dword ptr [ECX],0x0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>MOV dword ptr [ECX + 0x4],0x0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>MOV dword ptr [ECX + 0x8],0xffffffff\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>It seems that \u003Ccode>param_3\u003C/code> is a structure which might look like the following:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"c\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">typedef\u003C/span>\u003Cspan style=\"color:#F97583\"> struct\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  void*\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> unknown1;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  void*\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> unknown2;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> unknown3;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">} UnknownStruct;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Subsequently, the function runs the following code:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"plaintext\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan>; Load into EDI the fourth field of the header\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>MOV EDI, dword ptr [ESI + 0xc]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>; Load into EBP the third field of the header\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>MOV EBP, dword ptr [ESI + 0x8]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>; Add the base address of the decryptedData pointer into EDI\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>; Now EDI points to another address, which means that the fourth\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>; field of the header is an address within the file\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>ADD EDI, ESI\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Alrighty! Back to the hex editor! The fileâ€™s value at position \u003Ccode>0xC\u003C/code> is \u003Ccode>0x0000001C\u003C/code>. This means that now, \u003Ccode>EDI\u003C/code> points to wherever the pointer is located in memory, plus \u003Ccode>1C\u003C/code> (or 28 in decimal) bytes ahead of the pointerâ€™s start. Thus, this strengthens our belief that this field in the header contains an address inside the file where something begins. The value at \u003Ccode>1C\u003C/code> is \u003Ccode>0x00000000\u003C/code>, so we donâ€™t have anything solid yet. Letâ€™s continue:\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"plaintext\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan>; Load the third field of the header into EBX\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>MOV EBX, EBP\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>; Divide EBX by two\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>SHR EBX, 1\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>; Load into EAX the contents of the address pointed to by \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>; EDI (currently at 1C) plus EBP times four.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>LEA EAX, [EDI + EBP * 0x4]\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Ccode>EBP\u003C/code> stores the data found in the third field of the header. By examining the file, weâ€™ll notice that this value is \u003Ccode>0x52C\u003C/code> (or 1324 in decimal). Subsequently, \u003Ccode>EBX\u003C/code> stores its half, which is \u003Ccode>0x296\u003C/code> (or 662 in decimal). Finally, \u003Ccode>EAX\u003C/code> is loaded with the value found at the address pointed to by \u003Ccode>EDI\u003C/code> (wherever the pointer lies, plus \u003Ccode>0x1C\u003C/code>) plus \u003Ccode>0x14B0\u003C/code>, resulting in \u003Ccode>0x14CC\u003C/code>.\u003C/p>\n\u003Cp>Conveniently, the fifth field of the header contains the value \u003Ccode>0x14CC\u003C/code>. Therefore, this must be another address, either the beginning of a section or the end of a section, since the file contains much more data beyond that address. As this starts to look like a pattern, I had to investigate the values of what I thought was the header.\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"c\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">typedef\u003C/span>\u003Cspan style=\"color:#F97583\"> struct\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> magic;\u003C/span>\u003Cspan style=\"color:#6A737D\">  // Always 'BTXT' \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> unknown1;\u003C/span>\u003Cspan style=\"color:#6A737D\"> // 0x100\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> unknown2;\u003C/span>\u003Cspan style=\"color:#6A737D\"> // 0x52c\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> unknown3;\u003C/span>\u003Cspan style=\"color:#6A737D\"> // 0x1c\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> unknown4;\u003C/span>\u003Cspan style=\"color:#6A737D\"> // 0x14cc\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> unknown5;\u003C/span>\u003Cspan style=\"color:#6A737D\"> // 0x52dc\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> unknown6;\u003C/span>\u003Cspan style=\"color:#6A737D\"> // 0x297c\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">} st1header;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>I first went to \u003Ccode>0x14CC\u003C/code>, which is a strong lead since it appears both in the file and in the calculation in the code. The value at that position is \u003Ccode>0x52DC\u003C/code>â€¦ Wait, what? A quick jump to \u003Ccode>0x52DC\u003C/code> reveals the value \u003Ccode>0x72745300\u003C/code>. However, I can see in my hex editor that the string \u003Cstrong>Strength:\u003C/strong> appears, followed by a NUL character. I jumped back to \u003Ccode>0x14D0\u003C/code>, which contained the value \u003Ccode>0x52DD\u003C/code> where the \u003Cstrong>Strength:\u003C/strong> string begins, and I wondered, \u003Cem>does the pattern continue\u003C/em>?\u003C/p>\n\u003Cul>\n\u003Cli>\u003Ccode>0x14D4\u003C/code> contains the value \u003Ccode>0x52E7\u003C/code> => \u003Cstrong>Mechanism\u003C/strong> followed by a NUL character.\u003C/li>\n\u003Cli>\u003Ccode>0x14D8\u003C/code> contains the value \u003Ccode>0x52F1\u003C/code> => \u003Cstrong>Incantation\u003C/strong> followed by a NUL character.\u003C/li>\n\u003C/ul>\n\u003Cp>The last string can be found at address \u003Ccode>0x15898\u003C/code>, so by looking for that value in the file, weâ€™d probably find where it is stored. The search reveals that this is found at address \u003Ccode>0x2978\u003C/code>, which is strangely close to the value stored in the \u003Ccode>unknown6\u003C/code> field in the header. As such, we can deduce that:\u003C/p>\n\u003Col>\n\u003Cli>At \u003Ccode>0x001C\u003C/code>, an unknown section starts.\u003C/li>\n\u003Cli>At \u003Ccode>0x14CC\u003C/code>, a section that contains addresses of the real strings starts.\u003C/li>\n\u003Cli>At \u003Ccode>0x297C\u003C/code>, another unknown section starts.\u003C/li>\n\u003Cli>At \u003Ccode>0x52DC\u003C/code>, the strings section starts.\u003C/li>\n\u003C/ol>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"c\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">typedef\u003C/span>\u003Cspan style=\"color:#F97583\"> struct\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> magic;\u003C/span>\u003Cspan style=\"color:#6A737D\">  // Always 'BTXT' \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> unknown1;\u003C/span>\u003Cspan style=\"color:#6A737D\"> // 0x100\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> unknown2;\u003C/span>\u003Cspan style=\"color:#6A737D\"> // 0x52c\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> addrUnknown1;\u003C/span>\u003Cspan style=\"color:#6A737D\"> // 0x1c\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> addrStringLocationStart;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> addrStringStart;\u003C/span>\u003Cspan style=\"color:#6A737D\"> // 0x52dc\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> addrUnknown2;\u003C/span>\u003Cspan style=\"color:#6A737D\"> // 0x297c\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">} st1header;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cblockquote>\n\u003Cp>Itâ€™s four in the morning, and I think itâ€™s time for me to sleep. Iâ€™m probably killing off the few healthy brain cells I have left, trying to figure out how this thing works.\n#GiveMeMoreAssembly.\u003C/p>\n\u003C/blockquote>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"plaintext\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan>; Compare EDI (ptr + 0x1C) with EAX (ptr + 0x14CC)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>CMP EDI, EAX\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>; Load into EBX the value stored at EDI (ptr + 0x1C)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>; plus EBX multiplied by 4 (to get the correct offset)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>LEA EBX, [EDI + EBX * 0x4]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>JNC return\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../assets/st1-file-structure-1.png&#x22;,&#x22;alt&#x22;:&#x22;Where we currently stand&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"plaintext\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan>LAB_0041610a:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>; Load the contents pointed to by EBX into ECX\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>MOV ECX, dword ptr [EBX]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>; Compare the value in ECX with EDX (param_2)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>CMP ECX, EDX\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>; If they are equal, jump to LAB_0041612d\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>JZ LAB_0041612d\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>JLE LAB_00416116\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>; Load EBX into EAX for further processing\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>MOV EAX, EBX\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>JMP LAB_00416119\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>Now we are getting somewhere! First and foremost, we identified that \u003Ccode>param_2\u003C/code> is used for matching something from the \u003Cem>Unknown 1\u003C/em> area, so it must be important for the game and will most likely give us more answers. Instead of continuing to read assembly, weâ€™ll perform some \u003Cstrong>speculative execution\u003C/strong> and assume that we have a match; thus, we are going to jump to \u003Ccode>LAB_0041612d\u003C/code>.\u003C/p>\n\u003Cp>The \u003Cem>we have a match\u003C/em> code is pretty straightforward and reveals even more information about the structure of the file and the algorithm that is used to search for a string inside the strings file. Firstly, it uses the address of \u003Ccode>EBP\u003C/code>, which is the address of the matching element, and adds to it the third field of the structure multiplied by 4, in order to access the \u003Cstrong>String Locations Area\u003C/strong>. From that point, it reads the value at the given location and resolves it to find the string, setting the pointer â€” the first field of the structure found in \u003Ccode>param_3\u003C/code> â€” to the actual string. Subsequently, it finds the relevant position in the \u003Cstrong>Unknown 2 Area\u003C/strong> and sets the next two fields of the structure to the values found in the file.\u003C/p>\n\u003Cp>As such, we can make the following observations:\u003C/p>\n\u003Col>\n\u003Cli>The \u003Cstrong>Unknown 1 Area\u003C/strong> contains the String IDs sorted in ascending order; thus, \u003Ccode>param_2\u003C/code> is the ID of the string we want to retrieve.\u003C/li>\n\u003Cli>The third parameter of the function is a structure that contains a pointer to the actual string and extra data obtained from the file. The \u003Cstrong>Unknown 2 Area\u003C/strong> contains this extra data.\u003C/li>\n\u003Cli>The header of the file and the structure containing the information we want look like the following:\u003C/li>\n\u003C/ol>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"c\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">typedef\u003C/span>\u003Cspan style=\"color:#F97583\"> struct\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> magic;\u003C/span>\u003Cspan style=\"color:#6A737D\">      // Always 'BTXT'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> unknown;\u003C/span>\u003Cspan style=\"color:#6A737D\">    // 0x100, probably version or other flags\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> nEntries;\u003C/span>\u003Cspan style=\"color:#6A737D\">   // Number of strings in the file\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> addrIdx;\u003C/span>\u003Cspan style=\"color:#6A737D\">    // Address of the index section\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> addrStrLoc;\u003C/span>\u003Cspan style=\"color:#6A737D\"> // Address of the strings location section\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> addrStrSec;\u003C/span>\u003Cspan style=\"color:#6A737D\"> // Address of the strings section\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> addrExtra;\u003C/span>\u003Cspan style=\"color:#6A737D\">  // Address of extra data section    \u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">} StringTableHeader;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">typedef\u003C/span>\u003Cspan style=\"color:#F97583\"> struct\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  char*\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> string;\u003C/span>\u003Cspan style=\"color:#6A737D\">   // Pointer to the actual string\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> unknown1;\u003C/span>\u003Cspan style=\"color:#6A737D\">   // Unknown extra data\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  int\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> unknown2;\u003C/span>\u003Cspan style=\"color:#6A737D\">   // Unknown extra data\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">} StringEntry;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"verifying-our-claims\">Verifying Our Claims\u003C/h2>\n\u003Cp>Letâ€™s say that we are looking for the string with ID = \u003Ccode>45141\u003C/code>. The game will perform a binary search (which is \u003Cem>fast\u003C/em>) to determine where this value is located in the Index Section. When it does, it will add \u003Ccode>0x14B0\u003C/code> (or the number of entries * 4) to move the the Strings Location Section in order to find where the string is located in the file. It will extract the string (and the extra data found at \u003Ccode>0x297C\u003C/code> plus the position of the index in the Index Section) and return a \u003Ccode>StringEntry\u003C/code> structure:\u003C/p>\n\u003Cp>\u003Cimg __ASTRO_IMAGE_=\"{&#x22;src&#x22;:&#x22;../../assets/hexplore-warrior-1.webp&#x22;,&#x22;alt&#x22;:&#x22;Do you want to recruit this warrior?&#x22;,&#x22;index&#x22;:0}\">\u003C/p>\n\u003Cblockquote>\n\u003Cp>Itâ€™s time to settle the score with Garkham and his army of monstrous glores.\nI am a powerful and brave-hearted warrior. I would like to offer my services to your band!\u003C/p>\n\u003C/blockquote>\n\u003Cp>The most interesting part of this approach is that when Hexplore requires loading a string for displaying, it only needs 12 bytes of memory since it does not copy the string to the \u003Ccode>StringEntry\u003C/code> structure but uses a \u003Cem>reference\u003C/em> to its location in the \u003Ccode>decryptedData\u003C/code>! Talk about optimizations and resource conservation!\u003C/p>\n\u003Cp>Armed with all this information, I can start working on something solid â€” a library to read and write the String Table (I guess that \u003Ccode>st1\u003C/code> means \u003Cem>String Table version 1\u003C/em>), which can be used both in the development of a tool (for modding) and for the recreation of the engine, should I ever decide to pursue it.\u003C/p>\n\u003Ch2 id=\"whats-next\">Whatâ€™s Next\u003C/h2>\n\u003Cp>One milestone down, many more to go! There are many more file types to understand, document, and manipulate, among which are:\u003C/p>\n\u003Col>\n\u003Cli>\u003Ccode>sb0\u003C/code> files, which contain textures.\u003C/li>\n\u003Cli>\u003Ccode>vb1\u003C/code> files, which contain 3D assets.\u003C/li>\n\u003Cli>\u003Ccode>bin\u003C/code> files, which contain information about levels, maps, heroes, and other game-related data.\u003C/li>\n\u003Cli>\u003Ccode>sbk\u003C/code> files, which contain music and sound samples.\u003C/li>\n\u003Cli>\u003Ccode>sav\u003C/code> files, which contain save data.\u003C/li>\n\u003C/ol>\n\u003Cp>However, things are going to get serious since Iâ€™ll have to reverse engineer the graphics engine, the sound engine, and the game engine to understand these data files. Maybe not in their entirety, but Iâ€™ll need to have a very clear picture of how they work and how they use the files and the data that resides in them to perform the same work as I did here.\u003C/p>\n\u003Cp>I am not entirely sure what I will settle on; for the time being, Iâ€™m just moving around, reverse engineering here and there, and documenting things. Maybe Iâ€™ll have something solid the next time we speak, maybe I wonâ€™t. However, one thing is certain: The process is underway.\u003C/p>",{"headings":191,"localImagePaths":218,"remoteImagePaths":219,"frontmatter":220,"imagePaths":224},[192,195,198,201,204,207,210,213,215],{"depth":52,"slug":193,"text":194},"mumbling","Mumbling",{"depth":52,"slug":196,"text":197},"first-steps","First steps",{"depth":52,"slug":199,"text":200},"detecting-the-games-language","Detecting the Gameâ€™s Language",{"depth":52,"slug":202,"text":203},"back-to-string-finding","Back to String Finding",{"depth":128,"slug":205,"text":206},"decryption","Decryption",{"depth":52,"slug":208,"text":209},"its-decrypted-but-it-still-makes-no-sense","Itâ€™s Decrypted, but It Still Makes No Sense",{"depth":52,"slug":211,"text":212},"fun_004160a0","FUN_004160a0",{"depth":52,"slug":135,"text":214},"Verifying Our Claims",{"depth":52,"slug":216,"text":217},"whats-next","Whatâ€™s Next",[183,184,185],[],{"title":156,"description":157,"pubDate":221,"heroImage":186,"category":87,"tags":222,"excerpt":166,"keywords":223},"2024-10-07",[87,88,89,90,91,161,162,163,164,165],[168,169,170,171,172,173,174,175,176,177,178,179,109,110],[183,184,185],"overcoming-procrastination-frustration-code-stagnation",{"id":225,"data":227,"body":258,"filePath":259,"assetImports":260,"digest":262,"rendered":263},{"title":228,"description":229,"pubDate":230,"heroImage":231,"tags":232,"category":243,"excerpt":244,"keywords":245},"Beat Procrastination, Frustration & Code Stagnation","Discover practical strategies to overcome productive procrastination, developer frustration, and code stagnation. Learn the 30-minute rule, dopamine-driven task management, and the Eisenhower Matrix to break through productivity walls.",["Date","2025-10-07T00:00:00.000Z"],"__ASTRO_IMAGE_../../assets/procrastination.webp",[233,234,235,236,237,238,239,240,241,242],"productive procrastination","developer productivity","software development","impostor syndrome","micro-tasks","task management","Eisenhower Matrix","focus techniques","time management","developer flow","People & Teams","Frustrated by code and endless procrastination? A raw look at overcoming productivity roadblocks, developer frustration, and breaking through code stagnation with practical strategies.",[233,246,234,247,248,249,250,251,252,253,254,255,256,257],"overcoming procrastination","code stagnation","developer frustration","impostor syndrome developers","Eisenhower Matrix productivity","task management developers","micro-tasks dopamine","developer flow state","productivity techniques","time management software development","breaking through procrastination","developer burnout prevention","> A badly documented API is worse than a completely undocumented API.\n\nThere. I said it. When I'm working with undocumented stuff, I know I'll have to poke it until I get a result; even if that result is a `418 I'm a teapot`. But badly documented APIs? The ones where someone clearly *just closed their Jira ticket* **without giving a damn**? Those make me want to punch through my monitor.\n\nThe only thing that kept me back last time? The *Minister of Finance* wouldn't approve the purchase of a new one... (*sigh*)\n\nSo... I tried what the docs said. *Failed*. Read more. *Failed more*. Hacked some things here and there...\n\n(â•¯Â°â–¡Â°)â•¯ï¸µ â”»â”â”»\n\nScrew it, it's 3PM and I need a coffee. Brew a coffee. Scrolled through my emails. Made a mental note to answer one of them. Replied to some Asana comments. Back to the implementation. Threw a couple of `curl` requests to no avail. Sent a message to a colleague about an unrelated matter. Back to Asana. Back to `curl`.\n\nOh, ðŸ¤¬. I'll fix it tomorrow.\n\nTomorrow never came.\n\n## The Anatomy of Productive Procrastination\n\nHere's the thing about productive procrastination: it's **worse than doomscrolling**. At least when you're scrolling throughout Reddit, you know you're procrastinating. You can see it. You can understand it. But *productive procrastination*? It gives you a sense of &laquo;*Hey! I do things*&raquo; or &laquo;*I am working*&raquo; or even &laquo;*I'm not procrastinating*&raquo;.\n\n It keeps you away from your goals and priorities while letting you pretend you're being productive.\n\n The Asana comments. The colleague messages. The email mental notes. All of it feels like work. All of **it is work**, technically. But it's not the work that **matters**.\n\n When I'm frustrated by something (some examples are a badly documented API, a task that's extremely boring, a user story that makes no sense, a project that has no purpose) I do other things. And on those days when I'm feeling self-destructive? Just the feeling of it is enough to send me spiraling into productive procrastination.\n\nThe triggers? As predictable as the fact that *it works on my machine*:\n\n- Badly documented APIs (or worse, APIs documented by someone juggling three remote jobs who needed to show progress on all of them before their 2 PM standup)\n- Soul-crushing, mind-mashing boring tasks that make me wonder why I didn't become a plumber &mdash; at least then I'd get to save the princess\n- User stories that read like they were written by a Soviet-era bureaucratic committee: five people involved, none of them understand the problem, all of them have to approve\n- And sometimes, just sometimes, the impostor syndrome whispering that *I'm not good enough anyway*, so **why you even bother bro?**\n\n## The Positive Feedback Loop (3.6 Roentgen, Not Great, Not Terrible)\n\nLet's talk about the self-destructive behavior, because pretending it doesn't exist won't make it go away.\n\nIt's the combination of impostor syndrome &mdash; that thing [over half of us feel](https://arxiv.org/abs/2312.03966) but won't admit &mdash; in conjunction with an *I'm not good enough* mentality. It's a self-fulfilling prophecy in a positive feedback loop. The more frustrated you get, the more you believe you can't do it. The more you believe you can't do it, the more you procrastinate. The more you procrastinate, the more frustrated you get.\n\nRinse. Repeat. Spiral.\n\nThis is where the difference between 3PM and 3AM becomes crystal clear.\n\nAt 3PM, with a ton of things running, cars passing by, neighbors screaming, my first-born crying that she wants to watch some Peppa Pig &mdash; IT'S A NIGHTMARE. There are deadlines, meetings, messages, interruptions. The frustration compounds. If it doesn't work in 10 minutes, I can skip to the next important thing. Procrastinating the one that usually matters.\n\nAt 3AM? When the baby wakes me up for a reason or another and I can't fall back asleep? That's different.\n\nAt 3AM, when there's time and space to meditate on the problem, work becomes meditative. The serenity of the city that sleeps soundly. Some lo-fi or psybient playing quietly. The cold outside, or the warmth &mdash; doesn't matter. What matters is the silence, the lack of competing priorities, the absence of pressure.\n\nNo race conditions between my brain and seventeen Slack notifications. Just me, the code, and a singular focus.\n\nAt 3AM, those boring tasks that would make me punch the screen at 3PM? They feel like jacking into the Matrix. Pure focus. Pure flow.\n\nI am nocturnal. I've accepted this.\n\n## Breaking Through the Wall (One Brick at a Time)\n\nSo how do you actually push through when the frustration hits and tomorrow keeps not coming?\n\nStay a while and listen.\n\n### The 30 Minute Rule\n\nGive it 30 minutes. If you have no results, or only bad results, SCREAM FOR HALP! Someone's more peaceful mind and cleaner look will slay the beast. **Ego is expensive**. Help is cheap-ish. Use it.\n\n### Break it into dopamine shots\n\nLetâ€™s sit with dopamine for a moment &mdash; because realizing how this ðŸ¤¬ thing works is the difference between **owning** procrastination and being **pwned** by it.\n\nDopamine isnâ€™t a *pleasure chemical* (like oxytocin, which makes hugs and group projects feel good, or endorphins, which flood in after a run); itâ€™s a *prediction* and *motivation* molecule. It surges when your brain **forecasts a potential reward** &mdash; not necessarily when you actually get it. Can you now see *why* you pick the tasks you pick, or even *how* you pick them? Why *this* user story *feels* better than *that* boring one? Your brain cares more about the **chase** than the **catch**.\n\nThatâ€™s why doomscrolling, inbox refreshing, and productive procrastination are incredibly treacherous. They dispense **variable dopamine hits**: \n\n- New Post!\n- Message Reply!\n- New Comment!\n- Slack Ping!\n\nThese keep you on the hook without ever giving genuine closure (i.e., finishing something meaningful).\n\nBut hereâ€™s the hack (not really a bio-hack, but you get the point): hijack dopamine *toward* what matters. Train your system to reward the process, not just the result.\n\nHow? Break big goals into **micro-tasks** you can ship fast. Did a small, meaningful change? `git commit`. Does a PR await merging? Go ahead &mdash; **merge it**. Close that ticket. Delete that TODO. Each tiny success delivers a clean *Oops, I did it again* hit &dash; real dopamine for real progress. Over time, your brain begins to prefer *steady micro-progress* over the empty calories of distraction.\n\n### Stubbornness plus movement\n\nI pace. I talk to myself. I go back and forth in my living room, ~~cursing~~ working through the problem out loud. Sometimes the solution isn't in the code. It's in getting your body moving and your mouth talking.\n\nNow, without too many technical shenanigans, this works because *walking* increases blood flow and basically wakes up the parts of your brain handling complex reasoning &mdash; not Neo Cortex, his younger brother, Prefrontal.\n\nEffectively *vocalizing* your thoughts is like sending a `nice` call on Linux; your working memory gets top priority, while all the other internal chatter (whatâ€™s for dinner, did I shut off the oven, is Obi-Wan Kenobi Leia's only hope) gets pushed down the queue.\n\nSuddenly your brain can actually focus on the problem at hand, because `movement + vocalizing` isnâ€™t just a bad habit. Itâ€™s a way to prime your brain for the battle ahead: solving the problem in the best way possible.\n\n### Mood-aware task switching\n\nWhat if I can't concentrate, nobody's around for help, and I feel like hitting a wall? Science says your brain is probably in a **low dopamine / low motivation state**, which makes tackling big, hard problems brutal. Dark Souls, anyone?\n\nI switch to another small task, and here's the trick: if I'm in a self-destructive mood, I deliberately avoid the big, scary things. Instead, I focus on small wins (unblocking a process, writing a tiny PoC, sending status updates)anything that produces **fast, predictable dopamine hits**. These micro-progress tasks elevate mood and motivation, often within an hour or two, essentially performing a warm-reboot on the brain.\n\nThink of it like your brainâ€™s own **OOM Killer**: when the big, heavy processes are blocking everything else, you temporarily kill low-priority tasks, let the small, manageable processes run, and regain enough headroom to attack the big problem without crashing.\n\nThen I return to the original problem, now reinforced and more determined. \n\nYour brain has gotten a mini reboot: prefrontal cortex ready, working memory unblocked, motivation back in play.\n\nIt never gets easier; you just figure out when your brain isnâ€™t irradiated and ready to function.\n\n## The Eisenhower Unlock\n\nLearning to look at my tasks differently, changed everything for me:\n\nI follow the [Eisenhower Matrix](https://en.wikipedia.org/wiki/Time_management#Eisenhower_method) now. I delegate. I eliminate. I prioritize what must be done now versus what can wait. I split tasks so I can deliver quick wins. But more importantly, I learned to ask myself two questions:\n\n> Is this something that, if done by a colleague of mine, would actually benefit both of us?  \n\n\n> Do we really need to do this when there are a hundred other things on the backlog that, admittedly, have higher priority?\n\n|                     | **Urgent**                                      | **Not Urgent**                                |\n|---------------------|-------------------------------------------------|-----------------------------------------------|\n| **Important**       | **Quadrant I: Do First**\u003Cbr>Tasks that require immediate attention and have high impact. | **Quadrant II: Schedule**\u003Cbr>Tasks that are important but not time-sensitive. |\n| **Not Important**   | **Quadrant III: Delegate**\u003Cbr>Tasks that demand attention but do not significantly contribute to your goals. Best to delegate if possible. | **Quadrant IV: Eliminate**\u003Cbr>Tasks that are distractions or low-value activities. Ideally, minimize or remove these. |\n\n\nI used to procrastinate tasks that should have been delegated or eliminated. I'd let them sit in my queue, rotting, creating guilt and anxiety. Not anymore. Now I say:\n\n- We have other priorities right now. (*Do First*)\n- There is a critical production bug that we need to fix immediately. (*Do First*)\n- The system outage the customer reported needs our attention now. (*Do First*)\n- This doesnâ€™t fit into the current sprint, weâ€™ll schedule it later. (*Schedule*)\n- Weâ€™ll get to this in a best-effort way when we have the capacity. (*Schedule*)\n- Refactoring this core module is important, weâ€™ll schedule it to prevent future issues. (*Schedule*)\n- This is perfect for the mentee to take on and learn from. (*Delegate*)\n- The new hire can handle this to get up to speed on the project. (*Delegate*)\n- This doesnâ€™t align with our roadmap priorities. (*Eliminate*)\n- Experimenting with this new framework has no immediate payoff, so weâ€™ll skip it. (*Eliminate*)\n\nDelegation isn't dumping work on someone else. It's **development**. It's recognizing that some tasks are better suited for others; either because they'll **learn from it**, because they have a **cleaner perspective**, or because you have **more important stuff to do**.\n\nAnd, yes, you **can** have more important stuff to do.\n\nElimination isn't laziness. It's **leadership**. It's saying *this doesn't deserve anyone's time right now*.  \n\nThe Matrix changed how I collaborate with my peers and crew. It changed how I look at what deserves my frustrationâ€¦ and what doesn't.\n\n## Tomorrow Comes in a Couple of Days\n\nLet's be honest: tomorrow *does* eventually come. Usually in a couple of days, driven by deadlines and guilt. That's one of the realities of professional software development.\n\nBut now I have tools. The 30-minute rule. The Eisenhower Matrix. The quick wins. The stubborn marching and vocalizing. The self-aware mood management. The willingness to scream for help before I've wasted half a day being frustrated.\n\nThe work doesn't get easier. The badly documented APIs don't magically improve. The boring tasks don't become fascinating. The user stories don't suddenly make sense.\n\nBut you get better at recognizing what deserves your frustration &mdash; and what doesn't.\n\nYou get better at catching yourself in the productive procrastination spiral before three weeks later becomes a crisis.\n\nYou get better at knowing when you're in the right headspace to tackle the hard problem versus when you should switch to something that'll reset your mood.\n\nYou get better at asking for help before the impostor syndrome and the \"I'm not good enough\" loop eats you alive.\n\nAnd sometimes, when the city sleeps and the lo-fi beats play and there's nothing but you and the code and the cold blue glow of your monitors, you remember why you started doing this in the first place.","src/content/blog/overcoming-procrastination-frustration-code-stagnation.md",[261],"../../assets/procrastination.webp","c3618c171268c265",{"html":264,"metadata":265},"\u003Cblockquote>\n\u003Cp>A badly documented API is worse than a completely undocumented API.\u003C/p>\n\u003C/blockquote>\n\u003Cp>There. I said it. When Iâ€™m working with undocumented stuff, I know Iâ€™ll have to poke it until I get a result; even if that result is a \u003Ccode>418 I'm a teapot\u003C/code>. But badly documented APIs? The ones where someone clearly \u003Cem>just closed their Jira ticket\u003C/em> \u003Cstrong>without giving a damn\u003C/strong>? Those make me want to punch through my monitor.\u003C/p>\n\u003Cp>The only thing that kept me back last time? The \u003Cem>Minister of Finance\u003C/em> wouldnâ€™t approve the purchase of a new oneâ€¦ (\u003Cem>sigh\u003C/em>)\u003C/p>\n\u003Cp>Soâ€¦ I tried what the docs said. \u003Cem>Failed\u003C/em>. Read more. \u003Cem>Failed more\u003C/em>. Hacked some things here and thereâ€¦\u003C/p>\n\u003Cp>(â•¯Â°â–¡Â°)â•¯ï¸µ â”»â”â”»\u003C/p>\n\u003Cp>Screw it, itâ€™s 3PM and I need a coffee. Brew a coffee. Scrolled through my emails. Made a mental note to answer one of them. Replied to some Asana comments. Back to the implementation. Threw a couple of \u003Ccode>curl\u003C/code> requests to no avail. Sent a message to a colleague about an unrelated matter. Back to Asana. Back to \u003Ccode>curl\u003C/code>.\u003C/p>\n\u003Cp>Oh, ðŸ¤¬. Iâ€™ll fix it tomorrow.\u003C/p>\n\u003Cp>Tomorrow never came.\u003C/p>\n\u003Ch2 id=\"the-anatomy-of-productive-procrastination\">The Anatomy of Productive Procrastination\u003C/h2>\n\u003Cp>Hereâ€™s the thing about productive procrastination: itâ€™s \u003Cstrong>worse than doomscrolling\u003C/strong>. At least when youâ€™re scrolling throughout Reddit, you know youâ€™re procrastinating. You can see it. You can understand it. But \u003Cem>productive procrastination\u003C/em>? It gives you a sense of Â«\u003Cem>Hey! I do things\u003C/em>Â» or Â«\u003Cem>I am working\u003C/em>Â» or even Â«\u003Cem>Iâ€™m not procrastinating\u003C/em>Â».\u003C/p>\n\u003Cp>It keeps you away from your goals and priorities while letting you pretend youâ€™re being productive.\u003C/p>\n\u003Cp>The Asana comments. The colleague messages. The email mental notes. All of it feels like work. All of \u003Cstrong>it is work\u003C/strong>, technically. But itâ€™s not the work that \u003Cstrong>matters\u003C/strong>.\u003C/p>\n\u003Cp>When Iâ€™m frustrated by something (some examples are a badly documented API, a task thatâ€™s extremely boring, a user story that makes no sense, a project that has no purpose) I do other things. And on those days when Iâ€™m feeling self-destructive? Just the feeling of it is enough to send me spiraling into productive procrastination.\u003C/p>\n\u003Cp>The triggers? As predictable as the fact that \u003Cem>it works on my machine\u003C/em>:\u003C/p>\n\u003Cul>\n\u003Cli>Badly documented APIs (or worse, APIs documented by someone juggling three remote jobs who needed to show progress on all of them before their 2 PM standup)\u003C/li>\n\u003Cli>Soul-crushing, mind-mashing boring tasks that make me wonder why I didnâ€™t become a plumber â€” at least then Iâ€™d get to save the princess\u003C/li>\n\u003Cli>User stories that read like they were written by a Soviet-era bureaucratic committee: five people involved, none of them understand the problem, all of them have to approve\u003C/li>\n\u003Cli>And sometimes, just sometimes, the impostor syndrome whispering that \u003Cem>Iâ€™m not good enough anyway\u003C/em>, so \u003Cstrong>why you even bother bro?\u003C/strong>\u003C/li>\n\u003C/ul>\n\u003Ch2 id=\"the-positive-feedback-loop-36-roentgen-not-great-not-terrible\">The Positive Feedback Loop (3.6 Roentgen, Not Great, Not Terrible)\u003C/h2>\n\u003Cp>Letâ€™s talk about the self-destructive behavior, because pretending it doesnâ€™t exist wonâ€™t make it go away.\u003C/p>\n\u003Cp>Itâ€™s the combination of impostor syndrome â€” that thing \u003Ca href=\"https://arxiv.org/abs/2312.03966\">over half of us feel\u003C/a> but wonâ€™t admit â€” in conjunction with an \u003Cem>Iâ€™m not good enough\u003C/em> mentality. Itâ€™s a self-fulfilling prophecy in a positive feedback loop. The more frustrated you get, the more you believe you canâ€™t do it. The more you believe you canâ€™t do it, the more you procrastinate. The more you procrastinate, the more frustrated you get.\u003C/p>\n\u003Cp>Rinse. Repeat. Spiral.\u003C/p>\n\u003Cp>This is where the difference between 3PM and 3AM becomes crystal clear.\u003C/p>\n\u003Cp>At 3PM, with a ton of things running, cars passing by, neighbors screaming, my first-born crying that she wants to watch some Peppa Pig â€” ITâ€™S A NIGHTMARE. There are deadlines, meetings, messages, interruptions. The frustration compounds. If it doesnâ€™t work in 10 minutes, I can skip to the next important thing. Procrastinating the one that usually matters.\u003C/p>\n\u003Cp>At 3AM? When the baby wakes me up for a reason or another and I canâ€™t fall back asleep? Thatâ€™s different.\u003C/p>\n\u003Cp>At 3AM, when thereâ€™s time and space to meditate on the problem, work becomes meditative. The serenity of the city that sleeps soundly. Some lo-fi or psybient playing quietly. The cold outside, or the warmth â€” doesnâ€™t matter. What matters is the silence, the lack of competing priorities, the absence of pressure.\u003C/p>\n\u003Cp>No race conditions between my brain and seventeen Slack notifications. Just me, the code, and a singular focus.\u003C/p>\n\u003Cp>At 3AM, those boring tasks that would make me punch the screen at 3PM? They feel like jacking into the Matrix. Pure focus. Pure flow.\u003C/p>\n\u003Cp>I am nocturnal. Iâ€™ve accepted this.\u003C/p>\n\u003Ch2 id=\"breaking-through-the-wall-one-brick-at-a-time\">Breaking Through the Wall (One Brick at a Time)\u003C/h2>\n\u003Cp>So how do you actually push through when the frustration hits and tomorrow keeps not coming?\u003C/p>\n\u003Cp>Stay a while and listen.\u003C/p>\n\u003Ch3 id=\"the-30-minute-rule\">The 30 Minute Rule\u003C/h3>\n\u003Cp>Give it 30 minutes. If you have no results, or only bad results, SCREAM FOR HALP! Someoneâ€™s more peaceful mind and cleaner look will slay the beast. \u003Cstrong>Ego is expensive\u003C/strong>. Help is cheap-ish. Use it.\u003C/p>\n\u003Ch3 id=\"break-it-into-dopamine-shots\">Break it into dopamine shots\u003C/h3>\n\u003Cp>Letâ€™s sit with dopamine for a moment â€” because realizing how this ðŸ¤¬ thing works is the difference between \u003Cstrong>owning\u003C/strong> procrastination and being \u003Cstrong>pwned\u003C/strong> by it.\u003C/p>\n\u003Cp>Dopamine isnâ€™t a \u003Cem>pleasure chemical\u003C/em> (like oxytocin, which makes hugs and group projects feel good, or endorphins, which flood in after a run); itâ€™s a \u003Cem>prediction\u003C/em> and \u003Cem>motivation\u003C/em> molecule. It surges when your brain \u003Cstrong>forecasts a potential reward\u003C/strong> â€” not necessarily when you actually get it. Can you now see \u003Cem>why\u003C/em> you pick the tasks you pick, or even \u003Cem>how\u003C/em> you pick them? Why \u003Cem>this\u003C/em> user story \u003Cem>feels\u003C/em> better than \u003Cem>that\u003C/em> boring one? Your brain cares more about the \u003Cstrong>chase\u003C/strong> than the \u003Cstrong>catch\u003C/strong>.\u003C/p>\n\u003Cp>Thatâ€™s why doomscrolling, inbox refreshing, and productive procrastination are incredibly treacherous. They dispense \u003Cstrong>variable dopamine hits\u003C/strong>:\u003C/p>\n\u003Cul>\n\u003Cli>New Post!\u003C/li>\n\u003Cli>Message Reply!\u003C/li>\n\u003Cli>New Comment!\u003C/li>\n\u003Cli>Slack Ping!\u003C/li>\n\u003C/ul>\n\u003Cp>These keep you on the hook without ever giving genuine closure (i.e., finishing something meaningful).\u003C/p>\n\u003Cp>But hereâ€™s the hack (not really a bio-hack, but you get the point): hijack dopamine \u003Cem>toward\u003C/em> what matters. Train your system to reward the process, not just the result.\u003C/p>\n\u003Cp>How? Break big goals into \u003Cstrong>micro-tasks\u003C/strong> you can ship fast. Did a small, meaningful change? \u003Ccode>git commit\u003C/code>. Does a PR await merging? Go ahead â€” \u003Cstrong>merge it\u003C/strong>. Close that ticket. Delete that TODO. Each tiny success delivers a clean \u003Cem>Oops, I did it again\u003C/em> hit â€ real dopamine for real progress. Over time, your brain begins to prefer \u003Cem>steady micro-progress\u003C/em> over the empty calories of distraction.\u003C/p>\n\u003Ch3 id=\"stubbornness-plus-movement\">Stubbornness plus movement\u003C/h3>\n\u003Cp>I pace. I talk to myself. I go back and forth in my living room, \u003Cdel>cursing\u003C/del> working through the problem out loud. Sometimes the solution isnâ€™t in the code. Itâ€™s in getting your body moving and your mouth talking.\u003C/p>\n\u003Cp>Now, without too many technical shenanigans, this works because \u003Cem>walking\u003C/em> increases blood flow and basically wakes up the parts of your brain handling complex reasoning â€” not Neo Cortex, his younger brother, Prefrontal.\u003C/p>\n\u003Cp>Effectively \u003Cem>vocalizing\u003C/em> your thoughts is like sending a \u003Ccode>nice\u003C/code> call on Linux; your working memory gets top priority, while all the other internal chatter (whatâ€™s for dinner, did I shut off the oven, is Obi-Wan Kenobi Leiaâ€™s only hope) gets pushed down the queue.\u003C/p>\n\u003Cp>Suddenly your brain can actually focus on the problem at hand, because \u003Ccode>movement + vocalizing\u003C/code> isnâ€™t just a bad habit. Itâ€™s a way to prime your brain for the battle ahead: solving the problem in the best way possible.\u003C/p>\n\u003Ch3 id=\"mood-aware-task-switching\">Mood-aware task switching\u003C/h3>\n\u003Cp>What if I canâ€™t concentrate, nobodyâ€™s around for help, and I feel like hitting a wall? Science says your brain is probably in a \u003Cstrong>low dopamine / low motivation state\u003C/strong>, which makes tackling big, hard problems brutal. Dark Souls, anyone?\u003C/p>\n\u003Cp>I switch to another small task, and hereâ€™s the trick: if Iâ€™m in a self-destructive mood, I deliberately avoid the big, scary things. Instead, I focus on small wins (unblocking a process, writing a tiny PoC, sending status updates)anything that produces \u003Cstrong>fast, predictable dopamine hits\u003C/strong>. These micro-progress tasks elevate mood and motivation, often within an hour or two, essentially performing a warm-reboot on the brain.\u003C/p>\n\u003Cp>Think of it like your brainâ€™s own \u003Cstrong>OOM Killer\u003C/strong>: when the big, heavy processes are blocking everything else, you temporarily kill low-priority tasks, let the small, manageable processes run, and regain enough headroom to attack the big problem without crashing.\u003C/p>\n\u003Cp>Then I return to the original problem, now reinforced and more determined.\u003C/p>\n\u003Cp>Your brain has gotten a mini reboot: prefrontal cortex ready, working memory unblocked, motivation back in play.\u003C/p>\n\u003Cp>It never gets easier; you just figure out when your brain isnâ€™t irradiated and ready to function.\u003C/p>\n\u003Ch2 id=\"the-eisenhower-unlock\">The Eisenhower Unlock\u003C/h2>\n\u003Cp>Learning to look at my tasks differently, changed everything for me:\u003C/p>\n\u003Cp>I follow the \u003Ca href=\"https://en.wikipedia.org/wiki/Time_management#Eisenhower_method\">Eisenhower Matrix\u003C/a> now. I delegate. I eliminate. I prioritize what must be done now versus what can wait. I split tasks so I can deliver quick wins. But more importantly, I learned to ask myself two questions:\u003C/p>\n\u003Cblockquote>\n\u003Cp>Is this something that, if done by a colleague of mine, would actually benefit both of us?\u003C/p>\n\u003C/blockquote>\n\u003Cblockquote>\n\u003Cp>Do we really need to do this when there are a hundred other things on the backlog that, admittedly, have higher priority?\u003C/p>\n\u003C/blockquote>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>\u003C/th>\u003Cth>\u003Cstrong>Urgent\u003C/strong>\u003C/th>\u003Cth>\u003Cstrong>Not Urgent\u003C/strong>\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>\u003Cstrong>Important\u003C/strong>\u003C/td>\u003Ctd>\u003Cstrong>Quadrant I: Do First\u003C/strong>\u003Cbr>Tasks that require immediate attention and have high impact.\u003C/td>\u003Ctd>\u003Cstrong>Quadrant II: Schedule\u003C/strong>\u003Cbr>Tasks that are important but not time-sensitive.\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Cstrong>Not Important\u003C/strong>\u003C/td>\u003Ctd>\u003Cstrong>Quadrant III: Delegate\u003C/strong>\u003Cbr>Tasks that demand attention but do not significantly contribute to your goals. Best to delegate if possible.\u003C/td>\u003Ctd>\u003Cstrong>Quadrant IV: Eliminate\u003C/strong>\u003Cbr>Tasks that are distractions or low-value activities. Ideally, minimize or remove these.\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cp>I used to procrastinate tasks that should have been delegated or eliminated. Iâ€™d let them sit in my queue, rotting, creating guilt and anxiety. Not anymore. Now I say:\u003C/p>\n\u003Cul>\n\u003Cli>We have other priorities right now. (\u003Cem>Do First\u003C/em>)\u003C/li>\n\u003Cli>There is a critical production bug that we need to fix immediately. (\u003Cem>Do First\u003C/em>)\u003C/li>\n\u003Cli>The system outage the customer reported needs our attention now. (\u003Cem>Do First\u003C/em>)\u003C/li>\n\u003Cli>This doesnâ€™t fit into the current sprint, weâ€™ll schedule it later. (\u003Cem>Schedule\u003C/em>)\u003C/li>\n\u003Cli>Weâ€™ll get to this in a best-effort way when we have the capacity. (\u003Cem>Schedule\u003C/em>)\u003C/li>\n\u003Cli>Refactoring this core module is important, weâ€™ll schedule it to prevent future issues. (\u003Cem>Schedule\u003C/em>)\u003C/li>\n\u003Cli>This is perfect for the mentee to take on and learn from. (\u003Cem>Delegate\u003C/em>)\u003C/li>\n\u003Cli>The new hire can handle this to get up to speed on the project. (\u003Cem>Delegate\u003C/em>)\u003C/li>\n\u003Cli>This doesnâ€™t align with our roadmap priorities. (\u003Cem>Eliminate\u003C/em>)\u003C/li>\n\u003Cli>Experimenting with this new framework has no immediate payoff, so weâ€™ll skip it. (\u003Cem>Eliminate\u003C/em>)\u003C/li>\n\u003C/ul>\n\u003Cp>Delegation isnâ€™t dumping work on someone else. Itâ€™s \u003Cstrong>development\u003C/strong>. Itâ€™s recognizing that some tasks are better suited for others; either because theyâ€™ll \u003Cstrong>learn from it\u003C/strong>, because they have a \u003Cstrong>cleaner perspective\u003C/strong>, or because you have \u003Cstrong>more important stuff to do\u003C/strong>.\u003C/p>\n\u003Cp>And, yes, you \u003Cstrong>can\u003C/strong> have more important stuff to do.\u003C/p>\n\u003Cp>Elimination isnâ€™t laziness. Itâ€™s \u003Cstrong>leadership\u003C/strong>. Itâ€™s saying \u003Cem>this doesnâ€™t deserve anyoneâ€™s time right now\u003C/em>.\u003C/p>\n\u003Cp>The Matrix changed how I collaborate with my peers and crew. It changed how I look at what deserves my frustrationâ€¦ and what doesnâ€™t.\u003C/p>\n\u003Ch2 id=\"tomorrow-comes-in-a-couple-of-days\">Tomorrow Comes in a Couple of Days\u003C/h2>\n\u003Cp>Letâ€™s be honest: tomorrow \u003Cem>does\u003C/em> eventually come. Usually in a couple of days, driven by deadlines and guilt. Thatâ€™s one of the realities of professional software development.\u003C/p>\n\u003Cp>But now I have tools. The 30-minute rule. The Eisenhower Matrix. The quick wins. The stubborn marching and vocalizing. The self-aware mood management. The willingness to scream for help before Iâ€™ve wasted half a day being frustrated.\u003C/p>\n\u003Cp>The work doesnâ€™t get easier. The badly documented APIs donâ€™t magically improve. The boring tasks donâ€™t become fascinating. The user stories donâ€™t suddenly make sense.\u003C/p>\n\u003Cp>But you get better at recognizing what deserves your frustration â€” and what doesnâ€™t.\u003C/p>\n\u003Cp>You get better at catching yourself in the productive procrastination spiral before three weeks later becomes a crisis.\u003C/p>\n\u003Cp>You get better at knowing when youâ€™re in the right headspace to tackle the hard problem versus when you should switch to something thatâ€™ll reset your mood.\u003C/p>\n\u003Cp>You get better at asking for help before the impostor syndrome and the â€œIâ€™m not good enoughâ€ loop eats you alive.\u003C/p>\n\u003Cp>And sometimes, when the city sleeps and the lo-fi beats play and thereâ€™s nothing but you and the code and the cold blue glow of your monitors, you remember why you started doing this in the first place.\u003C/p>",{"headings":266,"localImagePaths":294,"remoteImagePaths":295,"frontmatter":296,"imagePaths":300},[267,270,273,276,279,282,285,288,291],{"depth":52,"slug":268,"text":269},"the-anatomy-of-productive-procrastination","The Anatomy of Productive Procrastination",{"depth":52,"slug":271,"text":272},"the-positive-feedback-loop-36-roentgen-not-great-not-terrible","The Positive Feedback Loop (3.6 Roentgen, Not Great, Not Terrible)",{"depth":52,"slug":274,"text":275},"breaking-through-the-wall-one-brick-at-a-time","Breaking Through the Wall (One Brick at a Time)",{"depth":128,"slug":277,"text":278},"the-30-minute-rule","The 30 Minute Rule",{"depth":128,"slug":280,"text":281},"break-it-into-dopamine-shots","Break it into dopamine shots",{"depth":128,"slug":283,"text":284},"stubbornness-plus-movement","Stubbornness plus movement",{"depth":128,"slug":286,"text":287},"mood-aware-task-switching","Mood-aware task switching",{"depth":52,"slug":289,"text":290},"the-eisenhower-unlock","The Eisenhower Unlock",{"depth":52,"slug":292,"text":293},"tomorrow-comes-in-a-couple-of-days","Tomorrow Comes in a Couple of Days",[],[],{"title":228,"description":229,"pubDate":297,"category":243,"tags":298,"excerpt":244,"heroImage":261,"keywords":299},"2025-10-07",[233,234,235,236,237,238,239,240,241,242],[233,246,234,247,248,249,250,251,252,253,254,255,256,257],[]]